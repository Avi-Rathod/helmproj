apiVersion: iot.sas.com/v1
kind: ESPServer
metadata:
  annotations:
    espProjectName: Tripwires
  name: sas-tripwires-esp-server
spec:
  name: sas-tripwires-esp-server
  failover: false
  loadBalancePolicy: default
  model: ""
  espProperties:
    logging.loggers.Audit.Authentication.level: fatal
    logging.loggers.DF.ESP.AUTH.level: info
    logging.loggers.DF.ESP.SA.level: info
    logging.loggers.DF.ESP.STATS.level: warn
    logging.loggers.DF.ESP.WINDOW.PATTERN.level: warn
    logging.loggers.DF.ESP.level: info
    logging.loggers.common.http.level: info
    logging.loggers.common.websocket: error
    logging.loggers.esp.pubsub.level: info
    logging.loggers.esp.server.level: info
    server.model: file:///opt/sas/viya/config/data/sas-tripwires-esp-model.xml
    server.on-project-fatal: exit
  projectTemplate:
    autoscale:
      minReplicas: 1
      maxReplicas: 1
      metrics:
        - resource:
            name: cpu
            target:
              averageUtilization: 50
              type: Utilization
          type: Resource
    deployment:
      apiVersion: ""
      kind: ESPTemplate
      spec:
        selector:
          matchLabels:
            app: ((PROJECT_SERVICE_NAME))
            type: esp
        template:
          metadata:
            labels:
              app: ((PROJECT_SERVICE_NAME))
              type: esp
          spec:
            containers:
              - name: ((PROJECT_SERVICE_NAME))
                env:
                  - name: LANG
                    value: en_US.utf8
                envFrom:
                  - configMapRef:
                      name: sas-tripwires-esp-server-config
                resources:
                  limits:
                    cpu: "1.0"
                    memory: 500Mi
                  requests:
                    cpu: "0.1"
                    memory: 200Mi
                volumeMounts:
                  - name: sas-tripwires-esp-model
                    mountPath: /opt/sas/viya/config/data/sas-tripwires-esp-model.xml
                    subPath: sas-tripwires-esp-model.xml
            volumes:
              - name: sas-tripwires-esp-model
                configMap:
                  name: sas-tripwires-esp-model