apiVersion: v1
kind: PodTemplate
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-cas-pod-template
  labels:
    launcher.sas.com/job-type: cas-batch-server
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/template-intent: sas-launcher
    workload.sas.com/class: cas
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    launcher.sas.com/nfs-server: 10.custom227.custom69.custom177
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-cas-operator
    sas.com/component-version: 3.custom48.custom4-20241014.custom1728921008318
    sas.com/config-init-mode: initcontainer
    sas.com/kustomize-base: base
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom48.custom4
template:
  metadata:
    annotations:
      sas.com/certificate-file-format: pem
      sas.com/kustomize-base: base
      sas.com/tls-enabled-ports: all
      sas.com/tls-mode: full-stack
    labels:
      launcher.sas.com/job-type: cas-batch-server
      sas.com/deployment: sas-viya
  spec:
    affinity:
      nodeAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - preference:
            matchExpressions:
            - key: workload.sas.com/class
              operator: In
              values:
              - cas
            matchFields: []
          weight: 100
        - preference:
            matchExpressions:
            - key: workload.sas.com/class
              operator: NotIn
              values:
              - compute
              - connect
              - stateless
              - stateful
            matchFields: []
          weight: 50
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: kubernetes.azure.com/mode
              operator: NotIn
              values:
              - system
            matchFields: []
      podAffinity:
        preferredDuringSchedulingIgnoredDuringExecution: []
        requiredDuringSchedulingIgnoredDuringExecution: []
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution: []
        requiredDuringSchedulingIgnoredDuringExecution: []
    automountServiceAccountToken: true
    containers:
    - args: []
      command: []
      env:
      - name: SAS_LICENSE
        valueFrom:
          secretKeyRef:
            key: SAS_LICENSE
            name: sas-cas-license
      - name: CASENV_CAS_VIRTUAL_PATH
        value: /cas-shared-default-http
      - name: CASCFG_HOSTKNOWNBY
        value: localhost
      - name: SAS_CURRENT_HOST
        value: localhost
      - name: CASENV_CAS_VIRTUAL_HOST
        value: localhost
      - name: CAS_CLIENT_SSL_REQUIRED
        value: "false"
      - name: CASCONTROLLERHOST
        value: localhost
      - name: CASCFG_MODE
        value: smp
      - name: CASENV_CAS_USE_CONSUL
        value: "false"
      - name: SERVICE_NAME
        value: cascontroller
      - name: CAS_INSTANCE_MODE
        value: batch
      envFrom:
      - configMapRef:
          name: sas-tls-config-dg85g4hfh8
      - configMapRef:
          name: sas-java-config-fg8dm449m4
      - configMapRef:
          name: sas-access-config-mm6fhg8gc7
      - configMapRef:
          name: sas-shared-config-c49cg8722d
      - configMapRef:
          name: sas-cas-config-26bg5m9gb4
      - configMapRef:
          name: sas-deployment-metadata-27kb47bb47
      - configMapRef:
          name: sas-restore-job-parameters-c8k4g7hb2g
      image: enterprisequay.hbctxdom.com/sasviyaprod/viya-4-x64_oci_linux_2-docker/sas-cas-server:1.custom64.custom45-20241203.custom1733260071303
      imagePullPolicy: IfNotPresent
      name: sas-cas-server
      ports:
      - containerPort: 5570
        name: cal
        protocol: TCP
      - containerPort: 5572
        name: epcs
        protocol: TCP
      - containerPort: 8777
        name: http
        protocol: TCP
      - containerPort: 5571
        name: gc
        protocol: TCP
      readinessProbe:
        failureThreshold: 3
        httpGet:
          httpHeaders: []
          path: /internal/state
          port: 8777
          scheme: HTTPS
        initialDelaySeconds: 5
        periodSeconds: 10
        successThreshold: 1
        timeoutSeconds: 1
      resizePolicy: []
      resources:
        requests:
          cpu: 250m
          memory: 2Gi
      volumeDevices: []
      volumeMounts:
      - mountPath: /cas/permstore
        name: cas-default-permstore-volume
      - mountPath: /cas/data
        name: cas-default-data-volume
      - mountPath: /cas/cache
        name: cas-default-cache-volume
      - mountPath: /cas/config
        name: cas-default-config-volume
      - mountPath: /tmp
        name: cas-tmp-volume
        subPath: tmp
      - mountPath: /opt/sas/viya/config/tmp/sas-cas
        name: cas-tmp-volume
        subPath: sas-cas
      - mountPath: /cas/license
        name: cas-license-volume
      - mountPath: /opt/sas/viya/home/commonfiles
        name: commonfilesvols
      - mountPath: /security
        name: security
      - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
        name: security
        subPath: cacerts
      - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
        name: security
        subPath: private
      - mountPath: /saswork
        name: viyawork
      - mountPath: /sasdata
        name: nfs-sasdata
      - mountPath: /homes
        name: nfs-homes
    ephemeralContainers: []
    hostAliases: []
    imagePullSecrets:
    - name: sas-image-pull-secrets-9dd8hm29fm
    initContainers:
    - env:
      - name: KUBE_POD_NAME
        valueFrom:
          fieldRef:
            fieldPath: metadata.name
      - name: SAS_CERTFRAME_TOKEN_DIR
        value: /certframe-token
      - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
        value: /customer-provided-ca-certificates
      - name: ENTRYPOINT_ATTEMPTS_MAX
        value: "5"
      envFrom:
      - configMapRef:
          name: sas-certframe-config-6t84hm65mc
      - configMapRef:
          name: sas-certframe-ingress-certificate-config-6mt27h98mb
      - configMapRef:
          name: sas-certframe-user-config-679cgdbhdt
      image: enterprisequay.hbctxdom.com/sasviyaprod/viya-4-x64_oci_linux_2-docker/sas-certframe:3.custom57.custom1-20240905.custom1725561224344
      name: sas-certframe
      resources:
        limits:
          cpu: 500m
          memory: 500Mi
        requests:
          cpu: 50m
          memory: 50Mi
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
      volumeMounts:
      - mountPath: /certframe-token
        name: certframe-token
      - mountPath: /security
        name: security
      - mountPath: /customer-provided-ca-certificates
        name: customer-provided-ca-certificates
    - args: []
      command: []
      env:
      - name: SAS_INIT_CONFIG_PATH
        value: /cas/config
      envFrom:
      - configMapRef:
          name: sas-go-config-4m2m8m8662
      - configMapRef:
          name: sas-shared-config-c49cg8722d
      - configMapRef:
          name: sas-access-config-mm6fhg8gc7
      image: enterprisequay.hbctxdom.com/sasviyaprod/viya-4-x64_oci_linux_2-docker/sas-config-init:1.custom24.custom12-20241108.custom1731093895458
      imagePullPolicy: IfNotPresent
      name: sas-config-init
      ports: []
      resizePolicy: []
      resources:
        requests:
          cpu: 250m
          memory: 2Gi
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          add: []
          drop:
          - ALL
        privileged: false
        readOnlyRootFilesystem: true
      volumeDevices: []
      volumeMounts:
      - mountPath: /cas/config/
        name: cas-default-config-volume
      - mountPath: /opt/sas/viya/home/commonfiles
        name: commonfilesvols
    readinessGates: []
    resourceClaims: []
    restartPolicy: Never
    schedulingGates: []
    securityContext:
      fsGroup: 1001270000
      runAsNonRoot: true
      supplementalGroups: []
      sysctls: []
    serviceAccountName: sas-programming-environment
    shareProcessNamespace: true
    tolerations:
    - effect: NoSchedule
      key: workload.sas.com/class
      operator: Equal
      value: cas
    topologySpreadConstraints: []
    volumes:
    - emptyDir: {}
      name: cas-default-permstore-volume
    - emptyDir: {}
      name: cas-default-data-volume
    - emptyDir: {}
      name: cas-default-cache-volume
    - emptyDir: {}
      name: cas-default-config-volume
    - emptyDir: {}
      name: cas-tmp-volume
    - name: cas-license-volume
      secret:
        defaultMode: 420
        items:
        - key: SAS_LICENSE
          path: license.sas
        secretName: sas-cas-license
    - name: commonfilesvols
      persistentVolumeClaim:
        claimName: sas-commonfiles
        readOnly: true
    - name: certframe-token
      secret:
        secretName: sas-certframe-token
    - emptyDir: {}
      name: security
    - configMap:
        name: sas-customer-provided-ca-certificates-bm5hc686c7
      name: customer-provided-ca-certificates
    - hostPath:
        path: /var/saswork
      name: viyawork
    - name: nfs-sasdata
      nfs:
        path: /NAS_SAS_VIYA_DATA_PRD/sasdata
        server: 10.custom227.custom69.custom177
    - name: nfs-homes
      nfs:
        path: /NAS_SAS_VIYA_DATA_PRD/sasviya/homes
        server: 10.custom227.custom69.custom177
    - name: sas-launcher-userhome
      nfs:
        path: /NAS_SAS_VIYA_DATA_PRD/sasviya/homes
        server: 10.custom227.custom69.custom177
