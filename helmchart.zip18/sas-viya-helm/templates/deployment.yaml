apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-alerts
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-alerts
    sas.com/component-version: 0.custom33.custom0-20240910.custom1725986379279
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 0.custom33.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-alerts
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-alerts
        app.kubernetes.io/name: sas-alerts
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-alerts
        sas.com/component-version: 0.custom33.custom0-20240910.custom1725986379279
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 0.custom33.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-alerts
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.alerts.sasAlerts.env.sasK8SDeploymentName }}
        - name: SAS_KAFKA_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-creds-98ht2kf8db
              optional: true
        - name: SAS_KAFKA_USER
          valueFrom:
            secretKeyRef:
              key: username
              name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-creds-98ht2kf8db
              optional: true
        - name: SAS_KAFKA_TRUSTSTORE
          value: {{ quote .Values.alerts.sasAlerts.env.sasKafkaTruststore }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-config-c4thc4bhbg
            optional: true
        image: {{ .Values.alerts.sasAlerts.image.repository }}:{{ .Values.alerts.sasAlerts.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alerts.sasAlerts.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-alerts
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.alerts.sasAlerts.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.sasAlerts.containerSecurityContext |
          nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /kafkacert
          name: kafka-ca-cert
          readOnly: true
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      - command:
        - /bin/sh
        - -c
        - echo 'Worker is starting'; business-orchestration-worker; echo 'Worker has stopped.
          Waiting for shutdown.'; until [ -f /work2/shutdown ]; do sleep 1; done; echo 'Shutdown
          is complete.'
        env:
        - name: PROJECT_FILE
          value: {{ quote .Values.alerts.externalData.env.projectFile }}
        - name: SCHEMA_DIR
          value: {{ quote .Values.alerts.externalData.env.schemaDir }}
        - name: WORK_DIR
          value: {{ quote .Values.alerts.externalData.env.workDir }}
        - name: SHUTDOWN_FILE_ENABLED
          value: {{ quote .Values.alerts.externalData.env.shutdownFileEnabled }}
        - name: SHUTDOWN_FILE
          value: {{ quote .Values.alerts.externalData.env.shutdownFile }}
        - name: WORKLOAD_ENABLED_BY_INDEX
          value: {{ quote .Values.alerts.externalData.env.workloadEnabledByIndex }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.alerts.externalData.image.repository }}:{{ .Values.alerts.externalData.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alerts.externalData.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - /bin/sh
              - -c
              - echo 'container is shutting down'; touch /work2/shutdown; sleep 1
        name: external-data
        resources: {{- toYaml .Values.alerts.externalData.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.externalData.containerSecurityContext
          | nindent 10 }}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /projectfiles
          name: sas-alerts-external-data
        - mountPath: /shared-volume
          name: external-data-shared-volume
        - mountPath: /work2
          name: external-data-work-rw-volume
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.alerts.sasStartSequencer.image.repository }}:{{ .Values.alerts.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alerts.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.alerts.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.alerts.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.alerts.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.alerts.sasCertframe.image.repository }}:{{ .Values.alerts.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.alerts.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.alerts.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.alerts.hydrator.image.repository }}:{{ .Values.alerts.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alerts.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.alerts.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.alerts.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.alerts.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.alerts.sasDbMigrator.image.repository }}:{{ .Values.alerts.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alerts.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.alerts.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alerts.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.alerts.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - configMap:
          defaultMode: 511
          name: {{ include "sas-viya-helm.fullname" . }}-alerts-external-data-mb695t4h2h
        name: sas-alerts-external-data
      - emptyDir: {}
        name: external-data-shared-volume
      - emptyDir: {}
        name: external-data-work-rw-volume
      - name: kafka-ca-cert
        secret:
          optional: true
          secretName: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-ca-cert-hmkbtm6mt8
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-alerts-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-alerts-app
    sas.com/component-version: 0.custom32.custom0-20240911.custom1726061133658
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 0.custom32.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-alerts-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-alerts-app
        app.kubernetes.io/name: sas-alerts-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-alerts-app
        sas.com/component-version: 0.custom32.custom0-20240911.custom1726061133658
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 0.custom32.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-alerts-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.alertsApp.sasAlertsApp.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.alertsApp.sasAlertsApp.image.repository }}:{{ .Values.alertsApp.sasAlertsApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alertsApp.sasAlertsApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-alerts-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.alertsApp.sasAlertsApp.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alertsApp.sasAlertsApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.alertsApp.sasStartSequencer.image.repository }}:{{ .Values.alertsApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alertsApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.alertsApp.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.alertsApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.alertsApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.alertsApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.alertsApp.sasCertframe.image.repository }}:{{ .Values.alertsApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.alertsApp.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.alertsApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.alertsApp.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-alerts-transaction
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-alerts-transaction
    sas.com/component-version: 0.custom18.custom0-20240911.custom1726053510628
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 0.custom18.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-alerts-transaction
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-alerts-transaction
        app.kubernetes.io/name: sas-alerts-transaction
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-alerts-transaction
        sas.com/component-version: 0.custom18.custom0-20240911.custom1726053510628
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 0.custom18.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-alerts-transaction
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.alertsTransaction.sasAlertsTransaction.env.sasK8SDeploymentName
            }}
        - name: SAS_KAFKA_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-creds-98ht2kf8db
              optional: true
        - name: SAS_KAFKA_USER
          valueFrom:
            secretKeyRef:
              key: username
              name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-creds-98ht2kf8db
              optional: true
        - name: SAS_KAFKA_TRUSTSTORE
          value: {{ quote .Values.alertsTransaction.sasAlertsTransaction.env.sasKafkaTruststore
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-config-c4thc4bhbg
            optional: true
        image: '{{ .Values.alertsTransaction.sasAlertsTransaction.image.repository }}:{{
          .Values.alertsTransaction.sasAlertsTransaction.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.alertsTransaction.sasAlertsTransaction.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-alerts-transaction
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.alertsTransaction.sasAlertsTransaction.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.alertsTransaction.sasAlertsTransaction.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /kafkacert
          name: kafka-ca-cert
          readOnly: true
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.alertsTransaction.sasStartSequencer.image.repository }}:{{ .Values.alertsTransaction.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alertsTransaction.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.alertsTransaction.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.alertsTransaction.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.alertsTransaction.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.alertsTransaction.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.alertsTransaction.sasCertframe.image.repository }}:{{ .Values.alertsTransaction.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.alertsTransaction.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.alertsTransaction.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.alertsTransaction.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.alertsTransaction.hydrator.image.repository }}:{{ .Values.alertsTransaction.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alertsTransaction.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.alertsTransaction.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.alertsTransaction.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.alertsTransaction.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.alertsTransaction.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.alertsTransaction.sasDbMigrator.image.repository }}:{{ .Values.alertsTransaction.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.alertsTransaction.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.alertsTransaction.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.alertsTransaction.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.alertsTransaction.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: kafka-ca-cert
        secret:
          optional: true
          secretName: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config-kafka-ca-cert-hmkbtm6mt8
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-analytics-events
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-analytics-events
    sas.com/component-version: 1.custom55.custom3-20240906.custom1725651207513
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom55.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-analytics-events
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-analytics-events
        app.kubernetes.io/name: sas-analytics-events
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-analytics-events
        sas.com/component-version: 1.custom55.custom3-20240906.custom1725651207513
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom55.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-analytics-events
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.analyticsEvents.sasAnalyticsEvents.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.analyticsEvents.sasAnalyticsEvents.image.repository }}:{{ .Values.analyticsEvents.sasAnalyticsEvents.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsEvents.sasAnalyticsEvents.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-analytics-events
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.analyticsEvents.sasAnalyticsEvents.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsEvents.sasAnalyticsEvents.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.analyticsEvents.sasStartSequencer.image.repository }}:{{ .Values.analyticsEvents.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsEvents.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.analyticsEvents.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsEvents.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.analyticsEvents.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.analyticsEvents.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.analyticsEvents.sasCertframe.image.repository }}:{{ .Values.analyticsEvents.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.analyticsEvents.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsEvents.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.analyticsEvents.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.analyticsEvents.hydrator.image.repository }}:{{ .Values.analyticsEvents.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsEvents.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.analyticsEvents.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsEvents.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.analyticsEvents.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.analyticsEvents.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.analyticsEvents.sasDbMigrator.image.repository }}:{{ .Values.analyticsEvents.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsEvents.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.analyticsEvents.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsEvents.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.analyticsEvents.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-analytics-execution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-analytics-execution
    sas.com/component-version: 1.custom30.custom5-20241009.custom1728486189049
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom30.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-analytics-execution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-analytics-execution
        app.kubernetes.io/name: sas-analytics-execution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-analytics-execution
        sas.com/component-version: 1.custom30.custom5-20241009.custom1728486189049
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom30.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-analytics-execution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.analyticsExecution.sasAnalyticsExecution.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.analyticsExecution.sasAnalyticsExecution.image.repository }}:{{
          .Values.analyticsExecution.sasAnalyticsExecution.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.analyticsExecution.sasAnalyticsExecution.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-analytics-execution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.analyticsExecution.sasAnalyticsExecution.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsExecution.sasAnalyticsExecution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.analyticsExecution.sasStartSequencer.image.repository }}:{{ .Values.analyticsExecution.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsExecution.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.analyticsExecution.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsExecution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.analyticsExecution.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.analyticsExecution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.analyticsExecution.sasCertframe.image.repository }}:{{ .Values.analyticsExecution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.analyticsExecution.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsExecution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.analyticsExecution.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.analyticsExecution.hydrator.image.repository }}:{{ .Values.analyticsExecution.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsExecution.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.analyticsExecution.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.analyticsExecution.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.analyticsExecution.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.analyticsExecution.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.analyticsExecution.sasDbMigrator.image.repository }}:{{ .Values.analyticsExecution.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsExecution.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.analyticsExecution.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsExecution.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.analyticsExecution.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-analytics-gateway
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-analytics-gateway
    sas.com/component-version: 31.custom0.custom7-20241104.custom1730738917751
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 31.custom0.custom7
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-analytics-gateway
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-analytics-gateway
        app.kubernetes.io/name: sas-analytics-gateway
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-analytics-gateway
        sas.com/component-version: 31.custom0.custom7-20241104.custom1730738917751
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 31.custom0.custom7
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-analytics-gateway
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.analyticsGateway.sasAnalyticsGateway.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.analyticsGateway.sasAnalyticsGateway.image.repository }}:{{ .Values.analyticsGateway.sasAnalyticsGateway.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsGateway.sasAnalyticsGateway.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-analytics-gateway
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.analyticsGateway.sasAnalyticsGateway.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsGateway.sasAnalyticsGateway.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.analyticsGateway.sasStartSequencer.image.repository }}:{{ .Values.analyticsGateway.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsGateway.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.analyticsGateway.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsGateway.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.analyticsGateway.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.analyticsGateway.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.analyticsGateway.sasCertframe.image.repository }}:{{ .Values.analyticsGateway.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.analyticsGateway.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsGateway.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.analyticsGateway.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-analytics-resources
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-analytics-resources
    sas.com/component-version: 22.custom27.custom13-20240910.custom1725980964443
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 22.custom27.custom13
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-analytics-resources
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-analytics-resources
        app.kubernetes.io/name: sas-analytics-resources
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-analytics-resources
        sas.com/component-version: 22.custom27.custom13-20240910.custom1725980964443
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 22.custom27.custom13
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-analytics-resources
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.analyticsResources.sasAnalyticsResources.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.analyticsResources.sasAnalyticsResources.image.repository }}:{{
          .Values.analyticsResources.sasAnalyticsResources.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.analyticsResources.sasAnalyticsResources.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-analytics-resources
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.analyticsResources.sasAnalyticsResources.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsResources.sasAnalyticsResources.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.analyticsResources.sasStartSequencer.image.repository }}:{{ .Values.analyticsResources.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsResources.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.analyticsResources.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.analyticsResources.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.analyticsResources.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.analyticsResources.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.analyticsResources.sasCertframe.image.repository }}:{{ .Values.analyticsResources.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.analyticsResources.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsResources.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.analyticsResources.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.analyticsResources.hydrator.image.repository }}:{{ .Values.analyticsResources.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsResources.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.analyticsResources.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.analyticsResources.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.analyticsResources.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.analyticsResources.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.analyticsResources.sasDbMigrator.image.repository }}:{{ .Values.analyticsResources.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.analyticsResources.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.analyticsResources.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.analyticsResources.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.analyticsResources.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-annotations
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-annotations
    sas.com/component-version: 2.custom67.custom0-20240906.custom1725614005478
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom67.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-annotations
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-annotations
        app.kubernetes.io/name: sas-annotations
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-annotations
        sas.com/component-version: 2.custom67.custom0-20240906.custom1725614005478
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom67.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-annotations
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.annotations.sasAnnotations.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.annotations.sasAnnotations.image.repository }}:{{ .Values.annotations.sasAnnotations.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.annotations.sasAnnotations.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-annotations
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.annotations.sasAnnotations.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.annotations.sasAnnotations.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.annotations.sasStartSequencer.image.repository }}:{{ .Values.annotations.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.annotations.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.annotations.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.annotations.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.annotations.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.annotations.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.annotations.sasCertframe.image.repository }}:{{ .Values.annotations.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.annotations.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.annotations.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.annotations.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.annotations.hydrator.image.repository }}:{{ .Values.annotations.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.annotations.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.annotations.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.annotations.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.annotations.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.annotations.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.annotations.sasDbMigrator.image.repository }}:{{ .Values.annotations.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.annotations.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.annotations.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.annotations.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.annotations.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-app-registry
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-app-registry
    sas.com/component-version: 1.custom104.custom8-20240906.custom1725626648630
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom104.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-app-registry
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-app-registry
        app.kubernetes.io/name: sas-app-registry
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-app-registry
        sas.com/component-version: 1.custom104.custom8-20240906.custom1725626648630
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom104.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-app-registry
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.appRegistry.sasAppRegistry.env.sasK8SDeploymentName }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_VERSION
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_VERSION
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_RELEASE
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_RELEASE
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.appRegistry.sasAppRegistry.image.repository }}:{{ .Values.appRegistry.sasAppRegistry.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.appRegistry.sasAppRegistry.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-app-registry
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.appRegistry.sasAppRegistry.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.appRegistry.sasAppRegistry.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.appRegistry.sasStartSequencer.image.repository }}:{{ .Values.appRegistry.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.appRegistry.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.appRegistry.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.appRegistry.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.appRegistry.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.appRegistry.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.appRegistry.sasCertframe.image.repository }}:{{ .Values.appRegistry.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.appRegistry.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.appRegistry.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.appRegistry.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.appRegistry.hydrator.image.repository }}:{{ .Values.appRegistry.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.appRegistry.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.appRegistry.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.appRegistry.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.appRegistry.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.appRegistry.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.appRegistry.sasDbMigrator.image.repository }}:{{ .Values.appRegistry.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.appRegistry.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.appRegistry.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.appRegistry.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.appRegistry.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-arke
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-arke
    sas.com/component-version: 1.custom35.custom0-20240911.custom1726079412665
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: exec
    sas.com/pod-uses-readiness-probe: exec
    sas.com/pod-uses-startup-probe: exec
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom35.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-arke
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-arke
        app.kubernetes.io/name: sas-arke
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "50051"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-arke
        sas.com/component-version: 1.custom35.custom0-20240911.custom1726079412665
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: exec
        sas.com/pod-uses-readiness-probe: exec
        sas.com/pod-uses-startup-probe: exec
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom35.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-arke
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.arke.sasArke.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.arke.sasArke.image.repository }}:{{ .Values.arke.sasArke.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.arke.sasArke.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          exec:
            command:
            - /opt/sas/viya/home/bin/sas-arke-probe
          initialDelaySeconds: 5
          periodSeconds: 30
          timeoutSeconds: 10
        name: sas-arke
        ports:
        - containerPort: 50051
          name: tcp
          protocol: TCP
        readinessProbe:
          exec:
            command:
            - /opt/sas/viya/home/bin/sas-arke-probe
          initialDelaySeconds: 5
          timeoutSeconds: 10
        resources: {{- toYaml .Values.arke.sasArke.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.arke.sasArke.containerSecurityContext | nindent
          10 }}
        startupProbe:
          exec:
            command:
            - /opt/sas/viya/home/bin/sas-arke-probe
          failureThreshold: 30
          periodSeconds: 10
          timeoutSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.arke.sasStartSequencer.image.repository }}:{{ .Values.arke.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.arke.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.arke.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.arke.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.arke.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.arke.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.arke.sasCertframe.image.repository }}:{{ .Values.arke.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.arke.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.arke.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.arke.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-arke
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-audit
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-audit
    sas.com/component-version: 1.custom120.custom2-20240912.custom1726139643916
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom120.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-audit
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-audit
        app.kubernetes.io/name: sas-audit
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-audit
        sas.com/component-version: 1.custom120.custom2-20240912.custom1726139643916
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom120.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-audit
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.audit.sasAudit.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.audit.sasAudit.image.repository }}:{{ .Values.audit.sasAudit.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.audit.sasAudit.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-audit
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.audit.sasAudit.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.audit.sasAudit.containerSecurityContext | nindent
          10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.audit.sasStartSequencer.image.repository }}:{{ .Values.audit.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.audit.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.audit.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.audit.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.audit.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.audit.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.audit.sasCertframe.image.repository }}:{{ .Values.audit.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.audit.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.audit.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.audit.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.audit.hydrator.image.repository }}:{{ .Values.audit.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.audit.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.audit.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.audit.hydrator.containerSecurityContext | nindent
          10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.audit.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.audit.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.audit.sasDbMigrator.image.repository }}:{{ .Values.audit.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.audit.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.audit.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.audit.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.audit.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-audit
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-authorization
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-authorization
    sas.com/component-version: 4.custom22.custom3-20240924.custom1727220107043
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom22.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-authorization
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-authorization
        app.kubernetes.io/name: sas-authorization
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-authorization
        sas.com/component-version: 4.custom22.custom3-20240924.custom1727220107043
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom22.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-authorization
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.authorization.sasAuthorization.env.sasK8SDeploymentName
            }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.authorization.sasAuthorization.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.authorization.sasAuthorization.env.javaOptionXss }}
        - name: JAVA_OPTION_XMS
          value: {{ quote .Values.authorization.sasAuthorization.env.javaOptionXms }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.authorization.sasAuthorization.image.repository }}:{{ .Values.authorization.sasAuthorization.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.authorization.sasAuthorization.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-authorization
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.authorization.sasAuthorization.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.authorization.sasAuthorization.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.authorization.sasStartSequencer.image.repository }}:{{ .Values.authorization.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.authorization.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.authorization.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.authorization.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.authorization.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.authorization.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.authorization.sasCertframe.image.repository }}:{{ .Values.authorization.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.authorization.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.authorization.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.authorization.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-batch
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-batch
    sas.com/component-version: 1.custom26.custom8-20240909.custom1725906983134
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom26.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-batch
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-batch
        app.kubernetes.io/name: sas-batch
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-batch
        sas.com/component-version: 1.custom26.custom8-20240909.custom1725906983134
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom26.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-batch
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.batch.sasBatch.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.batch.sasBatch.image.repository }}:{{ .Values.batch.sasBatch.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.batch.sasBatch.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-batch
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.batch.sasBatch.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.batch.sasBatch.containerSecurityContext | nindent
          10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.batch.sasStartSequencer.image.repository }}:{{ .Values.batch.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.batch.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.batch.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.batch.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.batch.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.batch.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.batch.sasCertframe.image.repository }}:{{ .Values.batch.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.batch.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.batch.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.batch.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.batch.hydrator.image.repository }}:{{ .Values.batch.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.batch.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.batch.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.batch.hydrator.containerSecurityContext | nindent
          10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.batch.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.batch.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.batch.sasDbMigrator.image.repository }}:{{ .Values.batch.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.batch.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.batch.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.batch.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.batch.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-business-rules
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-business-rules
    sas.com/component-version: 9.custom4.custom15-20241203.custom1733239133648
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 9.custom4.custom15
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-business-rules
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-business-rules
        app.kubernetes.io/name: sas-business-rules
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-business-rules
        sas.com/component-version: 9.custom4.custom15-20241203.custom1733239133648
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 9.custom4.custom15
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-business-rules
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.businessRules.sasBusinessRules.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.businessRules.sasBusinessRules.image.repository }}:{{ .Values.businessRules.sasBusinessRules.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.businessRules.sasBusinessRules.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-business-rules
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.businessRules.sasBusinessRules.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.businessRules.sasBusinessRules.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.businessRules.sasStartSequencer.image.repository }}:{{ .Values.businessRules.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.businessRules.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.businessRules.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.businessRules.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.businessRules.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.businessRules.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.businessRules.sasCertframe.image.repository }}:{{ .Values.businessRules.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.businessRules.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.businessRules.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.businessRules.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-cas-control
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-cas-control
    sas.com/component-version: 2.custom34.custom16-20240918.custom1726669153356
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom34.custom16
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-cas-control
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-cas-control
        app.kubernetes.io/name: sas-cas-control
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-cas-control
        sas.com/component-version: 2.custom34.custom16-20240918.custom1726669153356
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom34.custom16
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-cas-control
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.casControl.sasCasControl.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.casControl.sasCasControl.image.repository }}:{{ .Values.casControl.sasCasControl.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.casControl.sasCasControl.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-cas-control
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.casControl.sasCasControl.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.casControl.sasCasControl.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.casControl.sasStartSequencer.image.repository }}:{{ .Values.casControl.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.casControl.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.casControl.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.casControl.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.casControl.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.casControl.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.casControl.sasCertframe.image.repository }}:{{ .Values.casControl.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.casControl.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.casControl.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.casControl.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-cas-control
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-cas-operator
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    sas.com/zero-scale-phase: "1"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-cas-operator
    sas.com/component-version: 3.custom48.custom4-20241014.custom1728921008318
    sas.com/kustomize-base: golang
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom48.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  replicas: {{ .Values.casOperator.replicas }}
  selector:
    matchLabels:
      name: sas-cas-operator
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-cas-operator
        app.kubernetes.io/name: sas-cas-operator
        name: sas-cas-operator
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "8383"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-cas-operator
        sas.com/component-version: 3.custom48.custom4-20241014.custom1728921008318
        sas.com/kustomize-base: golang
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom48.custom4
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-cas-operator
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - command:
        - /opt/sas/viya/home/bin/cas
        env:
        - name: SAS_LICENSE
          valueFrom:
            secretKeyRef:
              key: SAS_LICENSE
              name: {{ include "sas-viya-helm.fullname" . }}-license-996thbcbkg
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: OPERATOR_NAME
          value: {{ quote .Values.casOperator.sasCasOperator.env.operatorName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-ingress-input-f7cb564t8c
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        image: {{ .Values.casOperator.sasCasOperator.image.repository }}:{{ .Values.casOperator.sasCasOperator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.casOperator.sasCasOperator.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: sas-cas-operator
        resources: {{- toYaml .Values.casOperator.sasCasOperator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.casOperator.sasCasOperator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /etc/podinfo
          name: podinfo
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.casOperator.sasStartSequencer.image.repository }}:{{ .Values.casOperator.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.casOperator.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.casOperator.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.casOperator.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.casOperator.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.casOperator.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.casOperator.sasCertframe.image.repository }}:{{ .Values.casOperator.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.casOperator.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.casOperator.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.casOperator.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-cas-operator
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - downwardAPI:
          items:
          - fieldRef:
              fieldPath: metadata.annotations
            path: annotations
        name: podinfo
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-catalog-services
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-catalog-services
    sas.com/component-version: 4.custom77.custom1-20241015.custom1729008790662
    sas.com/elasticsearch-consumer: "true"
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom77.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-catalog-services
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-catalog-services
        app.kubernetes.io/name: sas-catalog-services
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-catalog-services
        sas.com/component-version: 4.custom77.custom1-20241015.custom1729008790662
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom77.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-catalog-services
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.catalogServices.sasCatalogServices.env.sasK8SDeploymentName
            }}
        - name: SAS_ELASTICSEARCH_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: sas-opendistro-sasadmin-secret
        - name: SAS_ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: sas-opendistro-sasadmin-secret
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-catalog-database-config-5bm8kcc9c6
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-catalog-security-config-ckgd62ctgd
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-catalog-services-config-6ct58987ht
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-opendistro-client-config-8dhffhdk25
        image: {{ .Values.catalogServices.sasCatalogServices.image.repository }}:{{ .Values.catalogServices.sasCatalogServices.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.catalogServices.sasCatalogServices.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-catalog-services
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.catalogServices.sasCatalogServices.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.catalogServices.sasCatalogServices.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.catalogServices.sasStartSequencer.image.repository }}:{{ .Values.catalogServices.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.catalogServices.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.catalogServices.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.catalogServices.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.catalogServices.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.catalogServices.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.catalogServices.sasCertframe.image.repository }}:{{ .Values.catalogServices.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.catalogServices.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.catalogServices.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.catalogServices.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.catalogServices.hydrator.image.repository }}:{{ .Values.catalogServices.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.catalogServices.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.catalogServices.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.catalogServices.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.catalogServices.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.catalogServices.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.catalogServices.sasDbMigrator.image.repository }}:{{ .Values.catalogServices.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.catalogServices.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.catalogServices.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.catalogServices.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.catalogServices.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-chromium-server
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-chromium-server
    sas.com/component-version: 1.custom25.custom0-20240905.custom1725569346373
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom25.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-chromium-server
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-chromium-server
        app.kubernetes.io/name: sas-chromium-server
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-chromium-server
        sas.com/component-version: 1.custom25.custom0-20240905.custom1725569346373
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom25.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-chromium-server
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.chromiumServer.sasChromiumServer.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.chromiumServer.sasChromiumServer.image.repository }}:{{ .Values.chromiumServer.sasChromiumServer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.chromiumServer.sasChromiumServer.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-chromium-server
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.chromiumServer.sasChromiumServer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.chromiumServer.sasChromiumServer.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/home/share/sas-chromium-server/meta/chromium_policies/02-custom-policies.json
          name: chromium-policies
          subPath: 02-custom-policies.json
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.chromiumServer.sasStartSequencer.image.repository }}:{{ .Values.chromiumServer.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.chromiumServer.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.chromiumServer.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.chromiumServer.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.chromiumServer.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.chromiumServer.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.chromiumServer.sasCertframe.image.repository }}:{{ .Values.chromiumServer.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.chromiumServer.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.chromiumServer.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.chromiumServer.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-chromium-server-chromium-policies-hkgb67fbt7
        name: chromium-policies
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-code-debugger
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-code-debugger
    sas.com/component-version: 2.custom21.custom0-20240912.custom1726168130498
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom21.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-code-debugger
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-code-debugger
        app.kubernetes.io/name: sas-code-debugger
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-code-debugger
        sas.com/component-version: 2.custom21.custom0-20240912.custom1726168130498
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom21.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-code-debugger
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.codeDebugger.sasCodeDebugger.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.codeDebugger.sasCodeDebugger.image.repository }}:{{ .Values.codeDebugger.sasCodeDebugger.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.codeDebugger.sasCodeDebugger.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-code-debugger
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.codeDebugger.sasCodeDebugger.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.codeDebugger.sasCodeDebugger.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.codeDebugger.sasStartSequencer.image.repository }}:{{ .Values.codeDebugger.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.codeDebugger.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.codeDebugger.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.codeDebugger.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.codeDebugger.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.codeDebugger.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.codeDebugger.sasCertframe.image.repository }}:{{ .Values.codeDebugger.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.codeDebugger.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.codeDebugger.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.codeDebugger.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-code-debugger-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-code-debugger-app
    sas.com/component-version: 2.custom35.custom0-20240912.custom1726183746227
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom35.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-code-debugger-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-code-debugger-app
        app.kubernetes.io/name: sas-code-debugger-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-code-debugger-app
        sas.com/component-version: 2.custom35.custom0-20240912.custom1726183746227
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom35.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-code-debugger-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.codeDebuggerApp.sasCodeDebuggerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.codeDebuggerApp.sasCodeDebuggerApp.image.repository }}:{{ .Values.codeDebuggerApp.sasCodeDebuggerApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.codeDebuggerApp.sasCodeDebuggerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-code-debugger-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.codeDebuggerApp.sasCodeDebuggerApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.codeDebuggerApp.sasCodeDebuggerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.codeDebuggerApp.sasStartSequencer.image.repository }}:{{ .Values.codeDebuggerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.codeDebuggerApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.codeDebuggerApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.codeDebuggerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.codeDebuggerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.codeDebuggerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.codeDebuggerApp.sasCertframe.image.repository }}:{{ .Values.codeDebuggerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.codeDebuggerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.codeDebuggerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.codeDebuggerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-collaboration
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-collaboration
    sas.com/component-version: 2.custom512.custom3-20240920.custom1726812276887
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom512.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-collaboration
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-collaboration
        app.kubernetes.io/name: sas-collaboration
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-collaboration
        sas.com/component-version: 2.custom512.custom3-20240920.custom1726812276887
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom512.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-collaboration
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.collaboration.sasCollaboration.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.collaboration.sasCollaboration.image.repository }}:{{ .Values.collaboration.sasCollaboration.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.collaboration.sasCollaboration.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-collaboration
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.collaboration.sasCollaboration.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.collaboration.sasCollaboration.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.collaboration.sasStartSequencer.image.repository }}:{{ .Values.collaboration.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.collaboration.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.collaboration.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.collaboration.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.collaboration.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.collaboration.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.collaboration.sasCertframe.image.repository }}:{{ .Values.collaboration.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.collaboration.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.collaboration.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.collaboration.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.collaboration.hydrator.image.repository }}:{{ .Values.collaboration.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.collaboration.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.collaboration.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.collaboration.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.collaboration.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.collaboration.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.collaboration.sasDbMigrator.image.repository }}:{{ .Values.collaboration.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.collaboration.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.collaboration.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.collaboration.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.collaboration.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-compute
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-compute
    sas.com/component-version: 1.custom82.custom19-20241107.custom1731004551012
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom82.custom19
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-compute
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-compute
        app.kubernetes.io/name: sas-compute
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-compute
        sas.com/component-version: 1.custom82.custom19-20241107.custom1731004551012
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom82.custom19
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-compute
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.compute.sasCompute.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-compute-config-mh7659gcm9
        image: {{ .Values.compute.sasCompute.image.repository }}:{{ .Values.compute.sasCompute.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.compute.sasCompute.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-compute
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.compute.sasCompute.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.compute.sasCompute.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.compute.sasStartSequencer.image.repository }}:{{ .Values.compute.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.compute.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.compute.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.compute.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.compute.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.compute.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.compute.sasCertframe.image.repository }}:{{ .Values.compute.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.compute.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.compute.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.compute.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.compute.hydrator.image.repository }}:{{ .Values.compute.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.compute.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.compute.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.compute.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.compute.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.compute.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.compute.sasDbMigrator.image.repository }}:{{ .Values.compute.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.compute.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.compute.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.compute.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.compute.podSecurityContext | nindent 8 }}
      terminationGracePeriodSeconds: 60
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-config-reconciler
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-config-reconciler
    sas.com/component-version: 1.custom25.custom4-20240909.custom1725899831453
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom25.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-config-reconciler
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-config-reconciler
        app.kubernetes.io/name: sas-config-reconciler
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-config-reconciler
        sas.com/component-version: 1.custom25.custom4-20240909.custom1725899831453
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom25.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-config-reconciler
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.configReconciler.sasConfigReconciler.env.sasK8SDeploymentName
            }}
        - name: SAS_K8S_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.configReconciler.sasConfigReconciler.image.repository }}:{{ .Values.configReconciler.sasConfigReconciler.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.configReconciler.sasConfigReconciler.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-config-reconciler
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.configReconciler.sasConfigReconciler.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.configReconciler.sasConfigReconciler.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.configReconciler.sasStartSequencer.image.repository }}:{{ .Values.configReconciler.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.configReconciler.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.configReconciler.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.configReconciler.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.configReconciler.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.configReconciler.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.configReconciler.sasCertframe.image.repository }}:{{ .Values.configReconciler.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.configReconciler.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.configReconciler.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.configReconciler.podSecurityContext | nindent
        8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-config-reconciler
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-configuration
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-configuration
    sas.com/component-version: 2.custom14.custom2-20240913.custom1726234091325
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom14.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-configuration
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-configuration
        app.kubernetes.io/name: sas-configuration
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-configuration
        sas.com/component-version: 2.custom14.custom2-20240913.custom1726234091325
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom14.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-configuration
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.configuration.sasConfiguration.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.configuration.sasConfiguration.image.repository }}:{{ .Values.configuration.sasConfiguration.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.configuration.sasConfiguration.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-configuration
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.configuration.sasConfiguration.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.configuration.sasConfiguration.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.configuration.sasStartSequencer.image.repository }}:{{ .Values.configuration.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.configuration.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.configuration.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.configuration.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.configuration.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.configuration.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.configuration.sasCertframe.image.repository }}:{{ .Values.configuration.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.configuration.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.configuration.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.configuration.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-connect
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-connect
    sas.com/component-version: 4.custom42.custom5-20240910.custom1725994095117
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom42.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-connect
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-connect
        app.kubernetes.io/name: sas-connect
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-connect
        sas.com/component-version: 4.custom42.custom5-20240910.custom1725994095117
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom42.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-connect
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.connect.sasConnect.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.connect.sasConnect.image.repository }}:{{ .Values.connect.sasConnect.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connect.sasConnect.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-connect
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.connect.sasConnect.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.connect.sasConnect.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.connect.sasStartSequencer.image.repository }}:{{ .Values.connect.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connect.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.connect.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.connect.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.connect.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.connect.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.connect.sasCertframe.image.repository }}:{{ .Values.connect.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.connect.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.connect.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.connect.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.connect.hydrator.image.repository }}:{{ .Values.connect.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connect.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.connect.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.connect.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.connect.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.connect.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.connect.sasDbMigrator.image.repository }}:{{ .Values.connect.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connect.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.connect.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.connect.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.connect.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-connect-spawner
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-connect-spawner
    sas.com/component-version: 1.custom0.custom34-20241218.custom1734538224370
    sas.com/config-init-mode: initcontainer
    sas.com/kustomize-base: base
    sas.com/sas-access-config: "true"
    sas.com/sas-kerberos-config: "true"
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom0.custom34
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-connect-spawner
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-connect-spawner
        app.kubernetes.io/name: sas-connect-spawner
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-connect-spawner
        sas.com/component-version: 1.custom0.custom34-20241218.custom1734538224370
        sas.com/config-init-mode: initcontainer
        sas.com/kustomize-base: base
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom0.custom34
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-connect-spawner
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.connectSpawner.sasConnectSpawner.env.sasK8SDeploymentName
            }}
        - name: SAS_LICENSE
          valueFrom:
            secretKeyRef:
              key: SAS_LICENSE
              name: {{ include "sas-viya-helm.fullname" . }}-license-996thbcbkg
        - name: POD_IP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.podIP
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-connect-spawner-config-c5g6cd8kd9
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-launcher-lockdown-config-89fc9dc5c6
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-programming-environment-path-config-889g58mm7g
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-access-config-mm6fhg8gc7
        image: {{ .Values.connectSpawner.sasConnectSpawner.image.repository }}:{{ .Values.connectSpawner.sasConnectSpawner.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connectSpawner.sasConnectSpawner.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - /opt/sas/viya/home/bin/unregister_connect.sh
        name: sas-connect-spawner
        ports:
        - containerPort: 17550
          name: sasdaemonsvc
          protocol: TCP
        - containerPort: 17551
          name: service
          protocol: TCP
        - containerPort: 17541
          name: mgmtport
          protocol: TCP
        readinessProbe:
          tcpSocket:
            port: mgmtport
        resources: {{- toYaml .Values.connectSpawner.sasConnectSpawner.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.connectSpawner.sasConnectSpawner.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /sashelp
          name: sashelp
        - mountPath: /sasuser
          name: sasuser
        - mountPath: /config
          name: config
        - mountPath: /var/lib/sss
          name: sss
        - mountPath: /opt/sas/viya/home/SASFoundation/install/log
          name: home-sasfoundation-install-log
        - mountPath: /opt/sas/viya/config/var
          name: config-var
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
        - mountPath: /access-clients
          name: access-clients
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.connectSpawner.sasStartSequencer.image.repository }}:{{ .Values.connectSpawner.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.connectSpawner.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.connectSpawner.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.connectSpawner.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.connectSpawner.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.connectSpawner.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: SAS_CERTIFICATE_PRIVATE_KEY_PERMISSIONS
          value: {{ quote .Values.connectSpawner.sasCertframe.env.sasCertificatePrivateKeyPermissions
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.connectSpawner.sasCertframe.image.repository }}:{{ .Values.connectSpawner.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.connectSpawner.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.connectSpawner.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.connectSpawner.sasConnectConfigSetup.args | nindent 8
          }}
        command:
        - /bin/bash
        env:
        - name: SSL_CERT_FILE
          value: {{ quote .Values.connectSpawner.sasConnectConfigSetup.env.sslCertFile
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-connect-spawner-config-c5g6cd8kd9
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-launcher-lockdown-config-89fc9dc5c6
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-programming-environment-path-config-889g58mm7g
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.connectSpawner.sasConnectConfigSetup.image.repository }}:{{ .Values.connectSpawner.sasConnectConfigSetup.image.tag
          | default .Chart.AppVersion }}
        name: sas-connect-config-setup
        resources: {{- toYaml .Values.connectSpawner.sasConnectConfigSetup.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.connectSpawner.sasConnectConfigSetup.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/var
          name: config-var
        - mountPath: /security
          name: security
      - env:
        - name: SSL_CERT_FILE
          value: {{ quote .Values.connectSpawner.sasConfigInit.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-connect-spawner-config-c5g6cd8kd9
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-launcher-lockdown-config-89fc9dc5c6
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-programming-environment-path-config-889g58mm7g
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-launcher-init-nls-config-9d6k8f9hcd
        image: {{ .Values.connectSpawner.sasConfigInit.image.repository }}:{{ .Values.connectSpawner.sasConfigInit.image.tag
          | default .Chart.AppVersion }}
        name: sas-config-init
        resources: {{- toYaml .Values.connectSpawner.sasConfigInit.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.connectSpawner.sasConfigInit.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /config
          name: config
        - mountPath: /opt/sas/viya/config/var
          name: config-var
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.connectSpawner.podSecurityContext | nindent 8
        }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-connect-spawner
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: sashelp
      - emptyDir: {}
        name: sasuser
      - emptyDir: {}
        name: config
      - emptyDir: {}
        name: sss
      - emptyDir: {}
        name: home-sasfoundation-install-log
      - emptyDir: {}
        name: config-var
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
      - name: access-clients
        nfs:
          path: /NAS_SAS_VIYA_DATA_PRD/access-clients
          server: 10.custom227.custom69.custom177
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-content
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-content
    sas.com/component-version: 1.custom110.custom13-20240909.custom1725902073585
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom110.custom13
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-content
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-content
        app.kubernetes.io/name: sas-content
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-content
        sas.com/component-version: 1.custom110.custom13-20240909.custom1725902073585
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom110.custom13
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-content
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.content.sasContent.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.content.sasContent.image.repository }}:{{ .Values.content.sasContent.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.content.sasContent.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-content
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.content.sasContent.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.content.sasContent.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.content.sasStartSequencer.image.repository }}:{{ .Values.content.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.content.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.content.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.content.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.content.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.content.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.content.sasCertframe.image.repository }}:{{ .Values.content.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.content.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.content.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.content.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.content.hydrator.image.repository }}:{{ .Values.content.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.content.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.content.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.content.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.content.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.content.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.content.sasDbMigrator.image.repository }}:{{ .Values.content.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.content.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.content.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.content.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.content.podSecurityContext | nindent 8 }}
      terminationGracePeriodSeconds: 60
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-credentials
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-credentials
    sas.com/component-version: 2.custom20.custom2-20240911.custom1726083078839
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom20.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-credentials
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-credentials
        app.kubernetes.io/name: sas-credentials
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-credentials
        sas.com/component-version: 2.custom20.custom2-20240911.custom1726083078839
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom20.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-credentials
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.credentials.sasCredentials.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.credentials.sasCredentials.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.credentials.sasCredentials.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.credentials.sasCredentials.image.repository }}:{{ .Values.credentials.sasCredentials.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.credentials.sasCredentials.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-credentials
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.credentials.sasCredentials.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.credentials.sasCredentials.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.credentials.sasStartSequencer.image.repository }}:{{ .Values.credentials.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.credentials.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.credentials.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.credentials.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.credentials.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.credentials.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.credentials.sasCertframe.image.repository }}:{{ .Values.credentials.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.credentials.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.credentials.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.credentials.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-crunchy5-postgres-operator
  labels:
    postgres-operator.crunchydata.com/control-plane: postgres-operator
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/uses-start-sequencer: "true"
    sas.com/zero-scale-phase: "1"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/crunchy-platform-postgres: "true"
    sas.com/tls-mode: full-stack
spec:
  replicas: {{ .Values.crunchy5PostgresOperator.replicas }}
  strategy:
    type: {{ .Values.crunchy5PostgresOperator.strategy.type | quote }}
  selector:
    matchLabels:
      postgres-operator.crunchydata.com/control-plane: postgres-operator
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: pgo
        app.kubernetes.io/version: 5.custom6.custom1
        postgres-operator.crunchydata.com/control-plane: postgres-operator
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/scheme: https
        sas.com/certificate-file-format: pem
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
      containers:
      - env:
        - name: PGO_TARGET_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: PGO_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: CRUNCHY_DEBUG
          value: {{ quote .Values.crunchy5PostgresOperator.operator.env.crunchyDebug }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.crunchy5PostgresOperator.operator.image.repository }}:{{ .Values.crunchy5PostgresOperator.operator.image.tag
          | default .Chart.AppVersion }}
        name: operator
        resources: {}
        securityContext: {{- toYaml .Values.crunchy5PostgresOperator.operator.containerSecurityContext
          | nindent 10 }}
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.crunchy5PostgresOperator.sasStartSequencer.image.repository }}:{{
          .Values.crunchy5PostgresOperator.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.crunchy5PostgresOperator.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.crunchy5PostgresOperator.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.crunchy5PostgresOperator.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.env.sasAdditionalCaCertificatesDir
            }}
        - name: SAS_CERTIFICATE_SECRET_NAME
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.env.sasCertificateSecretName
            }}
        - name: SAS_CERTIFICATE_COMMON_NAME
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.env.sasCertificateCommonName
            }}
        - name: SAS_CERTIFICATE_SAN_DNS
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.env.sasCertificateSanDns
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.image.repository
          }}:{{ .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.image.tag
          | default .Chart.AppVersion }}'
        name: sas-certframe-platform-postgres-replication
        resources: {{- toYaml .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.crunchy5PostgresOperator.sasCertframePlatformPostgresReplication.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.env.sasAdditionalCaCertificatesDir
            }}
        - name: SAS_CERTIFICATE_SECRET_NAME
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.env.sasCertificateSecretName
            }}
        - name: SAS_CERTIFICATE_COMMON_NAME
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.env.sasCertificateCommonName
            }}
        - name: SAS_CERTIFICATE_SAN_DNS
          value: {{ quote .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.env.sasCertificateSanDns
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.image.repository
          }}:{{ .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.image.tag
          | default .Chart.AppVersion }}'
        name: sas-certframe-platform-postgres
        resources: {{- toYaml .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.crunchy5PostgresOperator.sasCertframePlatformPostgres.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.crunchy5PostgresOperator.podSecurityContext |
        nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-pgo
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-agent-services
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-agent-services
    sas.com/component-version: 3.custom6.custom1-20240913.custom1726262132769
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom6.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-agent-services
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-agent-services
        app.kubernetes.io/name: sas-data-agent-services
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-agent-services
        sas.com/component-version: 3.custom6.custom1-20240913.custom1726262132769
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom6.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-agent-services
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataAgentServices.sasDataAgentServices.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataAgentServices.sasDataAgentServices.image.repository }}:{{
          .Values.dataAgentServices.sasDataAgentServices.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataAgentServices.sasDataAgentServices.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-agent-services
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataAgentServices.sasDataAgentServices.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataAgentServices.sasDataAgentServices.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataAgentServices.sasStartSequencer.image.repository }}:{{ .Values.dataAgentServices.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataAgentServices.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataAgentServices.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataAgentServices.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataAgentServices.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataAgentServices.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataAgentServices.sasCertframe.image.repository }}:{{ .Values.dataAgentServices.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataAgentServices.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataAgentServices.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataAgentServices.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-explorer-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-data-explorer-app
    sas.com/component-version: 2.custom171.custom2-20240916.custom1726469091505
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom171.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-explorer-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-explorer-app
        app.kubernetes.io/name: sas-data-explorer-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-data-explorer-app
        sas.com/component-version: 2.custom171.custom2-20240916.custom1726469091505
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom171.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-explorer-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataExplorerApp.sasDataExplorerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.dataExplorerApp.sasDataExplorerApp.image.repository }}:{{ .Values.dataExplorerApp.sasDataExplorerApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataExplorerApp.sasDataExplorerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-explorer-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataExplorerApp.sasDataExplorerApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataExplorerApp.sasDataExplorerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataExplorerApp.sasStartSequencer.image.repository }}:{{ .Values.dataExplorerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataExplorerApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataExplorerApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataExplorerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataExplorerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataExplorerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataExplorerApp.sasCertframe.image.repository }}:{{ .Values.dataExplorerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataExplorerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataExplorerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataExplorerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-flows
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-flows
    sas.com/component-version: 1.custom66.custom4-20241111.custom1731351116523
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom66.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-flows
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-flows
        app.kubernetes.io/name: sas-data-flows
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-flows
        sas.com/component-version: 1.custom66.custom4-20241111.custom1731351116523
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom66.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-flows
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataFlows.sasDataFlows.env.sasK8SDeploymentName }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_VERSION
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_VERSION
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_RELEASE
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_RELEASE
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataFlows.sasDataFlows.image.repository }}:{{ .Values.dataFlows.sasDataFlows.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataFlows.sasDataFlows.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-flows
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataFlows.sasDataFlows.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataFlows.sasDataFlows.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataFlows.sasStartSequencer.image.repository }}:{{ .Values.dataFlows.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataFlows.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataFlows.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataFlows.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataFlows.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataFlows.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataFlows.sasCertframe.image.repository }}:{{ .Values.dataFlows.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataFlows.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataFlows.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataFlows.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataFlows.hydrator.image.repository }}:{{ .Values.dataFlows.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataFlows.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.dataFlows.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataFlows.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataFlows.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataFlows.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataFlows.sasDbMigrator.image.repository }}:{{ .Values.dataFlows.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataFlows.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataFlows.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataFlows.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataFlows.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-mining-models
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-mining-models
    sas.com/component-version: 39.custom90.custom1-20240909.custom1725899123325
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 39.custom90.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-mining-models
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-mining-models
        app.kubernetes.io/name: sas-data-mining-models
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-mining-models
        sas.com/component-version: 39.custom90.custom1-20240909.custom1725899123325
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 39.custom90.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-mining-models
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataMiningModels.sasDataMiningModels.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataMiningModels.sasDataMiningModels.image.repository }}:{{ .Values.dataMiningModels.sasDataMiningModels.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningModels.sasDataMiningModels.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 20
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-mining-models
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataMiningModels.sasDataMiningModels.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningModels.sasDataMiningModels.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataMiningModels.sasStartSequencer.image.repository }}:{{ .Values.dataMiningModels.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningModels.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataMiningModels.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningModels.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataMiningModels.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataMiningModels.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataMiningModels.sasCertframe.image.repository }}:{{ .Values.dataMiningModels.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataMiningModels.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningModels.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataMiningModels.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataMiningModels.hydrator.image.repository }}:{{ .Values.dataMiningModels.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningModels.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.dataMiningModels.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataMiningModels.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataMiningModels.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataMiningModels.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataMiningModels.sasDbMigrator.image.repository }}:{{ .Values.dataMiningModels.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningModels.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataMiningModels.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningModels.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataMiningModels.podSecurityContext | nindent
        8 }}
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-mining-project-resources
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-mining-project-resources
    sas.com/component-version: 41.custom6.custom2-20240909.custom1725899293195
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 41.custom6.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-mining-project-resources
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-mining-project-resources
        app.kubernetes.io/name: sas-data-mining-project-resources
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-mining-project-resources
        sas.com/component-version: 41.custom6.custom2-20240909.custom1725899293195
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 41.custom6.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-mining-project-resources
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataMiningProjectResources.sasDataMiningProjectResources.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataMiningProjectResources.sasDataMiningProjectResources.image.repository
          }}:{{ .Values.dataMiningProjectResources.sasDataMiningProjectResources.image.tag
          | default .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.dataMiningProjectResources.sasDataMiningProjectResources.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 20
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-mining-project-resources
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataMiningProjectResources.sasDataMiningProjectResources.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningProjectResources.sasDataMiningProjectResources.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.dataMiningProjectResources.sasStartSequencer.image.repository
          }}:{{ .Values.dataMiningProjectResources.sasStartSequencer.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.dataMiningProjectResources.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataMiningProjectResources.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningProjectResources.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataMiningProjectResources.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataMiningProjectResources.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.dataMiningProjectResources.sasCertframe.image.repository }}:{{
          .Values.dataMiningProjectResources.sasCertframe.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe
        resources: {{- toYaml .Values.dataMiningProjectResources.sasCertframe.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningProjectResources.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataMiningProjectResources.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataMiningProjectResources.hydrator.image.repository }}:{{ .Values.dataMiningProjectResources.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningProjectResources.hydrator.imagePullPolicy
          }}
        name: hydrator
        resources: {{- toYaml .Values.dataMiningProjectResources.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningProjectResources.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataMiningProjectResources.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataMiningProjectResources.sasDbMigrator.env.sslCertFile
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataMiningProjectResources.sasDbMigrator.image.repository }}:{{
          .Values.dataMiningProjectResources.sasDbMigrator.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataMiningProjectResources.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataMiningProjectResources.sasDbMigrator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningProjectResources.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataMiningProjectResources.podSecurityContext
        | nindent 8 }}
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-mining-results
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-mining-results
    sas.com/component-version: 40.custom111.custom2-20240909.custom1725899163145
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 40.custom111.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-mining-results
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-mining-results
        app.kubernetes.io/name: sas-data-mining-results
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-mining-results
        sas.com/component-version: 40.custom111.custom2-20240909.custom1725899163145
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 40.custom111.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-mining-results
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataMiningResults.sasDataMiningResults.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataMiningResults.sasDataMiningResults.image.repository }}:{{
          .Values.dataMiningResults.sasDataMiningResults.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataMiningResults.sasDataMiningResults.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 20
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-mining-results
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataMiningResults.sasDataMiningResults.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningResults.sasDataMiningResults.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataMiningResults.sasStartSequencer.image.repository }}:{{ .Values.dataMiningResults.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningResults.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataMiningResults.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningResults.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataMiningResults.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataMiningResults.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataMiningResults.sasCertframe.image.repository }}:{{ .Values.dataMiningResults.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataMiningResults.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningResults.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataMiningResults.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataMiningResults.hydrator.image.repository }}:{{ .Values.dataMiningResults.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningResults.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.dataMiningResults.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataMiningResults.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataMiningResults.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataMiningResults.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataMiningResults.sasDbMigrator.image.repository }}:{{ .Values.dataMiningResults.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataMiningResults.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataMiningResults.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningResults.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataMiningResults.podSecurityContext | nindent
        8 }}
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-mining-risk-models
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-mining-risk-models
    sas.com/component-version: 0.custom59.custom2-20240906.custom1725635029618
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 0.custom59.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-mining-risk-models
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-mining-risk-models
        app.kubernetes.io/name: sas-data-mining-risk-models
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-mining-risk-models
        sas.com/component-version: 0.custom59.custom2-20240906.custom1725635029618
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 0.custom59.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-mining-risk-models
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataMiningRiskModels.sasDataMiningRiskModels.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataMiningRiskModels.sasDataMiningRiskModels.image.repository
          }}:{{ .Values.dataMiningRiskModels.sasDataMiningRiskModels.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.dataMiningRiskModels.sasDataMiningRiskModels.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 20
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-mining-risk-models
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataMiningRiskModels.sasDataMiningRiskModels.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningRiskModels.sasDataMiningRiskModels.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.dataMiningRiskModels.sasStartSequencer.image.repository }}:{{
          .Values.dataMiningRiskModels.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataMiningRiskModels.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataMiningRiskModels.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataMiningRiskModels.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataMiningRiskModels.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataMiningRiskModels.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataMiningRiskModels.sasCertframe.image.repository }}:{{ .Values.dataMiningRiskModels.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataMiningRiskModels.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataMiningRiskModels.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataMiningRiskModels.podSecurityContext | nindent
        8 }}
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-plans
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-data-plans
    sas.com/component-version: 1.custom50.custom10-20240911.custom1726081386421
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom50.custom10
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-plans
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-plans
        app.kubernetes.io/name: sas-data-plans
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-data-plans
        sas.com/component-version: 1.custom50.custom10-20240911.custom1726081386421
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom50.custom10
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-plans
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataPlans.sasDataPlans.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.dataPlans.sasDataPlans.image.repository }}:{{ .Values.dataPlans.sasDataPlans.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataPlans.sasDataPlans.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-plans
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataPlans.sasDataPlans.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataPlans.sasDataPlans.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataPlans.sasStartSequencer.image.repository }}:{{ .Values.dataPlans.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataPlans.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataPlans.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataPlans.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataPlans.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataPlans.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataPlans.sasCertframe.image.repository }}:{{ .Values.dataPlans.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataPlans.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataPlans.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataPlans.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-quality-services
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-quality-services
    sas.com/component-version: 3.custom35.custom5-20240925.custom1727286051346
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom35.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-quality-services
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-quality-services
        app.kubernetes.io/name: sas-data-quality-services
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-quality-services
        sas.com/component-version: 3.custom35.custom5-20240925.custom1727286051346
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom35.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-quality-services
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataQualityServices.sasDataQualityServices.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.dataQualityServices.sasDataQualityServices.image.repository }}:{{
          .Values.dataQualityServices.sasDataQualityServices.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataQualityServices.sasDataQualityServices.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-quality-services
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataQualityServices.sasDataQualityServices.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataQualityServices.sasDataQualityServices.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /qkb
          name: sas-quality-knowledge-base-volume
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.dataQualityServices.sasStartSequencer.image.repository }}:{{
          .Values.dataQualityServices.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataQualityServices.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataQualityServices.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.dataQualityServices.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataQualityServices.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataQualityServices.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataQualityServices.sasCertframe.image.repository }}:{{ .Values.dataQualityServices.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataQualityServices.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataQualityServices.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataQualityServices.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataQualityServices.hydrator.image.repository }}:{{ .Values.dataQualityServices.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataQualityServices.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.dataQualityServices.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataQualityServices.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataQualityServices.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataQualityServices.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataQualityServices.sasDbMigrator.image.repository }}:{{ .Values.dataQualityServices.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataQualityServices.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataQualityServices.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataQualityServices.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataQualityServices.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: sas-quality-knowledge-base-volume
        persistentVolumeClaim:
          claimName: {{ include "sas-viya-helm.fullname" . }}-quality-knowledge-base
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-server-operator
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: controller-manager
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-server-operator
    sas.com/component-version: 22.custom9.custom6-20240906.custom1725645967336
    sas.com/kustomize-base: controller-manager
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 22.custom9.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-server-operator
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-server-operator
        app.kubernetes.io/name: sas-data-server-operator
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/scheme: https
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-server-operator
        sas.com/component-version: 22.custom9.custom6-20240906.custom1725645967336
        sas.com/kustomize-base: controller-manager
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 22.custom9.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-server-operator
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - args: {{- toYaml .Values.dataServerOperator.sasDataServerOperator.args | nindent
          8 }}
        command:
        - /manager
        env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataServerOperator.sasDataServerOperator.env.sasK8SDeploymentName
            }}
        - name: GOPROXY
          value: {{ quote .Values.dataServerOperator.sasDataServerOperator.env.goproxy
            }}
        - name: SAS_LOG_SOURCE
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        image: '{{ .Values.dataServerOperator.sasDataServerOperator.image.repository }}:{{
          .Values.dataServerOperator.sasDataServerOperator.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.dataServerOperator.sasDataServerOperator.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTP
          periodSeconds: 10
        name: sas-data-server-operator
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTP
          periodSeconds: 10
        resources: {{- toYaml .Values.dataServerOperator.sasDataServerOperator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.dataServerOperator.sasDataServerOperator.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTP
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataServerOperator.sasStartSequencer.image.repository }}:{{ .Values.dataServerOperator.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataServerOperator.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataServerOperator.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.dataServerOperator.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataServerOperator.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataServerOperator.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataServerOperator.sasCertframe.image.repository }}:{{ .Values.dataServerOperator.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataServerOperator.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataServerOperator.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataServerOperator.podSecurityContext | nindent
        8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-data-server-operator
      terminationGracePeriodSeconds: 10
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-sources
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-sources
    sas.com/component-version: 3.custom81.custom3-20240913.custom1726256228859
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom81.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-sources
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-sources
        app.kubernetes.io/name: sas-data-sources
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-sources
        sas.com/component-version: 3.custom81.custom3-20240913.custom1726256228859
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom81.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-sources
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataSources.sasDataSources.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataSources.sasDataSources.image.repository }}:{{ .Values.dataSources.sasDataSources.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataSources.sasDataSources.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-sources
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataSources.sasDataSources.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataSources.sasDataSources.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataSources.sasStartSequencer.image.repository }}:{{ .Values.dataSources.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataSources.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataSources.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataSources.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataSources.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataSources.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataSources.sasCertframe.image.repository }}:{{ .Values.dataSources.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataSources.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataSources.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.dataSources.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.dataSources.hydrator.image.repository }}:{{ .Values.dataSources.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataSources.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.dataSources.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.dataSources.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.dataSources.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.dataSources.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataSources.sasDbMigrator.image.repository }}:{{ .Values.dataSources.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataSources.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.dataSources.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataSources.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.dataSources.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-data-studio-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-data-studio-app
    sas.com/component-version: 2.custom18.custom6-20241106.custom1730917899376
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom18.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-data-studio-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-data-studio-app
        app.kubernetes.io/name: sas-data-studio-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-data-studio-app
        sas.com/component-version: 2.custom18.custom6-20241106.custom1730917899376
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom18.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-data-studio-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.dataStudioApp.sasDataStudioApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.dataStudioApp.sasDataStudioApp.image.repository }}:{{ .Values.dataStudioApp.sasDataStudioApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataStudioApp.sasDataStudioApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-data-studio-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.dataStudioApp.sasDataStudioApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataStudioApp.sasDataStudioApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.dataStudioApp.sasStartSequencer.image.repository }}:{{ .Values.dataStudioApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.dataStudioApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.dataStudioApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.dataStudioApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.dataStudioApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.dataStudioApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.dataStudioApp.sasCertframe.image.repository }}:{{ .Values.dataStudioApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.dataStudioApp.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.dataStudioApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.dataStudioApp.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-decision-manager-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-decision-manager-app
    sas.com/component-version: 5.custom860.custom31-20241122.custom1732277532289
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 5.custom860.custom31
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-decision-manager-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-decision-manager-app
        app.kubernetes.io/name: sas-decision-manager-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-decision-manager-app
        sas.com/component-version: 5.custom860.custom31-20241122.custom1732277532289
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 5.custom860.custom31
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-decision-manager-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.decisionManagerApp.sasDecisionManagerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.decisionManagerApp.sasDecisionManagerApp.image.repository }}:{{
          .Values.decisionManagerApp.sasDecisionManagerApp.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.decisionManagerApp.sasDecisionManagerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-decision-manager-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.decisionManagerApp.sasDecisionManagerApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.decisionManagerApp.sasDecisionManagerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.decisionManagerApp.sasStartSequencer.image.repository }}:{{ .Values.decisionManagerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.decisionManagerApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.decisionManagerApp.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.decisionManagerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.decisionManagerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.decisionManagerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.decisionManagerApp.sasCertframe.image.repository }}:{{ .Values.decisionManagerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.decisionManagerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.decisionManagerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.decisionManagerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-decisions
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-decisions
    sas.com/component-version: 9.custom11.custom25-20241203.custom1733237072223
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 9.custom11.custom25
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-decisions
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-decisions
        app.kubernetes.io/name: sas-decisions
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-decisions
        sas.com/component-version: 9.custom11.custom25-20241203.custom1733237072223
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 9.custom11.custom25
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-decisions
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.decisions.sasDecisions.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.decisions.sasDecisions.image.repository }}:{{ .Values.decisions.sasDecisions.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.decisions.sasDecisions.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-decisions
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.decisions.sasDecisions.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.decisions.sasDecisions.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.decisions.sasStartSequencer.image.repository }}:{{ .Values.decisions.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.decisions.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.decisions.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.decisions.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.decisions.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.decisions.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.decisions.sasCertframe.image.repository }}:{{ .Values.decisions.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.decisions.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.decisions.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.decisions.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-decisions-runtime-builder
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-decisions-runtime-builder
    sas.com/component-version: 1.custom14.custom2-20240905.custom1725565128727
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom14.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-decisions-runtime-builder
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-decisions-runtime-builder
        app.kubernetes.io/name: sas-decisions-runtime-builder
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-decisions-runtime-builder
        sas.com/component-version: 1.custom14.custom2-20240905.custom1725565128727
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom14.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-decisions-runtime-builder
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.env.sasK8SDeploymentName
            }}
        - name: MY_POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-input-4f545bc4g8
        image: '{{ .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.image.repository
          }}:{{ .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-decisions-runtime-builder
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.decisionsRuntimeBuilder.sasDecisionsRuntimeBuilder.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.decisionsRuntimeBuilder.sasStartSequencer.image.repository }}:{{
          .Values.decisionsRuntimeBuilder.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.decisionsRuntimeBuilder.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.decisionsRuntimeBuilder.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.decisionsRuntimeBuilder.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.decisionsRuntimeBuilder.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.decisionsRuntimeBuilder.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.decisionsRuntimeBuilder.sasCertframe.image.repository }}:{{ .Values.decisionsRuntimeBuilder.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.decisionsRuntimeBuilder.sasCertframe.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.decisionsRuntimeBuilder.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.decisionsRuntimeBuilder.podSecurityContext |
        nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-decisions-runtime-builder
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-deployment-data
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-deployment-data
    sas.com/component-version: 2.custom23.custom6-20240905.custom1725568704975
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom23.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-deployment-data
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-deployment-data
        app.kubernetes.io/name: sas-deployment-data
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-deployment-data
        sas.com/component-version: 2.custom23.custom6-20240905.custom1725568704975
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom23.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-deployment-data
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.deploymentData.sasDeploymentData.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.deploymentData.sasDeploymentData.image.repository }}:{{ .Values.deploymentData.sasDeploymentData.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deploymentData.sasDeploymentData.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-deployment-data
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.deploymentData.sasDeploymentData.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deploymentData.sasDeploymentData.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /usr/local/share/sas-deployment-data
          name: sas-license
          readOnly: true
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.deploymentData.sasStartSequencer.image.repository }}:{{ .Values.deploymentData.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deploymentData.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.deploymentData.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deploymentData.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.deploymentData.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.deploymentData.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.deploymentData.sasCertframe.image.repository }}:{{ .Values.deploymentData.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.deploymentData.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.deploymentData.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.deploymentData.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.deploymentData.hydrator.image.repository }}:{{ .Values.deploymentData.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deploymentData.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.deploymentData.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.deploymentData.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.deploymentData.sasDbMigrator.env.sasServiceName }}
        - name: SAS_MULTI_TENANCY_DB_SCHEMA_PROVIDERONLY
          value: {{ quote .Values.deploymentData.sasDbMigrator.env.sasMultiTenancyDbSchemaProvideronly
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.deploymentData.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.deploymentData.sasDbMigrator.image.repository }}:{{ .Values.deploymentData.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deploymentData.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.deploymentData.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deploymentData.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.deploymentData.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: sas-license
        secret:
          items:
          - key: SAS_LICENSE
            path: license.jwt
          secretName: {{ include "sas-viya-helm.fullname" . }}-license-996thbcbkg
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-detection
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-detection
    sas.com/component-version: 1.custom43.custom3-20240907.custom1725675515499
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom43.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-detection
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-detection
        app.kubernetes.io/name: sas-detection
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-detection
        sas.com/component-version: 1.custom43.custom3-20240907.custom1725675515499
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom43.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-detection
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.detection.sasDetection.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.detection.sasDetection.image.repository }}:{{ .Values.detection.sasDetection.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detection.sasDetection.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-detection
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.detection.sasDetection.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.detection.sasDetection.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.detection.sasStartSequencer.image.repository }}:{{ .Values.detection.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detection.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.detection.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.detection.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.detection.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.detection.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.detection.sasCertframe.image.repository }}:{{ .Values.detection.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.detection.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.detection.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.detection.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-detection-analysis
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-detection-analysis
    sas.com/component-version: 2.custom13.custom8-20240906.custom1725643062821
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom13.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-detection-analysis
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-detection-analysis
        app.kubernetes.io/name: sas-detection-analysis
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-detection-analysis
        sas.com/component-version: 2.custom13.custom8-20240906.custom1725643062821
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom13.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-detection-analysis
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.detectionAnalysis.sasDetectionAnalysis.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.detectionAnalysis.sasDetectionAnalysis.image.repository }}:{{
          .Values.detectionAnalysis.sasDetectionAnalysis.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.detectionAnalysis.sasDetectionAnalysis.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-detection-analysis
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.detectionAnalysis.sasDetectionAnalysis.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionAnalysis.sasDetectionAnalysis.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.detectionAnalysis.sasStartSequencer.image.repository }}:{{ .Values.detectionAnalysis.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionAnalysis.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.detectionAnalysis.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionAnalysis.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.detectionAnalysis.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.detectionAnalysis.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.detectionAnalysis.sasCertframe.image.repository }}:{{ .Values.detectionAnalysis.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.detectionAnalysis.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionAnalysis.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.detectionAnalysis.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.detectionAnalysis.hydrator.image.repository }}:{{ .Values.detectionAnalysis.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionAnalysis.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.detectionAnalysis.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.detectionAnalysis.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.detectionAnalysis.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.detectionAnalysis.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.detectionAnalysis.sasDbMigrator.image.repository }}:{{ .Values.detectionAnalysis.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionAnalysis.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.detectionAnalysis.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionAnalysis.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.detectionAnalysis.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-detection-definition
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-detection-definition
    sas.com/component-version: 1.custom244.custom9-20240911.custom1726061311777
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom244.custom9
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-detection-definition
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-detection-definition
        app.kubernetes.io/name: sas-detection-definition
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-detection-definition
        sas.com/component-version: 1.custom244.custom9-20240911.custom1726061311777
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom244.custom9
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-detection-definition
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.detectionDefinition.sasDetectionDefinition.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.detectionDefinition.sasDetectionDefinition.image.repository }}:{{
          .Values.detectionDefinition.sasDetectionDefinition.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.detectionDefinition.sasDetectionDefinition.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-detection-definition
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.detectionDefinition.sasDetectionDefinition.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionDefinition.sasDetectionDefinition.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.detectionDefinition.sasStartSequencer.image.repository }}:{{
          .Values.detectionDefinition.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.detectionDefinition.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.detectionDefinition.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.detectionDefinition.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.detectionDefinition.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.detectionDefinition.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.detectionDefinition.sasCertframe.image.repository }}:{{ .Values.detectionDefinition.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.detectionDefinition.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionDefinition.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.detectionDefinition.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.detectionDefinition.hydrator.image.repository }}:{{ .Values.detectionDefinition.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionDefinition.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.detectionDefinition.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionDefinition.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.detectionDefinition.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.detectionDefinition.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.detectionDefinition.sasDbMigrator.image.repository }}:{{ .Values.detectionDefinition.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionDefinition.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.detectionDefinition.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionDefinition.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.detectionDefinition.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-detection-definition-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-detection-definition-app
    sas.com/component-version: 1.custom85.custom26-20240911.custom1726068535772
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom85.custom26
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-detection-definition-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-detection-definition-app
        app.kubernetes.io/name: sas-detection-definition-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-detection-definition-app
        sas.com/component-version: 1.custom85.custom26-20240911.custom1726068535772
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom85.custom26
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-detection-definition-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.detectionDefinitionApp.sasDetectionDefinitionApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.detectionDefinitionApp.sasDetectionDefinitionApp.image.repository
          }}:{{ .Values.detectionDefinitionApp.sasDetectionDefinitionApp.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.detectionDefinitionApp.sasDetectionDefinitionApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-detection-definition-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.detectionDefinitionApp.sasDetectionDefinitionApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionDefinitionApp.sasDetectionDefinitionApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.detectionDefinitionApp.sasStartSequencer.image.repository }}:{{
          .Values.detectionDefinitionApp.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.detectionDefinitionApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.detectionDefinitionApp.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionDefinitionApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.detectionDefinitionApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.detectionDefinitionApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.detectionDefinitionApp.sasCertframe.image.repository }}:{{ .Values.detectionDefinitionApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.detectionDefinitionApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionDefinitionApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.detectionDefinitionApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-detection-message-schema
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-detection-message-schema
    sas.com/component-version: 1.custom73.custom5-20240910.custom1725973753452
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom73.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-detection-message-schema
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-detection-message-schema
        app.kubernetes.io/name: sas-detection-message-schema
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-detection-message-schema
        sas.com/component-version: 1.custom73.custom5-20240910.custom1725973753452
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom73.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-detection-message-schema
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.detectionMessageSchema.sasDetectionMessageSchema.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.detectionMessageSchema.sasDetectionMessageSchema.image.repository
          }}:{{ .Values.detectionMessageSchema.sasDetectionMessageSchema.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.detectionMessageSchema.sasDetectionMessageSchema.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-detection-message-schema
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.detectionMessageSchema.sasDetectionMessageSchema.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionMessageSchema.sasDetectionMessageSchema.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.detectionMessageSchema.sasStartSequencer.image.repository }}:{{
          .Values.detectionMessageSchema.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.detectionMessageSchema.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.detectionMessageSchema.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.detectionMessageSchema.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.detectionMessageSchema.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.detectionMessageSchema.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.detectionMessageSchema.sasCertframe.image.repository }}:{{ .Values.detectionMessageSchema.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.detectionMessageSchema.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionMessageSchema.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.detectionMessageSchema.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.detectionMessageSchema.hydrator.image.repository }}:{{ .Values.detectionMessageSchema.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionMessageSchema.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.detectionMessageSchema.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.detectionMessageSchema.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.detectionMessageSchema.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.detectionMessageSchema.sasDbMigrator.env.sslCertFile
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.detectionMessageSchema.sasDbMigrator.image.repository }}:{{ .Values.detectionMessageSchema.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.detectionMessageSchema.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.detectionMessageSchema.sasDbMigrator.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.detectionMessageSchema.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.detectionMessageSchema.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-device-management
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-device-management
    sas.com/component-version: 2.custom157.custom4-20240904.custom1725485143968
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom157.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-device-management
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-device-management
        app.kubernetes.io/name: sas-device-management
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-device-management
        sas.com/component-version: 2.custom157.custom4-20240904.custom1725485143968
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom157.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-device-management
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.deviceManagement.sasDeviceManagement.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.deviceManagement.sasDeviceManagement.image.repository }}:{{ .Values.deviceManagement.sasDeviceManagement.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deviceManagement.sasDeviceManagement.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-device-management
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.deviceManagement.sasDeviceManagement.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.deviceManagement.sasDeviceManagement.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.deviceManagement.sasStartSequencer.image.repository }}:{{ .Values.deviceManagement.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deviceManagement.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.deviceManagement.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deviceManagement.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.deviceManagement.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.deviceManagement.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.deviceManagement.sasCertframe.image.repository }}:{{ .Values.deviceManagement.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.deviceManagement.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deviceManagement.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.deviceManagement.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.deviceManagement.hydrator.image.repository }}:{{ .Values.deviceManagement.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deviceManagement.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.deviceManagement.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.deviceManagement.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.deviceManagement.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.deviceManagement.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.deviceManagement.sasDbMigrator.image.repository }}:{{ .Values.deviceManagement.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.deviceManagement.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.deviceManagement.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.deviceManagement.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.deviceManagement.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-discovery-services
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-discovery-services
    sas.com/component-version: 3.custom10.custom8-20240925.custom1727284035087
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom10.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-discovery-services
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-discovery-services
        app.kubernetes.io/name: sas-discovery-services
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-discovery-services
        sas.com/component-version: 3.custom10.custom8-20240925.custom1727284035087
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom10.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-discovery-services
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.discoveryServices.sasDiscoveryServices.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-data-discovery-database-config-5kh26cm78g
        image: '{{ .Values.discoveryServices.sasDiscoveryServices.image.repository }}:{{
          .Values.discoveryServices.sasDiscoveryServices.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.discoveryServices.sasDiscoveryServices.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-discovery-services
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.discoveryServices.sasDiscoveryServices.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.discoveryServices.sasDiscoveryServices.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.discoveryServices.sasStartSequencer.image.repository }}:{{ .Values.discoveryServices.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.discoveryServices.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.discoveryServices.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.discoveryServices.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.discoveryServices.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.discoveryServices.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.discoveryServices.sasCertframe.image.repository }}:{{ .Values.discoveryServices.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.discoveryServices.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.discoveryServices.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.discoveryServices.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.discoveryServices.hydrator.image.repository }}:{{ .Values.discoveryServices.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.discoveryServices.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.discoveryServices.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.discoveryServices.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.discoveryServices.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.discoveryServices.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.discoveryServices.sasDbMigrator.image.repository }}:{{ .Values.discoveryServices.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.discoveryServices.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.discoveryServices.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.discoveryServices.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.discoveryServices.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-document-generator-adapter
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-document-generator-adapter
    sas.com/component-version: 1.custom28.custom7-20241129.custom1732872338175
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom28.custom7
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-document-generator-adapter
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-document-generator-adapter
        app.kubernetes.io/name: sas-document-generator-adapter
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-document-generator-adapter
        sas.com/component-version: 1.custom28.custom7-20241129.custom1732872338175
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom28.custom7
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-document-generator-adapter
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.image.repository
          }}:{{ .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.image.tag |
          default .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-document-generator-adapter
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.documentGeneratorAdapter.sasDocumentGeneratorAdapter.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.documentGeneratorAdapter.sasStartSequencer.image.repository }}:{{
          .Values.documentGeneratorAdapter.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.documentGeneratorAdapter.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.documentGeneratorAdapter.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.documentGeneratorAdapter.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.documentGeneratorAdapter.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.documentGeneratorAdapter.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.documentGeneratorAdapter.sasCertframe.image.repository }}:{{
          .Values.documentGeneratorAdapter.sasCertframe.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe
        resources: {{- toYaml .Values.documentGeneratorAdapter.sasCertframe.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.documentGeneratorAdapter.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.documentGeneratorAdapter.podSecurityContext |
        nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-drive-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-drive-app
    sas.com/component-version: 3.custom89.custom10-20240910.custom1725999952633
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom89.custom10
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-drive-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-drive-app
        app.kubernetes.io/name: sas-drive-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-drive-app
        sas.com/component-version: 3.custom89.custom10-20240910.custom1725999952633
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom89.custom10
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-drive-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.driveApp.sasDriveApp.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.driveApp.sasDriveApp.image.repository }}:{{ .Values.driveApp.sasDriveApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.driveApp.sasDriveApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-drive-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.driveApp.sasDriveApp.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.driveApp.sasDriveApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.driveApp.sasStartSequencer.image.repository }}:{{ .Values.driveApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.driveApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.driveApp.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.driveApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.driveApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.driveApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.driveApp.sasCertframe.image.repository }}:{{ .Values.driveApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.driveApp.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.driveApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.driveApp.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-environment-manager-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-environment-manager-app
    sas.com/component-version: 5.custom47.custom202-20241212.custom1734023686147
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 5.custom47.custom202
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-environment-manager-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-environment-manager-app
        app.kubernetes.io/name: sas-environment-manager-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-environment-manager-app
        sas.com/component-version: 5.custom47.custom202-20241212.custom1734023686147
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 5.custom47.custom202
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-environment-manager-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.environmentManagerApp.sasEnvironmentManagerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.environmentManagerApp.sasEnvironmentManagerApp.image.repository
          }}:{{ .Values.environmentManagerApp.sasEnvironmentManagerApp.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.environmentManagerApp.sasEnvironmentManagerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-environment-manager-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.environmentManagerApp.sasEnvironmentManagerApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.environmentManagerApp.sasEnvironmentManagerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.environmentManagerApp.sasStartSequencer.image.repository }}:{{
          .Values.environmentManagerApp.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.environmentManagerApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.environmentManagerApp.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.environmentManagerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.environmentManagerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.environmentManagerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.environmentManagerApp.sasCertframe.image.repository }}:{{ .Values.environmentManagerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.environmentManagerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.environmentManagerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.environmentManagerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-event-monitor
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-event-monitor
    sas.com/component-version: 1.custom14.custom4-20240905.custom1725545653258
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom14.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-event-monitor
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-event-monitor
        app.kubernetes.io/name: sas-event-monitor
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-event-monitor
        sas.com/component-version: 1.custom14.custom4-20240905.custom1725545653258
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom14.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-event-monitor
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.eventMonitor.sasEventMonitor.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.eventMonitor.sasEventMonitor.image.repository }}:{{ .Values.eventMonitor.sasEventMonitor.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.eventMonitor.sasEventMonitor.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-event-monitor
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.eventMonitor.sasEventMonitor.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.eventMonitor.sasEventMonitor.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.eventMonitor.sasStartSequencer.image.repository }}:{{ .Values.eventMonitor.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.eventMonitor.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.eventMonitor.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.eventMonitor.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.eventMonitor.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.eventMonitor.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.eventMonitor.sasCertframe.image.repository }}:{{ .Values.eventMonitor.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.eventMonitor.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.eventMonitor.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.eventMonitor.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.eventMonitor.hydrator.image.repository }}:{{ .Values.eventMonitor.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.eventMonitor.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.eventMonitor.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.eventMonitor.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.eventMonitor.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.eventMonitor.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.eventMonitor.sasDbMigrator.image.repository }}:{{ .Values.eventMonitor.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.eventMonitor.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.eventMonitor.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.eventMonitor.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.eventMonitor.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-feature-flags
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-feature-flags
    sas.com/component-version: 1.custom50.custom4-20240906.custom1725626652060
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom50.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-feature-flags
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-feature-flags
        app.kubernetes.io/name: sas-feature-flags
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-feature-flags
        sas.com/component-version: 1.custom50.custom4-20240906.custom1725626652060
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom50.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-feature-flags
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.featureFlags.sasFeatureFlags.env.sasK8SDeploymentName
            }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.featureFlags.sasFeatureFlags.image.repository }}:{{ .Values.featureFlags.sasFeatureFlags.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.featureFlags.sasFeatureFlags.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-feature-flags
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.featureFlags.sasFeatureFlags.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.featureFlags.sasFeatureFlags.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.featureFlags.sasStartSequencer.image.repository }}:{{ .Values.featureFlags.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.featureFlags.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.featureFlags.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.featureFlags.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.featureFlags.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.featureFlags.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.featureFlags.sasCertframe.image.repository }}:{{ .Values.featureFlags.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.featureFlags.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.featureFlags.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.featureFlags.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.featureFlags.hydrator.image.repository }}:{{ .Values.featureFlags.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.featureFlags.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.featureFlags.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.featureFlags.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.featureFlags.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.featureFlags.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.featureFlags.sasDbMigrator.image.repository }}:{{ .Values.featureFlags.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.featureFlags.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.featureFlags.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.featureFlags.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.featureFlags.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-file-store
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-file-store
    sas.com/component-version: 3.custom100.custom17-20240906.custom1725651009696
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom100.custom17
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-file-store
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-file-store
        app.kubernetes.io/name: sas-file-store
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-file-store
        sas.com/component-version: 3.custom100.custom17-20240906.custom1725651009696
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom100.custom17
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-file-store
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.fileStore.sasFileStore.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.fileStore.sasFileStore.image.repository }}:{{ .Values.fileStore.sasFileStore.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.fileStore.sasFileStore.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-file-store
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.fileStore.sasFileStore.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.fileStore.sasFileStore.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.fileStore.sasStartSequencer.image.repository }}:{{ .Values.fileStore.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.fileStore.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.fileStore.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.fileStore.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.fileStore.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.fileStore.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.fileStore.sasCertframe.image.repository }}:{{ .Values.fileStore.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.fileStore.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.fileStore.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.fileStore.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.fileStore.hydrator.image.repository }}:{{ .Values.fileStore.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.fileStore.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.fileStore.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.fileStore.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.fileStore.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.fileStore.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.fileStore.sasDbMigrator.image.repository }}:{{ .Values.fileStore.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.fileStore.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.fileStore.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.fileStore.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.fileStore.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-files
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-files
    sas.com/component-version: 3.custom32.custom3-20240927.custom1727443363240
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom32.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-files
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-files
        app.kubernetes.io/name: sas-files
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-files
        sas.com/component-version: 3.custom32.custom3-20240927.custom1727443363240
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom32.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-files
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.files.sasFiles.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.files.sasFiles.env.sasEventConfigurationArkeEnabled }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.files.sasFiles.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.files.sasFiles.image.repository }}:{{ .Values.files.sasFiles.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.files.sasFiles.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-files
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.files.sasFiles.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.files.sasFiles.containerSecurityContext | nindent
          10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.files.sasStartSequencer.image.repository }}:{{ .Values.files.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.files.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.files.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.files.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.files.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.files.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.files.sasCertframe.image.repository }}:{{ .Values.files.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.files.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.files.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.files.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-formats
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-formats
    sas.com/component-version: 0.custom108.custom2-20240906.custom1725590318063
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 0.custom108.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-formats
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-formats
        app.kubernetes.io/name: sas-formats
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-formats
        sas.com/component-version: 0.custom108.custom2-20240906.custom1725590318063
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 0.custom108.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-formats
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.formats.sasFormats.env.sasK8SDeploymentName }}
        - name: SAS_FMTSRV_PORT
          value: {{ quote .Values.formats.sasFormats.env.sasFmtsrvPort }}
        - name: SAS_FMT_VALIDATE_JSON
          value: {{ quote .Values.formats.sasFormats.env.sasFmtValidateJson }}
        - name: SAS_FMTSRV_PAYLOAD_SIZE_LIMIT
          value: {{ quote .Values.formats.sasFormats.env.sasFmtsrvPayloadSizeLimit }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.formats.sasFormats.image.repository }}:{{ .Values.formats.sasFormats.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.formats.sasFormats.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-formats
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.formats.sasFormats.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.formats.sasFormats.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      - env:
        - name: SAS_FMTSRV_PORT
          value: {{ quote .Values.formats.sasPortableFormats.env.sasFmtsrvPort }}
        - name: SAS_FMTSRV_PAYLOAD_SIZE_LIMIT
          value: {{ quote .Values.formats.sasPortableFormats.env.sasFmtsrvPayloadSizeLimit
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.formats.sasPortableFormats.image.repository }}:{{ .Values.formats.sasPortableFormats.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.formats.sasPortableFormats.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-portable-formats
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.formats.sasPortableFormats.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.formats.sasPortableFormats.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          initialDelaySeconds: 3
          periodSeconds: 20
          timeoutSeconds: 5
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.formats.sasStartSequencer.image.repository }}:{{ .Values.formats.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.formats.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.formats.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.formats.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.formats.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.formats.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.formats.sasCertframe.image.repository }}:{{ .Values.formats.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.formats.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.formats.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.formats.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-geography
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-geography
    sas.com/component-version: 2.custom33.custom1-20240910.custom1725982962934
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom33.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-geography
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-geography
        app.kubernetes.io/name: sas-geography
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-geography
        sas.com/component-version: 2.custom33.custom1-20240910.custom1725982962934
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom33.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-geography
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.geography.sasGeography.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.geography.sasGeography.image.repository }}:{{ .Values.geography.sasGeography.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.geography.sasGeography.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-geography
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.geography.sasGeography.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.geography.sasGeography.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.geography.sasStartSequencer.image.repository }}:{{ .Values.geography.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.geography.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.geography.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.geography.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.geography.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.geography.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.geography.sasCertframe.image.repository }}:{{ .Values.geography.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.geography.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.geography.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.geography.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.geography.hydrator.image.repository }}:{{ .Values.geography.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.geography.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.geography.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.geography.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.geography.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.geography.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.geography.sasDbMigrator.image.repository }}:{{ .Values.geography.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.geography.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.geography.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.geography.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.geography.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-graph-builder-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-graph-builder-app
    sas.com/component-version: 1.custom204.custom3-20240904.custom1725487431290
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom204.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-graph-builder-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-graph-builder-app
        app.kubernetes.io/name: sas-graph-builder-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-graph-builder-app
        sas.com/component-version: 1.custom204.custom3-20240904.custom1725487431290
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom204.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-graph-builder-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.graphBuilderApp.sasGraphBuilderApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.graphBuilderApp.sasGraphBuilderApp.image.repository }}:{{ .Values.graphBuilderApp.sasGraphBuilderApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphBuilderApp.sasGraphBuilderApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-graph-builder-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.graphBuilderApp.sasGraphBuilderApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphBuilderApp.sasGraphBuilderApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.graphBuilderApp.sasStartSequencer.image.repository }}:{{ .Values.graphBuilderApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphBuilderApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.graphBuilderApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphBuilderApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.graphBuilderApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.graphBuilderApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.graphBuilderApp.sasCertframe.image.repository }}:{{ .Values.graphBuilderApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.graphBuilderApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphBuilderApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.graphBuilderApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-graph-templates
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-graph-templates
    sas.com/component-version: 1.custom246.custom4-20240905.custom1725549168637
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom246.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-graph-templates
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-graph-templates
        app.kubernetes.io/name: sas-graph-templates
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-graph-templates
        sas.com/component-version: 1.custom246.custom4-20240905.custom1725549168637
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom246.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-graph-templates
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.graphTemplates.sasGraphTemplates.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.graphTemplates.sasGraphTemplates.image.repository }}:{{ .Values.graphTemplates.sasGraphTemplates.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphTemplates.sasGraphTemplates.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-graph-templates
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.graphTemplates.sasGraphTemplates.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphTemplates.sasGraphTemplates.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.graphTemplates.sasStartSequencer.image.repository }}:{{ .Values.graphTemplates.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphTemplates.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.graphTemplates.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphTemplates.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.graphTemplates.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.graphTemplates.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.graphTemplates.sasCertframe.image.repository }}:{{ .Values.graphTemplates.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.graphTemplates.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.graphTemplates.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.graphTemplates.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.graphTemplates.hydrator.image.repository }}:{{ .Values.graphTemplates.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphTemplates.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.graphTemplates.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.graphTemplates.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.graphTemplates.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.graphTemplates.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.graphTemplates.sasDbMigrator.image.repository }}:{{ .Values.graphTemplates.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.graphTemplates.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.graphTemplates.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.graphTemplates.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.graphTemplates.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-identities
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-identities
    sas.com/component-version: 3.custom18.custom2-20240926.custom1727366551969
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom18.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-identities
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-identities
        app.kubernetes.io/name: sas-identities
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-identities
        sas.com/component-version: 3.custom18.custom2-20240926.custom1727366551969
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom18.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-identities
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.identities.sasIdentities.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.identities.sasIdentities.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.identities.sasIdentities.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.identities.sasIdentities.image.repository }}:{{ .Values.identities.sasIdentities.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.identities.sasIdentities.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-identities
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.identities.sasIdentities.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.identities.sasIdentities.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.identities.sasStartSequencer.image.repository }}:{{ .Values.identities.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.identities.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.identities.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.identities.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.identities.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.identities.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.identities.sasCertframe.image.repository }}:{{ .Values.identities.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.identities.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.identities.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.identities.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-import-9
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-import-9
    sas.com/component-version: 1.custom58.custom41-20241211.custom1733953985655
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom58.custom41
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-import-9
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-import-9
        app.kubernetes.io/name: sas-import-9
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-import-9
        sas.com/component-version: 1.custom58.custom41-20241211.custom1733953985655
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom58.custom41
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-import-9
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.import9.sasImport9.env.sasK8SDeploymentName }}
        - name: JAVA_OPTION_XMX
          value: {{ quote .Values.import9.sasImport9.env.javaOptionXmx }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.import9.sasImport9.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.import9.sasImport9.image.repository }}:{{ .Values.import9.sasImport9.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.import9.sasImport9.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-import-9
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.import9.sasImport9.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.import9.sasImport9.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.import9.sasStartSequencer.image.repository }}:{{ .Values.import9.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.import9.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.import9.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.import9.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.import9.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.import9.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.import9.sasCertframe.image.repository }}:{{ .Values.import9.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.import9.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.import9.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.import9.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-information-catalog-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-information-catalog-app
    sas.com/component-version: 1.custom71.custom1-20240911.custom1726067729426
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom71.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-information-catalog-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-information-catalog-app
        app.kubernetes.io/name: sas-information-catalog-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-information-catalog-app
        sas.com/component-version: 1.custom71.custom1-20240911.custom1726067729426
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom71.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-information-catalog-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.informationCatalogApp.sasInformationCatalogApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.informationCatalogApp.sasInformationCatalogApp.image.repository
          }}:{{ .Values.informationCatalogApp.sasInformationCatalogApp.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.informationCatalogApp.sasInformationCatalogApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-information-catalog-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.informationCatalogApp.sasInformationCatalogApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.informationCatalogApp.sasInformationCatalogApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.informationCatalogApp.sasStartSequencer.image.repository }}:{{
          .Values.informationCatalogApp.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.informationCatalogApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.informationCatalogApp.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.informationCatalogApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.informationCatalogApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.informationCatalogApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.informationCatalogApp.sasCertframe.image.repository }}:{{ .Values.informationCatalogApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.informationCatalogApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.informationCatalogApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.informationCatalogApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-insights
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-insights
    sas.com/component-version: 1.custom46.custom2-20240923.custom1727122475747
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom46.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-insights
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-insights
        app.kubernetes.io/name: sas-insights
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-insights
        sas.com/component-version: 1.custom46.custom2-20240923.custom1727122475747
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom46.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-insights
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_FMTSRV_PORT
          value: {{ quote .Values.insights.sasInsights.env.sasFmtsrvPort }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.insights.sasInsights.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.insights.sasInsights.image.repository }}:{{ .Values.insights.sasInsights.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.insights.sasInsights.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-insights
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.insights.sasInsights.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.insights.sasInsights.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      - env:
        - name: SAS_FMTSRV_PORT
          value: {{ quote .Values.insights.sasPortableFormats.env.sasFmtsrvPort }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.insights.sasPortableFormats.image.repository }}:{{ .Values.insights.sasPortableFormats.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.insights.sasPortableFormats.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-portable-formats
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.insights.sasPortableFormats.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.insights.sasPortableFormats.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /formats/live
            port: 9080
            scheme: HTTP
          initialDelaySeconds: 3
          periodSeconds: 20
          timeoutSeconds: 5
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.insights.sasStartSequencer.image.repository }}:{{ .Values.insights.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.insights.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.insights.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.insights.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.insights.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.insights.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.insights.sasCertframe.image.repository }}:{{ .Values.insights.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.insights.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.insights.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.insights.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-job-execution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-job-execution
    sas.com/component-version: 3.custom12.custom3-20240910.custom1725976153207
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom12.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-job-execution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-job-execution
        app.kubernetes.io/name: sas-job-execution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-job-execution
        sas.com/component-version: 3.custom12.custom3-20240910.custom1725976153207
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom12.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-job-execution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.jobExecution.sasJobExecution.env.sasK8SDeploymentName
            }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.jobExecution.sasJobExecution.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.jobExecution.sasJobExecution.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.jobExecution.sasJobExecution.image.repository }}:{{ .Values.jobExecution.sasJobExecution.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobExecution.sasJobExecution.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-job-execution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.jobExecution.sasJobExecution.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobExecution.sasJobExecution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.jobExecution.sasStartSequencer.image.repository }}:{{ .Values.jobExecution.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobExecution.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.jobExecution.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobExecution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.jobExecution.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.jobExecution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.jobExecution.sasCertframe.image.repository }}:{{ .Values.jobExecution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.jobExecution.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.jobExecution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.jobExecution.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-job-execution-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-job-execution-app
    sas.com/component-version: 2.custom32.custom13-20240911.custom1726060601051
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom32.custom13
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-job-execution-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-job-execution-app
        app.kubernetes.io/name: sas-job-execution-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-job-execution-app
        sas.com/component-version: 2.custom32.custom13-20240911.custom1726060601051
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom32.custom13
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-job-execution-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.jobExecutionApp.sasJobExecutionApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.jobExecutionApp.sasJobExecutionApp.image.repository }}:{{ .Values.jobExecutionApp.sasJobExecutionApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobExecutionApp.sasJobExecutionApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-job-execution-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.jobExecutionApp.sasJobExecutionApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobExecutionApp.sasJobExecutionApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.jobExecutionApp.sasStartSequencer.image.repository }}:{{ .Values.jobExecutionApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobExecutionApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.jobExecutionApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobExecutionApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.jobExecutionApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.jobExecutionApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.jobExecutionApp.sasCertframe.image.repository }}:{{ .Values.jobExecutionApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.jobExecutionApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobExecutionApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.jobExecutionApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-job-flow-scheduling
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-job-flow-scheduling
    sas.com/component-version: 2.custom22.custom7-20240904.custom1725488321505
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom22.custom7
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-job-flow-scheduling
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-job-flow-scheduling
        app.kubernetes.io/name: sas-job-flow-scheduling
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-job-flow-scheduling
        sas.com/component-version: 2.custom22.custom7-20240904.custom1725488321505
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom22.custom7
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-job-flow-scheduling
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.jobFlowScheduling.sasJobFlowScheduling.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.jobFlowScheduling.sasJobFlowScheduling.image.repository }}:{{
          .Values.jobFlowScheduling.sasJobFlowScheduling.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.jobFlowScheduling.sasJobFlowScheduling.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-job-flow-scheduling
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.jobFlowScheduling.sasJobFlowScheduling.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.jobFlowScheduling.sasJobFlowScheduling.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.jobFlowScheduling.sasStartSequencer.image.repository }}:{{ .Values.jobFlowScheduling.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobFlowScheduling.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.jobFlowScheduling.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobFlowScheduling.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.jobFlowScheduling.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.jobFlowScheduling.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.jobFlowScheduling.sasCertframe.image.repository }}:{{ .Values.jobFlowScheduling.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.jobFlowScheduling.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobFlowScheduling.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.jobFlowScheduling.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.jobFlowScheduling.hydrator.image.repository }}:{{ .Values.jobFlowScheduling.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobFlowScheduling.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.jobFlowScheduling.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.jobFlowScheduling.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.jobFlowScheduling.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.jobFlowScheduling.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.jobFlowScheduling.sasDbMigrator.image.repository }}:{{ .Values.jobFlowScheduling.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.jobFlowScheduling.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.jobFlowScheduling.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.jobFlowScheduling.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.jobFlowScheduling.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-launcher
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-launcher
    sas.com/component-version: 1.custom90.custom2-20240920.custom1726846518073
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom90.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-launcher
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-launcher
        app.kubernetes.io/name: sas-launcher
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-launcher
        sas.com/component-version: 1.custom90.custom2-20240920.custom1726846518073
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom90.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-launcher
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_LAUNCHER_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: SAS_LAUNCHER_USER_PROCESS_LIMIT
          value: {{ quote .Values.launcher.sasLauncher.env.sasLauncherUserProcessLimit
            }}
        - name: SAS_LAUNCHER_USER_PROCESS_LIMIT_ENABLED
          value: {{ quote .Values.launcher.sasLauncher.env.sasLauncherUserProcessLimitEnabled
            }}
        - name: SAS_LAUNCHER_SUPER_USER_PROCESS_LIMIT
          value: {{ quote .Values.launcher.sasLauncher.env.sasLauncherSuperUserProcessLimit
            }}
        - name: SAS_LAUNCHER_SUPER_USER_PROCESS_LIMIT_ENABLED
          value: {{ quote .Values.launcher.sasLauncher.env.sasLauncherSuperUserProcessLimitEnabled
            }}
        - name: SAS_LAUNCHER_SWO_DISABLED
          value: {{ quote .Values.launcher.sasLauncher.env.sasLauncherSwoDisabled }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.launcher.sasLauncher.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.launcher.sasLauncher.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-launcher-init-nls-config-9d6k8f9hcd
        image: {{ .Values.launcher.sasLauncher.image.repository }}:{{ .Values.launcher.sasLauncher.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.launcher.sasLauncher.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-launcher
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.launcher.sasLauncher.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.launcher.sasLauncher.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.launcher.sasStartSequencer.image.repository }}:{{ .Values.launcher.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.launcher.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.launcher.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.launcher.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.launcher.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.launcher.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.launcher.sasCertframe.image.repository }}:{{ .Values.launcher.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.launcher.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.launcher.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.launcher.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-launcher
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-lineage-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-lineage-app
    sas.com/component-version: 3.custom33.custom2-20240909.custom1725904620028
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom33.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-lineage-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-lineage-app
        app.kubernetes.io/name: sas-lineage-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-lineage-app
        sas.com/component-version: 3.custom33.custom2-20240909.custom1725904620028
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom33.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-lineage-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.lineageApp.sasLineageApp.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.lineageApp.sasLineageApp.image.repository }}:{{ .Values.lineageApp.sasLineageApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.lineageApp.sasLineageApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-lineage-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.lineageApp.sasLineageApp.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.lineageApp.sasLineageApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.lineageApp.sasStartSequencer.image.repository }}:{{ .Values.lineageApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.lineageApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.lineageApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.lineageApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.lineageApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.lineageApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.lineageApp.sasCertframe.image.repository }}:{{ .Values.lineageApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.lineageApp.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.lineageApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.lineageApp.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-links
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-links
    sas.com/component-version: 1.custom252.custom5-20240905.custom1725548948860
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom252.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-links
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-links
        app.kubernetes.io/name: sas-links
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-links
        sas.com/component-version: 1.custom252.custom5-20240905.custom1725548948860
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom252.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-links
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.links.sasLinks.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.links.sasLinks.image.repository }}:{{ .Values.links.sasLinks.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.links.sasLinks.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-links
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.links.sasLinks.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.links.sasLinks.containerSecurityContext | nindent
          10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.links.sasStartSequencer.image.repository }}:{{ .Values.links.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.links.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.links.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.links.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.links.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.links.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.links.sasCertframe.image.repository }}:{{ .Values.links.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.links.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.links.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.links.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-list-data
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-list-data
    sas.com/component-version: 1.custom45.custom8-20240905.custom1725549997755
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom45.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-list-data
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-list-data
        app.kubernetes.io/name: sas-list-data
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-list-data
        sas.com/component-version: 1.custom45.custom8-20240905.custom1725549997755
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom45.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-list-data
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.listData.sasListData.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.listData.sasListData.image.repository }}:{{ .Values.listData.sasListData.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.listData.sasListData.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-list-data
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.listData.sasListData.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.listData.sasListData.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.listData.sasStartSequencer.image.repository }}:{{ .Values.listData.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.listData.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.listData.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.listData.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.listData.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.listData.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.listData.sasCertframe.image.repository }}:{{ .Values.listData.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.listData.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.listData.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.listData.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.listData.hydrator.image.repository }}:{{ .Values.listData.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.listData.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.listData.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.listData.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.listData.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.listData.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.listData.sasDbMigrator.image.repository }}:{{ .Values.listData.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.listData.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.listData.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.listData.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.listData.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-localization
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-localization
    sas.com/component-version: 1.custom88.custom34-20241112.custom1731372488133
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom88.custom34
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-localization
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-localization
        app.kubernetes.io/name: sas-localization
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-localization
        sas.com/component-version: 1.custom88.custom34-20241112.custom1731372488133
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom88.custom34
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-localization
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.localization.sasLocalization.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.localization.sasLocalization.image.repository }}:{{ .Values.localization.sasLocalization.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.localization.sasLocalization.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-localization
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.localization.sasLocalization.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.localization.sasLocalization.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.localization.sasStartSequencer.image.repository }}:{{ .Values.localization.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.localization.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.localization.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.localization.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.localization.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.localization.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.localization.sasCertframe.image.repository }}:{{ .Values.localization.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.localization.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.localization.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.localization.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.localization.hydrator.image.repository }}:{{ .Values.localization.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.localization.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.localization.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.localization.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.localization.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.localization.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.localization.sasDbMigrator.image.repository }}:{{ .Values.localization.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.localization.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.localization.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.localization.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.localization.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-logon-app
  labels:
    sas.com/admin: namespace
    sas.com/api-root-context: SASLogon
    sas.com/backup-role: provider
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/sas-backup-datasource-types: service
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-logon-app
    sas.com/component-version: 3.custom28.custom3-20240911.custom1726087061124
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/restore-exclude-schema-names: logon
    sas.com/restore-exclude-schema-scope: provider,tenant
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom28.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-logon-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-logon-app
        app.kubernetes.io/name: sas-logon-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-logon-app
        sas.com/component-version: 3.custom28.custom3-20240911.custom1726087061124
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom28.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-logon-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.logonApp.sasLogonApp.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.logonApp.sasLogonApp.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.logonApp.sasLogonApp.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.logonApp.sasLogonApp.image.repository }}:{{ .Values.logonApp.sasLogonApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.logonApp.sasLogonApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-logon-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.logonApp.sasLogonApp.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.logonApp.sasLogonApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.logonApp.sasStartSequencer.image.repository }}:{{ .Values.logonApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.logonApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.logonApp.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.logonApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.logonApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.logonApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.logonApp.sasCertframe.image.repository }}:{{ .Values.logonApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.logonApp.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.logonApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.logonApp.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-microanalytic-score
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-microanalytic-score
    sas.com/component-version: 2.custom402.custom56-20241126.custom1732657782630
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom402.custom56
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-microanalytic-score
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-microanalytic-score
        app.kubernetes.io/name: sas-microanalytic-score
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-microanalytic-score
        sas.com/component-version: 2.custom402.custom56-20241126.custom1732657782630
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom402.custom56
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-microanalytic-score
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.microanalyticScore.sasMicroanalyticScore.env.sasK8SDeploymentName
            }}
        - name: NLP_VIYA_LANG_BINARIES
          value: {{ quote .Values.microanalyticScore.sasMicroanalyticScore.env.nlpViyaLangBinaries
            }}
        - name: TKPARSE_BINDAT_DIR
          value: {{ quote .Values.microanalyticScore.sasMicroanalyticScore.env.tkparseBindatDir
            }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.microanalyticScore.sasMicroanalyticScore.env.sasEventConfigurationArkeEnabled
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-microanalytic-score-db-config-hb5kfk752t
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-open-source-config-python-k944mgb256
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-open-source-config-python-mas-td4b6ggbbm
        image: '{{ .Values.microanalyticScore.sasMicroanalyticScore.image.repository }}:{{
          .Values.microanalyticScore.sasMicroanalyticScore.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.microanalyticScore.sasMicroanalyticScore.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-microanalytic-score
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.microanalyticScore.sasMicroanalyticScore.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.sasMicroanalyticScore.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/etc/licenses
          name: sas-license
          readOnly: true
        - mountPath: /opt/sas/viya/home/commonfiles
          name: commonfilesvols
          readOnly: true
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
        - mountPath: /rdutil
          name: sas-rdutil-dir
        - mountPath: /opt/sas/viya/home/share/refdata/qkb
          name: sas-quality-knowledge-base-volume
        - mountPath: /models/astores/viya
          name: astores-volume
          subPath: models
        - mountPath: /models/resources/viya
          name: astores-volume
          subPath: resources
      - command:
        - $(MAS_PYPATH)
        - $(MAS_M2PATH)
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-open-source-config-python-k944mgb256
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-open-source-config-python-mas-td4b6ggbbm
        image: '{{ .Values.microanalyticScore.viya4MasPythonRunner.image.repository }}:{{
          .Values.microanalyticScore.viya4MasPythonRunner.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.microanalyticScore.viya4MasPythonRunner.imagePullPolicy
          }}
        name: viya4-mas-python-runner
        resources: {{- toYaml .Values.microanalyticScore.viya4MasPythonRunner.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.viya4MasPythonRunner.containerSecurityContext
          | nindent 10 }}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /tmp
          name: pytmp
        - mountPath: /python
          name: python-volume
          readOnly: true
        - mountPath: /models/resources/viya
          name: astores-volume
          subPath: resources
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.microanalyticScore.sasStartSequencer.image.repository }}:{{ .Values.microanalyticScore.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.microanalyticScore.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.microanalyticScore.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.microanalyticScore.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.microanalyticScore.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.microanalyticScore.sasCertframe.image.repository }}:{{ .Values.microanalyticScore.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.microanalyticScore.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - env:
        - name: SAS_K8S_POD_NAME
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.name
        - name: SAS_K8S_NAMESPACE
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: metadata.namespace
        - name: SAS_INIT_CONFIG_PATH
          value: {{ quote .Values.microanalyticScore.sasConfigInit.env.sasInitConfigPath
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.microanalyticScore.sasConfigInit.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-access-config-mm6fhg8gc7
        image: {{ .Values.microanalyticScore.sasConfigInit.image.repository }}:{{ .Values.microanalyticScore.sasConfigInit.image.tag
          | default .Chart.AppVersion }}
        name: sas-config-init
        resources: {{- toYaml .Values.microanalyticScore.sasConfigInit.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.sasConfigInit.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /cas/config
          name: tmp
        - mountPath: /opt/sas/viya/home/commonfiles
          name: commonfilesvols
        - mountPath: /security
          name: security
      - command:
        - /opt/sas/viya/home/bin/commonfiles-init.sh
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: '{{ .Values.microanalyticScore.sasCommonfilesInit.image.repository }}:{{
          .Values.microanalyticScore.sasCommonfilesInit.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.microanalyticScore.sasCommonfilesInit.imagePullPolicy
          }}
        name: sas-commonfiles-init
        resources: {{- toYaml .Values.microanalyticScore.sasCommonfilesInit.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.microanalyticScore.sasCommonfilesInit.containerSecurityContext
          | nindent 10 }}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/home/commonfiles
          name: commonfilesvols
      securityContext: {{- toYaml .Values.microanalyticScore.podSecurityContext | nindent
        8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-microanalytic-score
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: sas-license
        secret:
          items:
          - key: SAS_LICENSE
            path: default
          secretName: {{ include "sas-viya-helm.fullname" . }}-license-996thbcbkg
      - name: commonfilesvols
        persistentVolumeClaim:
          claimName: {{ include "sas-viya-helm.fullname" . }}-commonfiles
          readOnly: true
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
      - name: sas-quality-knowledge-base-volume
        persistentVolumeClaim:
          claimName: {{ include "sas-viya-helm.fullname" . }}-quality-knowledge-base
      - configMap:
          defaultMode: 493
          name: {{ include "sas-viya-helm.fullname" . }}-qkb-management-scripts
        name: sas-rdutil-dir
      - emptyDir: {}
        name: pytmp
      - name: python-volume
        nfs:
          path: /NAS_SAS_VIYA_DATA_PRD/viyapython/Python-3.custom10
          server: 10.custom227.custom69.custom177
      - name: astores-volume
        nfs:
          path: /NAS_SAS_VIYA_DATA_PRD/models/resources/viya
          server: 10.custom227.custom69.custom177
      - name: astores-volume
        persistentVolumeClaim:
          claimName: {{ include "sas-viya-helm.fullname" . }}-microanalytic-score-astores
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-migration-manager
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-migration-manager
    sas.com/component-version: 3.custom8.custom0-20240905.custom1725505913256
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom8.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  replicas: {{ .Values.migrationManager.replicas }}
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-migration-manager
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-migration-manager
        app.kubernetes.io/name: sas-migration-manager
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-migration-manager
        sas.com/component-version: 3.custom8.custom0-20240905.custom1725505913256
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom8.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-migration-manager
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.migrationManager.sasMigrationManager.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.migrationManager.sasMigrationManager.image.repository }}:{{ .Values.migrationManager.sasMigrationManager.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.migrationManager.sasMigrationManager.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-migration-manager
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.migrationManager.sasMigrationManager.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.migrationManager.sasMigrationManager.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.migrationManager.sasStartSequencer.image.repository }}:{{ .Values.migrationManager.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.migrationManager.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.migrationManager.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.migrationManager.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.migrationManager.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.migrationManager.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.migrationManager.sasCertframe.image.repository }}:{{ .Values.migrationManager.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.migrationManager.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.migrationManager.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.migrationManager.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.migrationManager.hydrator.image.repository }}:{{ .Values.migrationManager.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.migrationManager.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.migrationManager.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.migrationManager.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.migrationManager.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.migrationManager.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.migrationManager.sasDbMigrator.image.repository }}:{{ .Values.migrationManager.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.migrationManager.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.migrationManager.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.migrationManager.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.migrationManager.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-ml-pipeline-automation
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-ml-pipeline-automation
    sas.com/component-version: 39.custom112.custom2-20240906.custom1725633076850
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 39.custom112.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-ml-pipeline-automation
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-ml-pipeline-automation
        app.kubernetes.io/name: sas-ml-pipeline-automation
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-ml-pipeline-automation
        sas.com/component-version: 39.custom112.custom2-20240906.custom1725633076850
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 39.custom112.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-ml-pipeline-automation
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.mlPipelineAutomation.sasMlPipelineAutomation.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.mlPipelineAutomation.sasMlPipelineAutomation.image.repository
          }}:{{ .Values.mlPipelineAutomation.sasMlPipelineAutomation.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.mlPipelineAutomation.sasMlPipelineAutomation.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 20
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-ml-pipeline-automation
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.mlPipelineAutomation.sasMlPipelineAutomation.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.mlPipelineAutomation.sasMlPipelineAutomation.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.mlPipelineAutomation.sasStartSequencer.image.repository }}:{{
          .Values.mlPipelineAutomation.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.mlPipelineAutomation.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.mlPipelineAutomation.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.mlPipelineAutomation.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.mlPipelineAutomation.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.mlPipelineAutomation.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.mlPipelineAutomation.sasCertframe.image.repository }}:{{ .Values.mlPipelineAutomation.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.mlPipelineAutomation.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.mlPipelineAutomation.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.mlPipelineAutomation.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.mlPipelineAutomation.hydrator.image.repository }}:{{ .Values.mlPipelineAutomation.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.mlPipelineAutomation.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.mlPipelineAutomation.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.mlPipelineAutomation.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.mlPipelineAutomation.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.mlPipelineAutomation.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.mlPipelineAutomation.sasDbMigrator.image.repository }}:{{ .Values.mlPipelineAutomation.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.mlPipelineAutomation.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.mlPipelineAutomation.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.mlPipelineAutomation.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.mlPipelineAutomation.podSecurityContext | nindent
        8 }}
      terminationGracePeriodSeconds: 30
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-mobile-investigator-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-mobile-investigator-app
    sas.com/component-version: 5.custom29.custom76-20241203.custom1733242601604
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 5.custom29.custom76
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-mobile-investigator-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-mobile-investigator-app
        app.kubernetes.io/name: sas-mobile-investigator-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-mobile-investigator-app
        sas.com/component-version: 5.custom29.custom76-20241203.custom1733242601604
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 5.custom29.custom76
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-mobile-investigator-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_CACHE_CONFIG_MEMBERSHIPPORTRANGE
          value: {{ quote .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.env.sasCacheConfigMembershipportrange
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.image.repository
          }}:{{ .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-mobile-investigator-app
        ports:
        - containerPort: 35001
          name: cache1
        - containerPort: 35002
          name: cache2
        - containerPort: 35003
          name: cache3
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.mobileInvestigatorApp.sasMobileInvestigatorApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.mobileInvestigatorApp.sasStartSequencer.image.repository }}:{{
          .Values.mobileInvestigatorApp.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.mobileInvestigatorApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.mobileInvestigatorApp.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.mobileInvestigatorApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.mobileInvestigatorApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.mobileInvestigatorApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.mobileInvestigatorApp.sasCertframe.image.repository }}:{{ .Values.mobileInvestigatorApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.mobileInvestigatorApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.mobileInvestigatorApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.mobileInvestigatorApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-model-management
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-model-management
    sas.com/component-version: 4.custom2.custom0-20240912.custom1726122007953
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom2.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-model-management
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-model-management
        app.kubernetes.io/name: sas-model-management
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-model-management
        sas.com/component-version: 4.custom2.custom0-20240912.custom1726122007953
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom2.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-model-management
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.modelManagement.sasModelManagement.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelManagement.sasModelManagement.image.repository }}:{{ .Values.modelManagement.sasModelManagement.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagement.sasModelManagement.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-model-management
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.modelManagement.sasModelManagement.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagement.sasModelManagement.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.modelManagement.sasStartSequencer.image.repository }}:{{ .Values.modelManagement.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagement.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.modelManagement.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagement.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.modelManagement.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.modelManagement.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.modelManagement.sasCertframe.image.repository }}:{{ .Values.modelManagement.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.modelManagement.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagement.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.modelManagement.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.modelManagement.hydrator.image.repository }}:{{ .Values.modelManagement.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagement.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.modelManagement.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.modelManagement.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.modelManagement.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.modelManagement.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelManagement.sasDbMigrator.image.repository }}:{{ .Values.modelManagement.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagement.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.modelManagement.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagement.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.modelManagement.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-model-manager-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-model-manager-app
    sas.com/component-version: 4.custom2.custom42-20241217.custom1734468024887
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom2.custom42
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-model-manager-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-model-manager-app
        app.kubernetes.io/name: sas-model-manager-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-model-manager-app
        sas.com/component-version: 4.custom2.custom42-20241217.custom1734468024887
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom2.custom42
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-model-manager-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.modelManagerApp.sasModelManagerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelManagerApp.sasModelManagerApp.image.repository }}:{{ .Values.modelManagerApp.sasModelManagerApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagerApp.sasModelManagerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-model-manager-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.modelManagerApp.sasModelManagerApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagerApp.sasModelManagerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.modelManagerApp.sasStartSequencer.image.repository }}:{{ .Values.modelManagerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelManagerApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.modelManagerApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.modelManagerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.modelManagerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.modelManagerApp.sasCertframe.image.repository }}:{{ .Values.modelManagerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.modelManagerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelManagerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.modelManagerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-model-publish
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-model-publish
    sas.com/component-version: 4.custom2.custom6-20240909.custom1725916014301
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom2.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-model-publish
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-model-publish
        app.kubernetes.io/name: sas-model-publish
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-model-publish
        sas.com/component-version: 4.custom2.custom6-20240909.custom1725916014301
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom2.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-model-publish
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.modelPublish.sasModelPublish.env.sasK8SDeploymentName
            }}
        - name: MY_POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-input-4f545bc4g8
        image: {{ .Values.modelPublish.sasModelPublish.image.repository }}:{{ .Values.modelPublish.sasModelPublish.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelPublish.sasModelPublish.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-model-publish
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.modelPublish.sasModelPublish.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelPublish.sasModelPublish.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.modelPublish.sasStartSequencer.image.repository }}:{{ .Values.modelPublish.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelPublish.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.modelPublish.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelPublish.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.modelPublish.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.modelPublish.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.modelPublish.sasCertframe.image.repository }}:{{ .Values.modelPublish.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.modelPublish.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.modelPublish.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.modelPublish.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.modelPublish.hydrator.image.repository }}:{{ .Values.modelPublish.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelPublish.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.modelPublish.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.modelPublish.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.modelPublish.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.modelPublish.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelPublish.sasDbMigrator.image.repository }}:{{ .Values.modelPublish.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelPublish.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.modelPublish.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.modelPublish.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.modelPublish.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-model-publish
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-model-repository
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-model-repository
    sas.com/component-version: 4.custom2.custom24-20241212.custom1734039196500
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom2.custom24
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-model-repository
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-model-repository
        app.kubernetes.io/name: sas-model-repository
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-model-repository
        sas.com/component-version: 4.custom2.custom24-20241212.custom1734039196500
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom2.custom24
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-model-repository
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.modelRepository.sasModelRepository.env.sasK8SDeploymentName
            }}
        - name: SAS_AUTHORIZATION_CLIENT_CACHE_ENABLED
          value: {{ quote .Values.modelRepository.sasModelRepository.env.sasAuthorizationClientCacheEnabled
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelRepository.sasModelRepository.image.repository }}:{{ .Values.modelRepository.sasModelRepository.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelRepository.sasModelRepository.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-model-repository
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.modelRepository.sasModelRepository.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelRepository.sasModelRepository.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
        - mountPath: /models/astores/viya
          name: astores-volume
          subPath: models
        - mountPath: /models/resources/viya
          name: astores-volume
          subPath: resources
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.modelRepository.sasStartSequencer.image.repository }}:{{ .Values.modelRepository.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelRepository.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.modelRepository.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelRepository.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.modelRepository.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.modelRepository.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.modelRepository.sasCertframe.image.repository }}:{{ .Values.modelRepository.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.modelRepository.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelRepository.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.modelRepository.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.modelRepository.hydrator.image.repository }}:{{ .Values.modelRepository.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelRepository.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.modelRepository.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.modelRepository.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.modelRepository.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.modelRepository.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelRepository.sasDbMigrator.image.repository }}:{{ .Values.modelRepository.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelRepository.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.modelRepository.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelRepository.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.modelRepository.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
      - name: astores-volume
        persistentVolumeClaim:
          claimName: {{ include "sas-viya-helm.fullname" . }}-microanalytic-score-astores
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-model-studio-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-model-studio-app
    sas.com/component-version: 1.custom359.custom49-20241126.custom1732641424071
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom359.custom49
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-model-studio-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-model-studio-app
        app.kubernetes.io/name: sas-model-studio-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-model-studio-app
        sas.com/component-version: 1.custom359.custom49-20241126.custom1732641424071
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom359.custom49
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-model-studio-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.modelStudioApp.sasModelStudioApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.modelStudioApp.sasModelStudioApp.image.repository }}:{{ .Values.modelStudioApp.sasModelStudioApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelStudioApp.sasModelStudioApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-model-studio-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.modelStudioApp.sasModelStudioApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelStudioApp.sasModelStudioApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.modelStudioApp.sasStartSequencer.image.repository }}:{{ .Values.modelStudioApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.modelStudioApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.modelStudioApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.modelStudioApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.modelStudioApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.modelStudioApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.modelStudioApp.sasCertframe.image.repository }}:{{ .Values.modelStudioApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.modelStudioApp.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.modelStudioApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.modelStudioApp.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-natural-language-generation
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-natural-language-generation
    sas.com/component-version: 1.custom39.custom1-20240906.custom1725641924919
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom39.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-natural-language-generation
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-natural-language-generation
        app.kubernetes.io/name: sas-natural-language-generation
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-natural-language-generation
        sas.com/component-version: 1.custom39.custom1-20240906.custom1725641924919
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom39.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-natural-language-generation
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.image.repository
          }}:{{ .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.image.tag
          | default .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-natural-language-generation
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.naturalLanguageGeneration.sasNaturalLanguageGeneration.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.naturalLanguageGeneration.sasStartSequencer.image.repository
          }}:{{ .Values.naturalLanguageGeneration.sasStartSequencer.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.naturalLanguageGeneration.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.naturalLanguageGeneration.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.naturalLanguageGeneration.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.naturalLanguageGeneration.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.naturalLanguageGeneration.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.naturalLanguageGeneration.sasCertframe.image.repository }}:{{
          .Values.naturalLanguageGeneration.sasCertframe.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe
        resources: {{- toYaml .Values.naturalLanguageGeneration.sasCertframe.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.naturalLanguageGeneration.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.naturalLanguageGeneration.podSecurityContext
        | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-office-addin-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-office-addin-app
    sas.com/component-version: 1.custom58.custom0-20240905.custom1725570391756
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom58.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-office-addin-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-office-addin-app
        app.kubernetes.io/name: sas-office-addin-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-office-addin-app
        sas.com/component-version: 1.custom58.custom0-20240905.custom1725570391756
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom58.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-office-addin-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.officeAddinApp.sasOfficeAddinApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.officeAddinApp.sasOfficeAddinApp.image.repository }}:{{ .Values.officeAddinApp.sasOfficeAddinApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.officeAddinApp.sasOfficeAddinApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-office-addin-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.officeAddinApp.sasOfficeAddinApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.officeAddinApp.sasOfficeAddinApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.officeAddinApp.sasStartSequencer.image.repository }}:{{ .Values.officeAddinApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.officeAddinApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.officeAddinApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.officeAddinApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.officeAddinApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.officeAddinApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.officeAddinApp.sasCertframe.image.repository }}:{{ .Values.officeAddinApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.officeAddinApp.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.officeAddinApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.officeAddinApp.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-opendistro-operator
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/zero-scale-phase: "1"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-opendistro-operator
    sas.com/component-version: 7.custom37.custom5-20241010.custom1728552675911
    sas.com/kustomize-base: golang
    sas.com/version: 7.custom37.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  replicas: {{ .Values.opendistroOperator.replicas }}
  selector:
    matchLabels:
      name: sas-opendistro-operator
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      labels:
        app: sas-opendistro-operator
        app.kubernetes.io/name: sas-opendistro-operator
        name: sas-opendistro-operator
        sas.com/deployment: sas-viya
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: "8081"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-opendistro-operator
        sas.com/component-version: 7.custom37.custom5-20241010.custom1728552675911
        sas.com/kustomize-base: golang
        sas.com/tls-enabled-ports: all
        sas.com/version: 7.custom37.custom5
        sidecar.istio.io/inject: "false"
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-opendistro-operator
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - args: {{- toYaml .Values.opendistroOperator.sasOpendistroOperator.args | nindent
          8 }}
        command:
        - opendistro-operator
        env:
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: OPERATOR_NAME
          value: {{ quote .Values.opendistroOperator.sasOpendistroOperator.env.operatorName
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.opendistroOperator.sasOpendistroOperator.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.opendistroOperator.sasOpendistroOperator.image.repository }}:{{
          .Values.opendistroOperator.sasOpendistroOperator.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.opendistroOperator.sasOpendistroOperator.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: sas-opendistro-operator
        resources: {{- toYaml .Values.opendistroOperator.sasOpendistroOperator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.opendistroOperator.sasOpendistroOperator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: serviceaccount-token
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.opendistroOperator.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.opendistroOperator.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.opendistroOperator.sasCertframe.image.repository }}:{{ .Values.opendistroOperator.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.opendistroOperator.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.opendistroOperator.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.opendistroOperator.podSecurityContext | nindent
        8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-opendistro-operator
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: serviceaccount-token
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 7200
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-preferences
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-preferences
    sas.com/component-version: 1.custom93.custom0-20240906.custom1725617554917
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom93.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-preferences
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-preferences
        app.kubernetes.io/name: sas-preferences
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-preferences
        sas.com/component-version: 1.custom93.custom0-20240906.custom1725617554917
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom93.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-preferences
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.preferences.sasPreferences.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.preferences.sasPreferences.image.repository }}:{{ .Values.preferences.sasPreferences.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.preferences.sasPreferences.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-preferences
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.preferences.sasPreferences.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.preferences.sasPreferences.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.preferences.sasStartSequencer.image.repository }}:{{ .Values.preferences.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.preferences.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.preferences.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.preferences.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.preferences.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.preferences.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.preferences.sasCertframe.image.repository }}:{{ .Values.preferences.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.preferences.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.preferences.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.preferences.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.preferences.hydrator.image.repository }}:{{ .Values.preferences.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.preferences.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.preferences.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.preferences.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.preferences.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.preferences.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.preferences.sasDbMigrator.image.repository }}:{{ .Values.preferences.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.preferences.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.preferences.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.preferences.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.preferences.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-prepull
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: none
    sas.com/component-name: sas-prepull
    sas.com/component-version: 2.custom7.custom17-20241126.custom1732651627357
    sas.com/kustomize-base: base
    sas.com/version: 2.custom7.custom17
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-prepull
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-prepull
        app.kubernetes.io/name: sas-prepull
        sas.com/deployment: sas-viya
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/scrape: "false"
        sas.com/certificate-file-format: none
        sas.com/component-name: sas-prepull
        sas.com/component-version: 2.custom7.custom17-20241126.custom1732651627357
        sas.com/kustomize-base: base
        sas.com/version: 2.custom7.custom17
        sidecar.istio.io/inject: "false"
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-prepull
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_PREPULL_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: SAS_SPEC_NODENAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.prepull.sasPrepull.image.repository }}:{{ .Values.prepull.sasPrepull.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.prepull.sasPrepull.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - /bin/sh
              - -c
              - while [ -e /tmp/sas-prepull.running ]; do sleep 1; done; sleep 5;
        name: sas-prepull
        resources: {{- toYaml .Values.prepull.sasPrepull.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.prepull.sasPrepull.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /tmp
          name: tmp
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      securityContext: {{- toYaml .Values.prepull.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-prepull
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-readiness
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-readiness
    sas.com/component-version: 1.custom19.custom2-20240906.custom1725656041920
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom19.custom2
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-readiness
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-readiness
        app.kubernetes.io/name: sas-readiness
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-readiness
        sas.com/component-version: 1.custom19.custom2-20240906.custom1725656041920
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom19.custom2
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-readiness
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.readiness.sasReadiness.env.sasK8SDeploymentName }}
        - name: SAS_K8S_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.readiness.sasReadiness.image.repository }}:{{ .Values.readiness.sasReadiness.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.readiness.sasReadiness.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-readiness
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.readiness.sasReadiness.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.readiness.sasReadiness.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.readiness.sasStartSequencer.image.repository }}:{{ .Values.readiness.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.readiness.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.readiness.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.readiness.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.readiness.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.readiness.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.readiness.sasCertframe.image.repository }}:{{ .Values.readiness.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.readiness.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.readiness.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.readiness.podSecurityContext | nindent 8 }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-readiness
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-redis-operator
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    sas.com/zero-scale-phase: "1"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-redis-operator
    sas.com/component-version: 1.custom14.custom12-20240911.custom1726069464254
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: exec
    sas.com/pod-uses-readiness-probe: exec
    sas.com/pod-uses-startup-probe: exec
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom14.custom12
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-redis-operator
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-redis-operator
        app.kubernetes.io/name: sas-redis-operator
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/scheme: https
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-redis-operator
        sas.com/component-version: 1.custom14.custom12-20240911.custom1726069464254
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: exec
        sas.com/pod-uses-readiness-probe: exec
        sas.com/pod-uses-startup-probe: exec
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom14.custom12
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-redis-operator
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: true
      containers:
      - args: {{- toYaml .Values.redisOperator.sasRedisOperator.args | nindent 8 }}
        command:
        - /usr/local/bin/tini
        - --
        - redis-operator
        env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.redisOperator.sasRedisOperator.env.sasK8SDeploymentName
            }}
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.redisOperator.sasRedisOperator.image.repository }}:{{ .Values.redisOperator.sasRedisOperator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.redisOperator.sasRedisOperator.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          exec:
            command:
            - pgrep
            - redis-operator
          initialDelaySeconds: 5
          periodSeconds: 30
          timeoutSeconds: 10
        name: sas-redis-operator
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          exec:
            command:
            - pgrep
            - redis-operator
          initialDelaySeconds: 5
          timeoutSeconds: 10
        resources: {{- toYaml .Values.redisOperator.sasRedisOperator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.redisOperator.sasRedisOperator.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          exec:
            command:
            - pgrep
            - redis-operator
          failureThreshold: 30
          periodSeconds: 10
          timeoutSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /etc/redisconf
          name: redisconf
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.redisOperator.sasStartSequencer.image.repository }}:{{ .Values.redisOperator.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.redisOperator.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.redisOperator.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.redisOperator.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.redisOperator.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.redisOperator.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.redisOperator.sasCertframe.image.repository }}:{{ .Values.redisOperator.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.redisOperator.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.redisOperator.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - env:
        - name: SAS_KEYS_SECRET_NAME
          value: {{ quote .Values.redisOperator.sasCertframeTokenGenerator.env.sasKeysSecretName
            }}
        - name: SAS_KEYS_KEY_NAMES
          value: {{ quote .Values.redisOperator.sasCertframeTokenGenerator.env.sasKeysKeyNames
            }}
        - name: SAS_SECURITY_ARTIFACTS_DIR
          value: {{ quote .Values.redisOperator.sasCertframeTokenGenerator.env.sasSecurityArtifactsDir
            }}
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.redisOperator.sasCertframeTokenGenerator.env.sasCertframeTokenDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: '{{ .Values.redisOperator.sasCertframeTokenGenerator.image.repository }}:{{
          .Values.redisOperator.sasCertframeTokenGenerator.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe-token-generator
        resources: {{- toYaml .Values.redisOperator.sasCertframeTokenGenerator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.redisOperator.sasCertframeTokenGenerator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /security
          name: security
        - mountPath: /certframe-token
          name: certframe-token
      securityContext: {{- toYaml .Values.redisOperator.podSecurityContext | nindent 8
        }}
      serviceAccountName: {{ include "sas-viya-helm.fullname" . }}-redis-operator
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-redis-admin-5h74thmbkg
        name: redisconf
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-reference-data
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-reference-data
    sas.com/component-version: 9.custom5.custom18-20241203.custom1733236784919
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 9.custom5.custom18
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-reference-data
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-reference-data
        app.kubernetes.io/name: sas-reference-data
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-reference-data
        sas.com/component-version: 9.custom5.custom18-20241203.custom1733236784919
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 9.custom5.custom18
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-reference-data
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.referenceData.sasReferenceData.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.referenceData.sasReferenceData.image.repository }}:{{ .Values.referenceData.sasReferenceData.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.referenceData.sasReferenceData.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-reference-data
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.referenceData.sasReferenceData.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.referenceData.sasReferenceData.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.referenceData.sasStartSequencer.image.repository }}:{{ .Values.referenceData.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.referenceData.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.referenceData.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.referenceData.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.referenceData.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.referenceData.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.referenceData.sasCertframe.image.repository }}:{{ .Values.referenceData.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.referenceData.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.referenceData.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.referenceData.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-report-alerts
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-report-alerts
    sas.com/component-version: 4.custom112.custom6-20240906.custom1725626587296
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom112.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-report-alerts
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-report-alerts
        app.kubernetes.io/name: sas-report-alerts
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-report-alerts
        sas.com/component-version: 4.custom112.custom6-20240906.custom1725626587296
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom112.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-report-alerts
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.reportAlerts.sasReportAlerts.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.reportAlerts.sasReportAlerts.image.repository }}:{{ .Values.reportAlerts.sasReportAlerts.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportAlerts.sasReportAlerts.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-report-alerts
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.reportAlerts.sasReportAlerts.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportAlerts.sasReportAlerts.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.reportAlerts.sasStartSequencer.image.repository }}:{{ .Values.reportAlerts.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportAlerts.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.reportAlerts.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportAlerts.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.reportAlerts.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.reportAlerts.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.reportAlerts.sasCertframe.image.repository }}:{{ .Values.reportAlerts.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.reportAlerts.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.reportAlerts.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.reportAlerts.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.reportAlerts.hydrator.image.repository }}:{{ .Values.reportAlerts.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportAlerts.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.reportAlerts.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.reportAlerts.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.reportAlerts.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.reportAlerts.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.reportAlerts.sasDbMigrator.image.repository }}:{{ .Values.reportAlerts.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportAlerts.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.reportAlerts.sasDbMigrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.reportAlerts.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.reportAlerts.podSecurityContext | nindent 8 }}
      terminationGracePeriodSeconds: 60
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-report-distribution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-report-distribution
    sas.com/component-version: 2.custom106.custom7-20240906.custom1725626718885
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom106.custom7
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-report-distribution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-report-distribution
        app.kubernetes.io/name: sas-report-distribution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-report-distribution
        sas.com/component-version: 2.custom106.custom7-20240906.custom1725626718885
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom106.custom7
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-report-distribution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.reportDistribution.sasReportDistribution.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.reportDistribution.sasReportDistribution.image.repository }}:{{
          .Values.reportDistribution.sasReportDistribution.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.reportDistribution.sasReportDistribution.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-report-distribution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.reportDistribution.sasReportDistribution.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.reportDistribution.sasReportDistribution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.reportDistribution.sasStartSequencer.image.repository }}:{{ .Values.reportDistribution.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportDistribution.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.reportDistribution.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.reportDistribution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.reportDistribution.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.reportDistribution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.reportDistribution.sasCertframe.image.repository }}:{{ .Values.reportDistribution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.reportDistribution.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportDistribution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.reportDistribution.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.reportDistribution.hydrator.image.repository }}:{{ .Values.reportDistribution.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportDistribution.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.reportDistribution.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.reportDistribution.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.reportDistribution.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.reportDistribution.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.reportDistribution.sasDbMigrator.image.repository }}:{{ .Values.reportDistribution.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportDistribution.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.reportDistribution.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportDistribution.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.reportDistribution.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-report-execution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-report-execution
    sas.com/component-version: 2.custom291.custom10-20241204.custom1733331324770
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom291.custom10
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-report-execution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-report-execution
        app.kubernetes.io/name: sas-report-execution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-report-execution
        sas.com/component-version: 2.custom291.custom10-20241204.custom1733331324770
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom291.custom10
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-report-execution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.reportExecution.sasReportExecution.env.sasK8SDeploymentName
            }}
        - name: JAVA_OPTION_SERVER_PORT
          value: {{ quote .Values.reportExecution.sasReportExecution.env.javaOptionServerPort
            }}
        - name: MANAGEMENT_SERVER_PORT
          value: {{ quote .Values.reportExecution.sasReportExecution.env.managementServerPort
            }}
        - name: SAS_URL_reportData
          value: {{ quote .Values.reportExecution.sasReportExecution.env.sasUrlReportdata
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.reportExecution.sasReportExecution.image.repository }}:{{ .Values.reportExecution.sasReportExecution.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportExecution.sasReportExecution.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-report-execution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.reportExecution.sasReportExecution.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportExecution.sasReportExecution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.reportExecution.sasStartSequencer.image.repository }}:{{ .Values.reportExecution.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportExecution.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.reportExecution.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportExecution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.reportExecution.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.reportExecution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.reportExecution.sasCertframe.image.repository }}:{{ .Values.reportExecution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.reportExecution.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportExecution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.reportExecution.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-report-renderers
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-report-renderers
    sas.com/component-version: 5.custom34.custom11-20240909.custom1725895159031
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 5.custom34.custom11
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-report-renderers
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-report-renderers
        app.kubernetes.io/name: sas-report-renderers
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-report-renderers
        sas.com/component-version: 5.custom34.custom11-20240909.custom1725895159031
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 5.custom34.custom11
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-report-renderers
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.reportRenderers.sasReportRenderers.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.reportRenderers.sasReportRenderers.image.repository }}:{{ .Values.reportRenderers.sasReportRenderers.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportRenderers.sasReportRenderers.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-report-renderers
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.reportRenderers.sasReportRenderers.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportRenderers.sasReportRenderers.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.reportRenderers.sasStartSequencer.image.repository }}:{{ .Values.reportRenderers.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportRenderers.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.reportRenderers.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportRenderers.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.reportRenderers.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.reportRenderers.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.reportRenderers.sasCertframe.image.repository }}:{{ .Values.reportRenderers.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.reportRenderers.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportRenderers.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.reportRenderers.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.reportRenderers.hydrator.image.repository }}:{{ .Values.reportRenderers.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportRenderers.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.reportRenderers.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.reportRenderers.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.reportRenderers.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.reportRenderers.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.reportRenderers.sasDbMigrator.image.repository }}:{{ .Values.reportRenderers.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.reportRenderers.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.reportRenderers.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportRenderers.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.reportRenderers.podSecurityContext | nindent
        8 }}
      terminationGracePeriodSeconds: 60
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-report-services-group
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-report-services-group
    sas.com/component-version: 4.custom117.custom34-20241203.custom1733241784991
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom117.custom34
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-report-services-group
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-report-services-group
        app.kubernetes.io/name: sas-report-services-group
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-report-services-group
        sas.com/component-version: 4.custom117.custom34-20241203.custom1733241784991
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom117.custom34
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-report-services-group
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.reportServicesGroup.sasReportServicesGroup.env.sasK8SDeploymentName
            }}
        - name: JAVA_OPTION_SERVER_PORT
          value: {{ quote .Values.reportServicesGroup.sasReportServicesGroup.env.javaOptionServerPort
            }}
        - name: MANAGEMENT_SERVER_PORT
          value: {{ quote .Values.reportServicesGroup.sasReportServicesGroup.env.managementServerPort
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.reportServicesGroup.sasReportServicesGroup.image.repository }}:{{
          .Values.reportServicesGroup.sasReportServicesGroup.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.reportServicesGroup.sasReportServicesGroup.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-report-services-group
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.reportServicesGroup.sasReportServicesGroup.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.reportServicesGroup.sasReportServicesGroup.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.reportServicesGroup.sasStartSequencer.image.repository }}:{{
          .Values.reportServicesGroup.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.reportServicesGroup.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.reportServicesGroup.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.reportServicesGroup.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.reportServicesGroup.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.reportServicesGroup.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.reportServicesGroup.sasCertframe.image.repository }}:{{ .Values.reportServicesGroup.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.reportServicesGroup.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.reportServicesGroup.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.reportServicesGroup.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-rfc-solution-app
    sas.com/component-version: 1.custom0.custom3-20240910.custom1725989220758
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom0.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-rfc-solution-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-rfc-solution-app
        app.kubernetes.io/name: sas-rfc-solution-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-rfc-solution-app
        sas.com/component-version: 1.custom0.custom3-20240910.custom1725989220758
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom0.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-rfc-solution-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.rfcSolutionApp.sasRfcSolutionApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.rfcSolutionApp.sasRfcSolutionApp.image.repository }}:{{ .Values.rfcSolutionApp.sasRfcSolutionApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.rfcSolutionApp.sasRfcSolutionApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-rfc-solution-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.rfcSolutionApp.sasRfcSolutionApp.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.rfcSolutionApp.sasRfcSolutionApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.rfcSolutionApp.sasStartSequencer.image.repository }}:{{ .Values.rfcSolutionApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.rfcSolutionApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.rfcSolutionApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.rfcSolutionApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.rfcSolutionApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.rfcSolutionApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.rfcSolutionApp.sasCertframe.image.repository }}:{{ .Values.rfcSolutionApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.rfcSolutionApp.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.rfcSolutionApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.rfcSolutionApp.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-rfc-solution-config
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-rfc-solution-config
    sas.com/component-version: 1.custom62.custom13-20240910.custom1725989197438
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom62.custom13
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-rfc-solution-config
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-rfc-solution-config
        app.kubernetes.io/name: sas-rfc-solution-config
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-rfc-solution-config
        sas.com/component-version: 1.custom62.custom13-20240910.custom1725989197438
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom62.custom13
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-rfc-solution-config
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.rfcSolutionConfig.sasRfcSolutionConfig.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.rfcSolutionConfig.sasRfcSolutionConfig.image.repository }}:{{
          .Values.rfcSolutionConfig.sasRfcSolutionConfig.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.rfcSolutionConfig.sasRfcSolutionConfig.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-rfc-solution-config
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.rfcSolutionConfig.sasRfcSolutionConfig.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.rfcSolutionConfig.sasRfcSolutionConfig.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.rfcSolutionConfig.sasStartSequencer.image.repository }}:{{ .Values.rfcSolutionConfig.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.rfcSolutionConfig.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.rfcSolutionConfig.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.rfcSolutionConfig.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.rfcSolutionConfig.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.rfcSolutionConfig.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.rfcSolutionConfig.sasCertframe.image.repository }}:{{ .Values.rfcSolutionConfig.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.rfcSolutionConfig.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.rfcSolutionConfig.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.rfcSolutionConfig.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-scheduler
  labels:
    sas.com/admin: namespace
    sas.com/api-root-context: scheduler
    sas.com/backup-role: provider
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/sas-backup-datasource-types: service
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-scheduler
    sas.com/component-version: 4.custom9.custom5-20240910.custom1725974624458
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/restore-exclude-schema-names: scheduler
    sas.com/restore-exclude-schema-scope: provider,tenant
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom9.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-scheduler
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-scheduler
        app.kubernetes.io/name: sas-scheduler
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-scheduler
        sas.com/component-version: 4.custom9.custom5-20240910.custom1725974624458
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom9.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-scheduler
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.scheduler.sasScheduler.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.scheduler.sasScheduler.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.scheduler.sasScheduler.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.scheduler.sasScheduler.image.repository }}:{{ .Values.scheduler.sasScheduler.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scheduler.sasScheduler.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-scheduler
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.scheduler.sasScheduler.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.scheduler.sasScheduler.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.scheduler.sasStartSequencer.image.repository }}:{{ .Values.scheduler.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scheduler.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.scheduler.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.scheduler.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.scheduler.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.scheduler.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.scheduler.sasCertframe.image.repository }}:{{ .Values.scheduler.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.scheduler.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.scheduler.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.scheduler.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-score-definitions
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-score-definitions
    sas.com/component-version: 2.custom42.custom5-20240904.custom1725475979887
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom42.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-score-definitions
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-score-definitions
        app.kubernetes.io/name: sas-score-definitions
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-score-definitions
        sas.com/component-version: 2.custom42.custom5-20240904.custom1725475979887
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom42.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-score-definitions
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.scoreDefinitions.sasScoreDefinitions.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.scoreDefinitions.sasScoreDefinitions.image.repository }}:{{ .Values.scoreDefinitions.sasScoreDefinitions.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreDefinitions.sasScoreDefinitions.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-score-definitions
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.scoreDefinitions.sasScoreDefinitions.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.scoreDefinitions.sasScoreDefinitions.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.scoreDefinitions.sasStartSequencer.image.repository }}:{{ .Values.scoreDefinitions.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreDefinitions.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.scoreDefinitions.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreDefinitions.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.scoreDefinitions.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.scoreDefinitions.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.scoreDefinitions.sasCertframe.image.repository }}:{{ .Values.scoreDefinitions.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.scoreDefinitions.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreDefinitions.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.scoreDefinitions.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.scoreDefinitions.hydrator.image.repository }}:{{ .Values.scoreDefinitions.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreDefinitions.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.scoreDefinitions.hydrator.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.scoreDefinitions.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.scoreDefinitions.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.scoreDefinitions.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.scoreDefinitions.sasDbMigrator.image.repository }}:{{ .Values.scoreDefinitions.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreDefinitions.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.scoreDefinitions.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreDefinitions.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.scoreDefinitions.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-score-execution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-score-execution
    sas.com/component-version: 2.custom45.custom5-20240904.custom1725475929637
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom45.custom5
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-score-execution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-score-execution
        app.kubernetes.io/name: sas-score-execution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-score-execution
        sas.com/component-version: 2.custom45.custom5-20240904.custom1725475929637
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom45.custom5
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-score-execution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.scoreExecution.sasScoreExecution.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.scoreExecution.sasScoreExecution.image.repository }}:{{ .Values.scoreExecution.sasScoreExecution.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreExecution.sasScoreExecution.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-score-execution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.scoreExecution.sasScoreExecution.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreExecution.sasScoreExecution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.scoreExecution.sasStartSequencer.image.repository }}:{{ .Values.scoreExecution.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreExecution.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.scoreExecution.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreExecution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.scoreExecution.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.scoreExecution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.scoreExecution.sasCertframe.image.repository }}:{{ .Values.scoreExecution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.scoreExecution.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.scoreExecution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.scoreExecution.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.scoreExecution.hydrator.image.repository }}:{{ .Values.scoreExecution.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreExecution.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.scoreExecution.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.scoreExecution.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.scoreExecution.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.scoreExecution.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.scoreExecution.sasDbMigrator.image.repository }}:{{ .Values.scoreExecution.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.scoreExecution.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.scoreExecution.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.scoreExecution.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.scoreExecution.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-search
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-search
    sas.com/component-version: 2.custom96.custom1-20241003.custom1727966815284
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom96.custom1
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-search
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-search
        app.kubernetes.io/name: sas-search
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-search
        sas.com/component-version: 2.custom96.custom1-20241003.custom1727966815284
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom96.custom1
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-search
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.search.sasSearch.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.search.sasSearch.image.repository }}:{{ .Values.search.sasSearch.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.search.sasSearch.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-search
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.search.sasSearch.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.search.sasSearch.containerSecurityContext |
          nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.search.sasStartSequencer.image.repository }}:{{ .Values.search.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.search.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.search.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.search.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.search.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.search.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.search.sasCertframe.image.repository }}:{{ .Values.search.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.search.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.search.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.search.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.search.hydrator.image.repository }}:{{ .Values.search.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.search.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.search.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.search.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.search.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.search.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.search.sasDbMigrator.image.repository }}:{{ .Values.search.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.search.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.search.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.search.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.search.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-studio
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-studio
    sas.com/component-version: 1.custom37.custom0-20240906.custom1725655441018
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom37.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-studio
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-studio
        app.kubernetes.io/name: sas-studio
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-studio
        sas.com/component-version: 1.custom37.custom0-20240906.custom1725655441018
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom37.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-studio
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.studio.sasStudio.env.sasK8SDeploymentName }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_VERSION
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_VERSION
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_RELEASE
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_RELEASE
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_INIT_CODE_PATH
          valueFrom:
            configMapKeyRef:
              key: SAS_INIT_CODE_PATH
              name: {{ include "sas-viya-helm.fullname" . }}-studio-parameters-6bgm7fkkk8
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.studio.sasStudio.image.repository }}:{{ .Values.studio.sasStudio.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studio.sasStudio.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-studio
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.studio.sasStudio.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studio.sasStudio.containerSecurityContext |
          nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.studio.sasStartSequencer.image.repository }}:{{ .Values.studio.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studio.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.studio.sasStartSequencer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studio.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.studio.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.studio.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.studio.sasCertframe.image.repository }}:{{ .Values.studio.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.studio.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studio.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.studio.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.studio.hydrator.image.repository }}:{{ .Values.studio.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studio.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.studio.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studio.hydrator.containerSecurityContext |
          nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.studio.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.studio.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.studio.sasDbMigrator.image.repository }}:{{ .Values.studio.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studio.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.studio.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studio.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.studio.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-studio-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-studio-app
    sas.com/component-version: 6.custom1054.custom31-20241204.custom1733345359456
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 6.custom1054.custom31
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-studio-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-studio-app
        app.kubernetes.io/name: sas-studio-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-studio-app
        sas.com/component-version: 6.custom1054.custom31-20241204.custom1733345359456
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 6.custom1054.custom31
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-studio-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.studioApp.sasStudioApp.env.sasK8SDeploymentName }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_VERSION
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_VERSION
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_RELEASE
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_RELEASE
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: JAVA_OPTION_XMX
          value: {{ quote .Values.studioApp.sasStudioApp.env.javaOptionXmx }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.studioApp.sasStudioApp.image.repository }}:{{ .Values.studioApp.sasStudioApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studioApp.sasStudioApp.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-studio-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.studioApp.sasStudioApp.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studioApp.sasStudioApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.studioApp.sasStartSequencer.image.repository }}:{{ .Values.studioApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studioApp.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.studioApp.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.studioApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.studioApp.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.studioApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.studioApp.sasCertframe.image.repository }}:{{ .Values.studioApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.studioApp.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.studioApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.studioApp.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-studio-development
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-studio-development
    sas.com/component-version: 1.custom28.custom0-20240906.custom1725655356651
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom28.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-studio-development
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-studio-development
        app.kubernetes.io/name: sas-studio-development
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-studio-development
        sas.com/component-version: 1.custom28.custom0-20240906.custom1725655356651
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom28.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-studio-development
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.studioDevelopment.sasStudioDevelopment.env.sasK8SDeploymentName
            }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_VERSION
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_VERSION
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: SAS_CADENCE_RELEASE
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_RELEASE
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.studioDevelopment.sasStudioDevelopment.image.repository }}:{{
          .Values.studioDevelopment.sasStudioDevelopment.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.studioDevelopment.sasStudioDevelopment.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-studio-development
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.studioDevelopment.sasStudioDevelopment.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.studioDevelopment.sasStudioDevelopment.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.studioDevelopment.sasStartSequencer.image.repository }}:{{ .Values.studioDevelopment.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.studioDevelopment.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.studioDevelopment.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.studioDevelopment.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.studioDevelopment.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.studioDevelopment.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.studioDevelopment.sasCertframe.image.repository }}:{{ .Values.studioDevelopment.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.studioDevelopment.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.studioDevelopment.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.studioDevelopment.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-subject-contacts
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-subject-contacts
    sas.com/component-version: 4.custom2.custom6-20241203.custom1733236703704
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom2.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-subject-contacts
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-subject-contacts
        app.kubernetes.io/name: sas-subject-contacts
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-subject-contacts
        sas.com/component-version: 4.custom2.custom6-20241203.custom1733236703704
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom2.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-subject-contacts
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.subjectContacts.sasSubjectContacts.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.subjectContacts.sasSubjectContacts.image.repository }}:{{ .Values.subjectContacts.sasSubjectContacts.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.subjectContacts.sasSubjectContacts.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-subject-contacts
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.subjectContacts.sasSubjectContacts.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.subjectContacts.sasSubjectContacts.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.subjectContacts.sasStartSequencer.image.repository }}:{{ .Values.subjectContacts.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.subjectContacts.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.subjectContacts.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.subjectContacts.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.subjectContacts.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.subjectContacts.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.subjectContacts.sasCertframe.image.repository }}:{{ .Values.subjectContacts.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.subjectContacts.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.subjectContacts.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.subjectContacts.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-alert
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-alert
    sas.com/component-version: 15.custom28.custom31-20241216.custom1734366881788
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 15.custom28.custom31
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-alert
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-alert
        app.kubernetes.io/name: sas-svi-alert
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-alert
        sas.com/component-version: 15.custom28.custom31-20241216.custom1734366881788
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 15.custom28.custom31
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-alert
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_CACHE_CONFIG_MEMBERSHIPPORTRANGE
          value: {{ quote .Values.sviAlert.sasSviAlert.env.sasCacheConfigMembershipportrange
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviAlert.sasSviAlert.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviAlert.sasSviAlert.image.repository }}:{{ .Values.sviAlert.sasSviAlert.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviAlert.sasSviAlert.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-alert
        ports:
        - containerPort: 35001
          name: cache1
        - containerPort: 35002
          name: cache2
        - containerPort: 35003
          name: cache3
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviAlert.sasSviAlert.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviAlert.sasSviAlert.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviAlert.sasStartSequencer.image.repository }}:{{ .Values.sviAlert.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviAlert.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviAlert.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviAlert.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviAlert.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviAlert.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviAlert.sasCertframe.image.repository }}:{{ .Values.sviAlert.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviAlert.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviAlert.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviAlert.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-data-export
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-data-export
    sas.com/component-version: 3.custom29.custom11-20241128.custom1732800443312
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom29.custom11
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-data-export
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-data-export
        app.kubernetes.io/name: sas-svi-data-export
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-data-export
        sas.com/component-version: 3.custom29.custom11-20241128.custom1732800443312
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom29.custom11
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-data-export
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviDataExport.sasSviDataExport.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviDataExport.sasSviDataExport.image.repository }}:{{ .Values.sviDataExport.sasSviDataExport.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviDataExport.sasSviDataExport.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-data-export
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviDataExport.sasSviDataExport.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviDataExport.sasSviDataExport.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviDataExport.sasStartSequencer.image.repository }}:{{ .Values.sviDataExport.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviDataExport.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviDataExport.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviDataExport.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviDataExport.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviDataExport.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviDataExport.sasCertframe.image.repository }}:{{ .Values.sviDataExport.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviDataExport.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviDataExport.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviDataExport.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-datahub
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-datahub
    sas.com/component-version: 17.custom30.custom42-20241202.custom1733170785488
    sas.com/elasticsearch-consumer: "true"
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 17.custom30.custom42
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-datahub
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-datahub
        app.kubernetes.io/name: sas-svi-datahub
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-datahub
        sas.com/component-version: 17.custom30.custom42-20241202.custom1733170785488
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 17.custom30.custom42
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-datahub
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviDatahub.sasSviDatahub.env.sasK8SDeploymentName }}
        - name: SAS_ELASTICSEARCH_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: sas-opendistro-sasadmin-secret
        - name: SAS_ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: sas-opendistro-sasadmin-secret
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-opendistro-client-config-8dhffhdk25
        image: {{ .Values.sviDatahub.sasSviDatahub.image.repository }}:{{ .Values.sviDatahub.sasSviDatahub.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviDatahub.sasSviDatahub.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-datahub
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviDatahub.sasSviDatahub.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviDatahub.sasSviDatahub.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviDatahub.sasStartSequencer.image.repository }}:{{ .Values.sviDatahub.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviDatahub.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviDatahub.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviDatahub.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviDatahub.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviDatahub.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviDatahub.sasCertframe.image.repository }}:{{ .Values.sviDatahub.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviDatahub.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviDatahub.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviDatahub.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-feature
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-feature
    sas.com/component-version: 10.custom25.custom15-20241128.custom1732809158396
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 10.custom25.custom15
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-feature
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-feature
        app.kubernetes.io/name: sas-svi-feature
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-feature
        sas.com/component-version: 10.custom25.custom15-20241128.custom1732809158396
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 10.custom25.custom15
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-feature
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: RABBITMQ_PORT
          value: {{ quote .Values.sviFeature.sasSviFeature.env.rabbitmqPort }}
        - name: SAS_CACHE_CONFIG_MEMBERSHIPPORTRANGE
          value: {{ quote .Values.sviFeature.sasSviFeature.env.sasCacheConfigMembershipportrange
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviFeature.sasSviFeature.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviFeature.sasSviFeature.image.repository }}:{{ .Values.sviFeature.sasSviFeature.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviFeature.sasSviFeature.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-feature
        ports:
        - containerPort: 35001
          name: cache1
        - containerPort: 35002
          name: cache2
        - containerPort: 35003
          name: cache3
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviFeature.sasSviFeature.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviFeature.sasSviFeature.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviFeature.sasStartSequencer.image.repository }}:{{ .Values.sviFeature.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviFeature.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviFeature.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviFeature.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviFeature.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviFeature.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviFeature.sasCertframe.image.repository }}:{{ .Values.sviFeature.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviFeature.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviFeature.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviFeature.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-indexer
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-indexer
    sas.com/component-version: 3.custom23.custom38-20241128.custom1732795962899
    sas.com/elasticsearch-consumer: "true"
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom23.custom38
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-indexer
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-indexer
        app.kubernetes.io/name: sas-svi-indexer
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-indexer
        sas.com/component-version: 3.custom23.custom38-20241128.custom1732795962899
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom23.custom38
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-indexer
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviIndexer.sasSviIndexer.env.sasK8SDeploymentName }}
        - name: SAS_ELASTICSEARCH_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: sas-opendistro-sasadmin-secret
        - name: SAS_ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: sas-opendistro-sasadmin-secret
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-opendistro-client-config-8dhffhdk25
        image: {{ .Values.sviIndexer.sasSviIndexer.image.repository }}:{{ .Values.sviIndexer.sasSviIndexer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviIndexer.sasSviIndexer.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-indexer
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviIndexer.sasSviIndexer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviIndexer.sasSviIndexer.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviIndexer.sasStartSequencer.image.repository }}:{{ .Values.sviIndexer.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviIndexer.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviIndexer.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviIndexer.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviIndexer.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviIndexer.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviIndexer.sasCertframe.image.repository }}:{{ .Values.sviIndexer.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviIndexer.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviIndexer.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviIndexer.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-intelligence-management
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-intelligence-management
    sas.com/component-version: 3.custom22.custom19-20240919.custom1726775449462
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom22.custom19
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-intelligence-management
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-intelligence-management
        app.kubernetes.io/name: sas-svi-intelligence-management
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-intelligence-management
        sas.com/component-version: 3.custom22.custom19-20240919.custom1726775449462
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom22.custom19
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-intelligence-management
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.image.repository
          }}:{{ .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.image.tag
          | default .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-intelligence-management
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.sviIntelligenceManagement.sasSviIntelligenceManagement.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.sviIntelligenceManagement.sasStartSequencer.image.repository
          }}:{{ .Values.sviIntelligenceManagement.sasStartSequencer.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.sviIntelligenceManagement.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviIntelligenceManagement.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.sviIntelligenceManagement.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviIntelligenceManagement.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviIntelligenceManagement.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.sviIntelligenceManagement.sasCertframe.image.repository }}:{{
          .Values.sviIntelligenceManagement.sasCertframe.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe
        resources: {{- toYaml .Values.sviIntelligenceManagement.sasCertframe.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.sviIntelligenceManagement.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviIntelligenceManagement.podSecurityContext
        | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-network-analytics
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-network-analytics
    sas.com/component-version: 7.custom30.custom13-20241128.custom1732809156116
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 7.custom30.custom13
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-network-analytics
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-network-analytics
        app.kubernetes.io/name: sas-svi-network-analytics
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-network-analytics
        sas.com/component-version: 7.custom30.custom13-20241128.custom1732809156116
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 7.custom30.custom13
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-network-analytics
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.image.repository }}:{{
          .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-network-analytics
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.sviNetworkAnalytics.sasSviNetworkAnalytics.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.sviNetworkAnalytics.sasStartSequencer.image.repository }}:{{
          .Values.sviNetworkAnalytics.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.sviNetworkAnalytics.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviNetworkAnalytics.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.sviNetworkAnalytics.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviNetworkAnalytics.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviNetworkAnalytics.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviNetworkAnalytics.sasCertframe.image.repository }}:{{ .Values.sviNetworkAnalytics.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviNetworkAnalytics.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviNetworkAnalytics.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviNetworkAnalytics.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-sand
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-sand
    sas.com/component-version: 13.custom33.custom21-20241128.custom1732812780485
    sas.com/elasticsearch-consumer: "true"
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 13.custom33.custom21
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-sand
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-sand
        app.kubernetes.io/name: sas-svi-sand
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-sand
        sas.com/component-version: 13.custom33.custom21-20241128.custom1732812780485
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 13.custom33.custom21
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-sand
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviSand.sasSviSand.env.sasK8SDeploymentName }}
        - name: SAS_ELASTICSEARCH_USERNAME
          valueFrom:
            secretKeyRef:
              key: username
              name: sas-opendistro-sasadmin-secret
        - name: SAS_ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              key: password
              name: sas-opendistro-sasadmin-secret
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-opendistro-client-config-8dhffhdk25
        image: {{ .Values.sviSand.sasSviSand.image.repository }}:{{ .Values.sviSand.sasSviSand.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviSand.sasSviSand.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-sand
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviSand.sasSviSand.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviSand.sasSviSand.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviSand.sasStartSequencer.image.repository }}:{{ .Values.sviSand.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviSand.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviSand.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviSand.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviSand.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviSand.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviSand.sasCertframe.image.repository }}:{{ .Values.sviSand.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviSand.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.sviSand.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - command:
        - sh
        - -c
        - isOpenSearchUP() { curl -k --silent ${SAS_URL_ELASTICSEARCH}; }; isOpenSearchUP;
          LS=$?; echo "Waiting for OpenSearch to start"; while [[ $LS != '0' ]]; do echo
          "."; sleep 20; isOpenSearchUP;LS=$?; done; echo "OpenSearch started";
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-opendistro-client-config-8dhffhdk25
        image: {{ .Values.sviSand.sasOpendistroWait.image.repository }}:{{ .Values.sviSand.sasOpendistroWait.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviSand.sasOpendistroWait.imagePullPolicy }}
        name: sas-opendistro-wait
        resources: {{- toYaml .Values.sviSand.sasOpendistroWait.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviSand.sasOpendistroWait.containerSecurityContext
          | nindent 10 }}
      securityContext: {{- toYaml .Values.sviSand.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-scorecard
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-scorecard
    sas.com/component-version: 4.custom9.custom14-20241129.custom1732870603810
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom9.custom14
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-scorecard
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-scorecard
        app.kubernetes.io/name: sas-svi-scorecard
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-scorecard
        sas.com/component-version: 4.custom9.custom14-20241129.custom1732870603810
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom9.custom14
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-scorecard
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_CACHE_CONFIG_MEMBERSHIPPORTRANGE
          value: {{ quote .Values.sviScorecard.sasSviScorecard.env.sasCacheConfigMembershipportrange
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviScorecard.sasSviScorecard.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviScorecard.sasSviScorecard.image.repository }}:{{ .Values.sviScorecard.sasSviScorecard.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviScorecard.sasSviScorecard.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-scorecard
        ports:
        - containerPort: 35001
          name: cache1
        - containerPort: 35002
          name: cache2
        - containerPort: 35003
          name: cache3
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviScorecard.sasSviScorecard.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviScorecard.sasSviScorecard.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviScorecard.sasStartSequencer.image.repository }}:{{ .Values.sviScorecard.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviScorecard.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviScorecard.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviScorecard.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviScorecard.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviScorecard.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviScorecard.sasCertframe.image.repository }}:{{ .Values.sviScorecard.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviScorecard.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviScorecard.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviScorecard.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-transport
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-transport
    sas.com/component-version: 7.custom28.custom11-20241202.custom1733170880695
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 7.custom28.custom11
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-transport
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-transport
        app.kubernetes.io/name: sas-svi-transport
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-transport
        sas.com/component-version: 7.custom28.custom11-20241202.custom1733170880695
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 7.custom28.custom11
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-transport
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviTransport.sasSviTransport.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviTransport.sasSviTransport.image.repository }}:{{ .Values.sviTransport.sasSviTransport.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviTransport.sasSviTransport.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-transport
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviTransport.sasSviTransport.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviTransport.sasSviTransport.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviTransport.sasStartSequencer.image.repository }}:{{ .Values.sviTransport.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviTransport.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviTransport.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviTransport.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviTransport.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviTransport.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviTransport.sasCertframe.image.repository }}:{{ .Values.sviTransport.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviTransport.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviTransport.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviTransport.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-svi-vsd-service
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-svi-vsd-service
    sas.com/component-version: 13.custom50.custom30-20241202.custom1733176016182
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 13.custom50.custom30
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-svi-vsd-service
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-svi-vsd-service
        app.kubernetes.io/name: sas-svi-vsd-service
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-svi-vsd-service
        sas.com/component-version: 13.custom50.custom30-20241202.custom1733176016182
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 13.custom50.custom30
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-svi-vsd-service
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.sviVsdService.sasSviVsdService.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.sviVsdService.sasSviVsdService.image.repository }}:{{ .Values.sviVsdService.sasSviVsdService.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviVsdService.sasSviVsdService.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-svi-vsd-service
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.sviVsdService.sasSviVsdService.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviVsdService.sasSviVsdService.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.sviVsdService.sasStartSequencer.image.repository }}:{{ .Values.sviVsdService.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.sviVsdService.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.sviVsdService.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.sviVsdService.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.sviVsdService.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.sviVsdService.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.sviVsdService.sasCertframe.image.repository }}:{{ .Values.sviVsdService.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.sviVsdService.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.sviVsdService.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.sviVsdService.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-text-analytics-data
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-text-analytics-data
    sas.com/component-version: 6.custom64.custom0-20240905.custom1725570995679
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 6.custom64.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-text-analytics-data
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-text-analytics-data
        app.kubernetes.io/name: sas-text-analytics-data
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-text-analytics-data
        sas.com/component-version: 6.custom64.custom0-20240905.custom1725570995679
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 6.custom64.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-text-analytics-data
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.textAnalyticsData.sasTextAnalyticsData.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.textAnalyticsData.sasTextAnalyticsData.image.repository }}:{{
          .Values.textAnalyticsData.sasTextAnalyticsData.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.textAnalyticsData.sasTextAnalyticsData.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-text-analytics-data
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.textAnalyticsData.sasTextAnalyticsData.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsData.sasTextAnalyticsData.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.textAnalyticsData.sasStartSequencer.image.repository }}:{{ .Values.textAnalyticsData.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.textAnalyticsData.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.textAnalyticsData.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsData.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.textAnalyticsData.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.textAnalyticsData.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.textAnalyticsData.sasCertframe.image.repository }}:{{ .Values.textAnalyticsData.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.textAnalyticsData.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsData.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.textAnalyticsData.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-text-analytics-execution
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-text-analytics-execution
    sas.com/component-version: 6.custom19.custom4-20241207.custom1733533080467
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 6.custom19.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-text-analytics-execution
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-text-analytics-execution
        app.kubernetes.io/name: sas-text-analytics-execution
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-text-analytics-execution
        sas.com/component-version: 6.custom19.custom4-20241207.custom1733533080467
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 6.custom19.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-text-analytics-execution
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.textAnalyticsExecution.sasTextAnalyticsExecution.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.textAnalyticsExecution.sasTextAnalyticsExecution.image.repository
          }}:{{ .Values.textAnalyticsExecution.sasTextAnalyticsExecution.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.textAnalyticsExecution.sasTextAnalyticsExecution.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-text-analytics-execution
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.textAnalyticsExecution.sasTextAnalyticsExecution.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsExecution.sasTextAnalyticsExecution.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.textAnalyticsExecution.sasStartSequencer.image.repository }}:{{
          .Values.textAnalyticsExecution.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.textAnalyticsExecution.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.textAnalyticsExecution.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsExecution.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.textAnalyticsExecution.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.textAnalyticsExecution.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.textAnalyticsExecution.sasCertframe.image.repository }}:{{ .Values.textAnalyticsExecution.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.textAnalyticsExecution.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsExecution.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.textAnalyticsExecution.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-text-analytics-provider
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-text-analytics-provider
    sas.com/component-version: 6.custom37.custom0-20240906.custom1725650377031
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 6.custom37.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-text-analytics-provider
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-text-analytics-provider
        app.kubernetes.io/name: sas-text-analytics-provider
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-text-analytics-provider
        sas.com/component-version: 6.custom37.custom0-20240906.custom1725650377031
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 6.custom37.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-text-analytics-provider
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.textAnalyticsProvider.sasTextAnalyticsProvider.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.textAnalyticsProvider.sasTextAnalyticsProvider.image.repository
          }}:{{ .Values.textAnalyticsProvider.sasTextAnalyticsProvider.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.textAnalyticsProvider.sasTextAnalyticsProvider.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-text-analytics-provider
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.textAnalyticsProvider.sasTextAnalyticsProvider.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsProvider.sasTextAnalyticsProvider.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.textAnalyticsProvider.sasStartSequencer.image.repository }}:{{
          .Values.textAnalyticsProvider.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.textAnalyticsProvider.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.textAnalyticsProvider.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsProvider.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.textAnalyticsProvider.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.textAnalyticsProvider.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.textAnalyticsProvider.sasCertframe.image.repository }}:{{ .Values.textAnalyticsProvider.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.textAnalyticsProvider.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsProvider.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.textAnalyticsProvider.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.textAnalyticsProvider.hydrator.image.repository }}:{{ .Values.textAnalyticsProvider.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.textAnalyticsProvider.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.textAnalyticsProvider.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsProvider.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.textAnalyticsProvider.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.textAnalyticsProvider.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.textAnalyticsProvider.sasDbMigrator.image.repository }}:{{ .Values.textAnalyticsProvider.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.textAnalyticsProvider.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.textAnalyticsProvider.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsProvider.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.textAnalyticsProvider.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-text-analytics-taxonomies
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-text-analytics-taxonomies
    sas.com/component-version: 7.custom4.custom0-20240909.custom1725900757680
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 7.custom4.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-text-analytics-taxonomies
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-text-analytics-taxonomies
        app.kubernetes.io/name: sas-text-analytics-taxonomies
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-text-analytics-taxonomies
        sas.com/component-version: 7.custom4.custom0-20240909.custom1725900757680
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 7.custom4.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-text-analytics-taxonomies
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.image.repository
          }}:{{ .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-text-analytics-taxonomies
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.sasTextAnalyticsTaxonomies.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.textAnalyticsTaxonomies.sasStartSequencer.image.repository }}:{{
          .Values.textAnalyticsTaxonomies.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.textAnalyticsTaxonomies.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.textAnalyticsTaxonomies.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.textAnalyticsTaxonomies.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.textAnalyticsTaxonomies.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.textAnalyticsTaxonomies.sasCertframe.image.repository }}:{{ .Values.textAnalyticsTaxonomies.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.textAnalyticsTaxonomies.sasCertframe.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.textAnalyticsTaxonomies.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.textAnalyticsTaxonomies.hydrator.image.repository }}:{{ .Values.textAnalyticsTaxonomies.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.textAnalyticsTaxonomies.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.textAnalyticsTaxonomies.hydrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.textAnalyticsTaxonomies.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.textAnalyticsTaxonomies.sasDbMigrator.env.sslCertFile
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.textAnalyticsTaxonomies.sasDbMigrator.image.repository }}:{{
          .Values.textAnalyticsTaxonomies.sasDbMigrator.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.textAnalyticsTaxonomies.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.textAnalyticsTaxonomies.sasDbMigrator.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.textAnalyticsTaxonomies.podSecurityContext |
        nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-theme-designer-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-theme-designer-app
    sas.com/component-version: 4.custom25.custom4-20240910.custom1725969197469
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom25.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-theme-designer-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-theme-designer-app
        app.kubernetes.io/name: sas-theme-designer-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-theme-designer-app
        sas.com/component-version: 4.custom25.custom4-20240910.custom1725969197469
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom25.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-theme-designer-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.themeDesignerApp.sasThemeDesignerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.themeDesignerApp.sasThemeDesignerApp.image.repository }}:{{ .Values.themeDesignerApp.sasThemeDesignerApp.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.themeDesignerApp.sasThemeDesignerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-theme-designer-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.themeDesignerApp.sasThemeDesignerApp.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.themeDesignerApp.sasThemeDesignerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.themeDesignerApp.sasStartSequencer.image.repository }}:{{ .Values.themeDesignerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.themeDesignerApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.themeDesignerApp.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.themeDesignerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.themeDesignerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.themeDesignerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.themeDesignerApp.sasCertframe.image.repository }}:{{ .Values.themeDesignerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.themeDesignerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.themeDesignerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.themeDesignerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-transfer
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-transfer
    sas.com/component-version: 2.custom76.custom6-20240905.custom1725559313312
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom76.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-transfer
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-transfer
        app.kubernetes.io/name: sas-transfer
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-transfer
        sas.com/component-version: 2.custom76.custom6-20240905.custom1725559313312
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom76.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-transfer
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.transfer.sasTransfer.env.sasK8SDeploymentName }}
        - name: SAS_EVENT_CONFIGURATION_ARKE_ENABLED
          value: {{ quote .Values.transfer.sasTransfer.env.sasEventConfigurationArkeEnabled
            }}
        - name: JAVA_OPTION_XSS
          value: {{ quote .Values.transfer.sasTransfer.env.javaOptionXss }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.transfer.sasTransfer.image.repository }}:{{ .Values.transfer.sasTransfer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.transfer.sasTransfer.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 20
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 40
          periodSeconds: 20
          timeoutSeconds: 15
        name: sas-transfer
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 10
        resources: {{- toYaml .Values.transfer.sasTransfer.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.transfer.sasTransfer.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 60
          periodSeconds: 10
          timeoutSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.transfer.sasStartSequencer.image.repository }}:{{ .Values.transfer.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.transfer.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.transfer.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.transfer.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.transfer.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.transfer.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.transfer.sasCertframe.image.repository }}:{{ .Values.transfer.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.transfer.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.transfer.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.transfer.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-transformations
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-transformations
    sas.com/component-version: 2.custom50.custom8-20240911.custom1726076162435
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom50.custom8
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-transformations
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-transformations
        app.kubernetes.io/name: sas-transformations
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-transformations
        sas.com/component-version: 2.custom50.custom8-20240911.custom1726076162435
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom50.custom8
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-transformations
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.transformations.sasTransformations.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.transformations.sasTransformations.image.repository }}:{{ .Values.transformations.sasTransformations.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.transformations.sasTransformations.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-transformations
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.transformations.sasTransformations.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.transformations.sasTransformations.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.transformations.sasStartSequencer.image.repository }}:{{ .Values.transformations.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.transformations.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.transformations.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.transformations.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.transformations.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.transformations.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.transformations.sasCertframe.image.repository }}:{{ .Values.transformations.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.transformations.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.transformations.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.transformations.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-treatment-definitions
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-treatment-definitions
    sas.com/component-version: 8.custom4.custom15-20241203.custom1733236476339
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 8.custom4.custom15
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-treatment-definitions
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-treatment-definitions
        app.kubernetes.io/name: sas-treatment-definitions
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-treatment-definitions
        sas.com/component-version: 8.custom4.custom15-20241203.custom1733236476339
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 8.custom4.custom15
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-treatment-definitions
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.treatmentDefinitions.sasTreatmentDefinitions.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.treatmentDefinitions.sasTreatmentDefinitions.image.repository
          }}:{{ .Values.treatmentDefinitions.sasTreatmentDefinitions.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.treatmentDefinitions.sasTreatmentDefinitions.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-treatment-definitions
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.treatmentDefinitions.sasTreatmentDefinitions.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.treatmentDefinitions.sasTreatmentDefinitions.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.treatmentDefinitions.sasStartSequencer.image.repository }}:{{
          .Values.treatmentDefinitions.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.treatmentDefinitions.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.treatmentDefinitions.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.treatmentDefinitions.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.treatmentDefinitions.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.treatmentDefinitions.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.treatmentDefinitions.sasCertframe.image.repository }}:{{ .Values.treatmentDefinitions.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.treatmentDefinitions.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.treatmentDefinitions.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.treatmentDefinitions.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-visual-analytics
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-visual-analytics
    sas.com/component-version: 1.custom4.custom16-20240910.custom1725992387678
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom4.custom16
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-visual-analytics
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-visual-analytics
        app.kubernetes.io/name: sas-visual-analytics
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-visual-analytics
        sas.com/component-version: 1.custom4.custom16-20240910.custom1725992387678
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom4.custom16
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-visual-analytics
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.visualAnalytics.sasVisualAnalytics.env.sasK8SDeploymentName
            }}
        - name: SAS_CADENCE_NAME
          valueFrom:
            configMapKeyRef:
              key: SAS_CADENCE_NAME
              name: {{ include "sas-viya-helm.fullname" . }}-deployment-metadata-27kb47bb47
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.visualAnalytics.sasVisualAnalytics.image.repository }}:{{ .Values.visualAnalytics.sasVisualAnalytics.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.visualAnalytics.sasVisualAnalytics.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-visual-analytics
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.visualAnalytics.sasVisualAnalytics.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.sasVisualAnalytics.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.visualAnalytics.sasReportOperationsCore.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-truststore-config-d25k9878hb
        image: '{{ .Values.visualAnalytics.sasReportOperationsCore.image.repository }}:{{
          .Values.visualAnalytics.sasReportOperationsCore.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.visualAnalytics.sasReportOperationsCore.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          exec:
            command:
            - /opt/sas/viya/home/bin/sas-liveness-tool
            - -manifest-file
            - /opt/sas/viya/home/share/sas-report-operations-core/run-manifest.json
        name: sas-report-operations-core
        ports:
        - containerPort: 9999
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: 9999
            scheme: HTTP
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {{- toYaml .Values.visualAnalytics.sasReportOperationsCore.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.sasReportOperationsCore.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.visualAnalytics.sasStartSequencer.image.repository }}:{{ .Values.visualAnalytics.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.visualAnalytics.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.visualAnalytics.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.visualAnalytics.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.visualAnalytics.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.visualAnalytics.sasCertframe.image.repository }}:{{ .Values.visualAnalytics.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.visualAnalytics.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.visualAnalytics.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.visualAnalytics.hydrator.image.repository }}:{{ .Values.visualAnalytics.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.visualAnalytics.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.visualAnalytics.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.visualAnalytics.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.visualAnalytics.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.visualAnalytics.sasDbMigrator.image.repository }}:{{ .Values.visualAnalytics.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.visualAnalytics.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.visualAnalytics.sasDbMigrator.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualAnalytics.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.visualAnalytics.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-visual-analytics-administration
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-visual-analytics-administration
    sas.com/component-version: 1.custom104.custom6-20240906.custom1725629311088
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom104.custom6
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-visual-analytics-administration
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-visual-analytics-administration
        app.kubernetes.io/name: sas-visual-analytics-administration
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-visual-analytics-administration
        sas.com/component-version: 1.custom104.custom6-20240906.custom1725629311088
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom104.custom6
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-visual-analytics-administration
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.image.repository
          }}:{{ .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.image.tag
          | default .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-visual-analytics-administration
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsAdministration.sasVisualAnalyticsAdministration.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.visualAnalyticsAdministration.sasStartSequencer.image.repository
          }}:{{ .Values.visualAnalyticsAdministration.sasStartSequencer.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.visualAnalyticsAdministration.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.visualAnalyticsAdministration.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsAdministration.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.visualAnalyticsAdministration.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.visualAnalyticsAdministration.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: '{{ .Values.visualAnalyticsAdministration.sasCertframe.image.repository }}:{{
          .Values.visualAnalyticsAdministration.sasCertframe.image.tag | default .Chart.AppVersion
          }}'
        name: sas-certframe
        resources: {{- toYaml .Values.visualAnalyticsAdministration.sasCertframe.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsAdministration.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.visualAnalyticsAdministration.hydrator.args | nindent
          8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: '{{ .Values.visualAnalyticsAdministration.hydrator.image.repository }}:{{
          .Values.visualAnalyticsAdministration.hydrator.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.visualAnalyticsAdministration.hydrator.imagePullPolicy
          }}
        name: hydrator
        resources: {{- toYaml .Values.visualAnalyticsAdministration.hydrator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsAdministration.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.visualAnalyticsAdministration.sasDbMigrator.env.sasServiceName
            }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.visualAnalyticsAdministration.sasDbMigrator.env.sslCertFile
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.visualAnalyticsAdministration.sasDbMigrator.image.repository
          }}:{{ .Values.visualAnalyticsAdministration.sasDbMigrator.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.visualAnalyticsAdministration.sasDbMigrator.imagePullPolicy
          }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.visualAnalyticsAdministration.sasDbMigrator.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsAdministration.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.visualAnalyticsAdministration.podSecurityContext
        | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-visual-analytics-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-visual-analytics-app
    sas.com/component-version: 3.custom15.custom39-20241122.custom1732307826683
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom15.custom39
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-visual-analytics-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-visual-analytics-app
        app.kubernetes.io/name: sas-visual-analytics-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-visual-analytics-app
        sas.com/component-version: 3.custom15.custom39-20241122.custom1732307826683
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom15.custom39
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-visual-analytics-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.visualAnalyticsApp.sasVisualAnalyticsApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.visualAnalyticsApp.sasVisualAnalyticsApp.image.repository }}:{{
          .Values.visualAnalyticsApp.sasVisualAnalyticsApp.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.visualAnalyticsApp.sasVisualAnalyticsApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-visual-analytics-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.visualAnalyticsApp.sasVisualAnalyticsApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsApp.sasVisualAnalyticsApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.visualAnalyticsApp.sasStartSequencer.image.repository }}:{{ .Values.visualAnalyticsApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.visualAnalyticsApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.visualAnalyticsApp.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.visualAnalyticsApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.visualAnalyticsApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.visualAnalyticsApp.sasCertframe.image.repository }}:{{ .Values.visualAnalyticsApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.visualAnalyticsApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualAnalyticsApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.visualAnalyticsApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-visual-investigator-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-visual-investigator-app
    sas.com/component-version: 11.custom30.custom63-20241203.custom1733247027918
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 11.custom30.custom63
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-visual-investigator-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-visual-investigator-app
        app.kubernetes.io/name: sas-visual-investigator-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-visual-investigator-app
        sas.com/component-version: 11.custom30.custom63-20241203.custom1733247027918
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 11.custom30.custom63
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-visual-investigator-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_CACHE_CONFIG_MEMBERSHIPPORTRANGE
          value: {{ quote .Values.visualInvestigatorApp.sasVisualInvestigatorApp.env.sasCacheConfigMembershipportrange
            }}
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.visualInvestigatorApp.sasVisualInvestigatorApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: '{{ .Values.visualInvestigatorApp.sasVisualInvestigatorApp.image.repository
          }}:{{ .Values.visualInvestigatorApp.sasVisualInvestigatorApp.image.tag | default
          .Chart.AppVersion }}'
        imagePullPolicy: {{ .Values.visualInvestigatorApp.sasVisualInvestigatorApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-visual-investigator-app
        ports:
        - containerPort: 35001
          name: cache1
        - containerPort: 35002
          name: cache2
        - containerPort: 35003
          name: cache3
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.visualInvestigatorApp.sasVisualInvestigatorApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualInvestigatorApp.sasVisualInvestigatorApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: '{{ .Values.visualInvestigatorApp.sasStartSequencer.image.repository }}:{{
          .Values.visualInvestigatorApp.sasStartSequencer.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.visualInvestigatorApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.visualInvestigatorApp.sasStartSequencer.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.visualInvestigatorApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.visualInvestigatorApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.visualInvestigatorApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.visualInvestigatorApp.sasCertframe.image.repository }}:{{ .Values.visualInvestigatorApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.visualInvestigatorApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.visualInvestigatorApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.visualInvestigatorApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-web-assets
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-web-assets
    sas.com/component-version: 3.custom82.custom3-20240905.custom1725560400967
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 3.custom82.custom3
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-web-assets
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-web-assets
        app.kubernetes.io/name: sas-web-assets
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-web-assets
        sas.com/component-version: 3.custom82.custom3-20240905.custom1725560400967
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 3.custom82.custom3
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-web-assets
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.webAssets.sasWebAssets.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.webAssets.sasWebAssets.image.repository }}:{{ .Values.webAssets.sasWebAssets.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webAssets.sasWebAssets.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-web-assets
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.webAssets.sasWebAssets.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webAssets.sasWebAssets.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.webAssets.sasStartSequencer.image.repository }}:{{ .Values.webAssets.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webAssets.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.webAssets.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.webAssets.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.webAssets.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.webAssets.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.webAssets.sasCertframe.image.repository }}:{{ .Values.webAssets.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.webAssets.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webAssets.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.webAssets.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.webAssets.hydrator.image.repository }}:{{ .Values.webAssets.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webAssets.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.webAssets.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webAssets.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.webAssets.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.webAssets.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.webAssets.sasDbMigrator.image.repository }}:{{ .Values.webAssets.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webAssets.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.webAssets.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webAssets.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.webAssets.podSecurityContext | nindent 8 }}
      terminationGracePeriodSeconds: 120
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-web-renderer
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-web-renderer
    sas.com/component-version: 1.custom40.custom0-20240905.custom1725569578448
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom40.custom0
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-web-renderer
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-web-renderer
        app.kubernetes.io/name: sas-web-renderer
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-web-renderer
        sas.com/component-version: 1.custom40.custom0-20240905.custom1725569578448
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom40.custom0
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-web-renderer
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.webRenderer.sasWebRenderer.env.sasK8SDeploymentName }}
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.webRenderer.sasWebRenderer.image.repository }}:{{ .Values.webRenderer.sasWebRenderer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webRenderer.sasWebRenderer.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-web-renderer
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 8888
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.webRenderer.sasWebRenderer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.webRenderer.sasWebRenderer.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/home/share/sas-web-renderer/meta/chromium_policies/02-custom-policies.json
          name: chromium-policies
          subPath: 02-custom-policies.json
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.webRenderer.sasStartSequencer.image.repository }}:{{ .Values.webRenderer.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webRenderer.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.webRenderer.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.webRenderer.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.webRenderer.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.webRenderer.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.webRenderer.sasCertframe.image.repository }}:{{ .Values.webRenderer.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.webRenderer.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webRenderer.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.webRenderer.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-web-renderer-chromium-policies-hkgb67fbt7
        name: chromium-policies
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-webhooks
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-webhooks
    sas.com/component-version: 1.custom16.custom12-20240904.custom1725475867943
    sas.com/kustomize-base: golang
    sas.com/pod-uses-db-migrator: "true"
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 1.custom16.custom12
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-webhooks
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-webhooks
        app.kubernetes.io/name: sas-webhooks
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-webhooks
        sas.com/component-version: 1.custom16.custom12-20240904.custom1725475867943
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 1.custom16.custom12
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-webhooks
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.webhooks.sasWebhooks.env.sasK8SDeploymentName }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.webhooks.sasWebhooks.image.repository }}:{{ .Values.webhooks.sasWebhooks.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webhooks.sasWebhooks.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-webhooks
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.webhooks.sasWebhooks.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webhooks.sasWebhooks.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.webhooks.sasStartSequencer.image.repository }}:{{ .Values.webhooks.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webhooks.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.webhooks.sasStartSequencer.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.webhooks.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.webhooks.sasCertframe.env.sasCertframeTokenDir }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.webhooks.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.webhooks.sasCertframe.image.repository }}:{{ .Values.webhooks.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.webhooks.sasCertframe.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webhooks.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      - args: {{- toYaml .Values.webhooks.hydrator.args | nindent 8 }}
        command:
        - /bin/sh
        - -c
        env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        image: {{ .Values.webhooks.hydrator.image.repository }}:{{ .Values.webhooks.hydrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webhooks.hydrator.imagePullPolicy }}
        name: hydrator
        resources: {{- toYaml .Values.webhooks.hydrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webhooks.hydrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
      - env:
        - name: SAS_SERVICE_NAME
          value: {{ quote .Values.webhooks.sasDbMigrator.env.sasServiceName }}
        - name: SSL_CERT_FILE
          value: {{ quote .Values.webhooks.sasDbMigrator.env.sslCertFile }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - secretRef:
            name: sas-consul-client
        image: {{ .Values.webhooks.sasDbMigrator.image.repository }}:{{ .Values.webhooks.sasDbMigrator.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.webhooks.sasDbMigrator.imagePullPolicy }}
        name: sas-db-migrator
        resources: {{- toYaml .Values.webhooks.sasDbMigrator.resources | nindent 10 }}
        securityContext: {{- toYaml .Values.webhooks.sasDbMigrator.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /data
          name: shared-vol
        - mountPath: /security
          name: security
      securityContext: {{- toYaml .Values.webhooks.podSecurityContext | nindent 8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - emptyDir: {}
        name: shared-vol
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-workflow-engine
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-workflow-engine
    sas.com/component-version: 4.custom16.custom18-20241113.custom1731530413352
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom16.custom18
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-workflow-engine
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-workflow-engine
        app.kubernetes.io/name: sas-workflow-engine
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-workflow-engine
        sas.com/component-version: 4.custom16.custom18-20241113.custom1731530413352
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom16.custom18
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-workflow-engine
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.workflowEngine.sasWorkflowEngine.env.sasK8SDeploymentName
            }}
        - name: JAVA_OPTION_SERVER_PORT
          value: {{ quote .Values.workflowEngine.sasWorkflowEngine.env.javaOptionServerPort
            }}
        - name: MANAGEMENT_SERVER_PORT
          value: {{ quote .Values.workflowEngine.sasWorkflowEngine.env.managementServerPort
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.workflowEngine.sasWorkflowEngine.image.repository }}:{{ .Values.workflowEngine.sasWorkflowEngine.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.workflowEngine.sasWorkflowEngine.imagePullPolicy }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-workflow-engine
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.workflowEngine.sasWorkflowEngine.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowEngine.sasWorkflowEngine.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.workflowEngine.sasStartSequencer.image.repository }}:{{ .Values.workflowEngine.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.workflowEngine.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.workflowEngine.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowEngine.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.workflowEngine.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.workflowEngine.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.workflowEngine.sasCertframe.image.repository }}:{{ .Values.workflowEngine.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.workflowEngine.sasCertframe.resources | nindent 10
          }}
        securityContext: {{- toYaml .Values.workflowEngine.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.workflowEngine.podSecurityContext | nindent 8
        }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-workflow-history
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: spring
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: jks
    sas.com/component-name: sas-workflow-history
    sas.com/component-version: 4.custom10.custom4-20241216.custom1734318045628
    sas.com/kustomize-base: spring
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 4.custom10.custom4
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-workflow-history
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-workflow-history
        app.kubernetes.io/name: sas-workflow-history
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "10445"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: jks
        sas.com/component-name: sas-workflow-history
        sas.com/component-version: 4.custom10.custom4-20241216.custom1734318045628
        sas.com/kustomize-base: spring
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 4.custom10.custom4
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-workflow-history
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.workflowHistory.sasWorkflowHistory.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-tls-config-mkt22c2k7b
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-java-config-fg8dm449m4
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-spring-23-management-config-9498f59kmm
        image: {{ .Values.workflowHistory.sasWorkflowHistory.image.repository }}:{{ .Values.workflowHistory.sasWorkflowHistory.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.workflowHistory.sasWorkflowHistory.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-workflow-history
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        - containerPort: 10445
          name: http-internal
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http-internal
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.workflowHistory.sasWorkflowHistory.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowHistory.sasWorkflowHistory.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 360
          httpGet:
            path: /internal/live
            port: http-internal
            scheme: HTTPS
          initialDelaySeconds: 20
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /opt/sas/viya/config/tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.workflowHistory.sasStartSequencer.image.repository }}:{{ .Values.workflowHistory.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.workflowHistory.sasStartSequencer.imagePullPolicy }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.workflowHistory.sasStartSequencer.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowHistory.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.workflowHistory.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.workflowHistory.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-java-config-7mmtgffmg7
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.workflowHistory.sasCertframe.image.repository }}:{{ .Values.workflowHistory.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.workflowHistory.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowHistory.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.workflowHistory.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "sas-viya-helm.fullname" . }}-workflow-manager-app
  labels:
    sas.com/admin: namespace
    sas.com/deployment: sas-viya
    sas.com/deployment-base: golang
    sas.com/uses-start-sequencer: "true"
    workload.sas.com/class: stateless
  {{- include "sas-viya-helm.labels" . | nindent 4 }}
  annotations:
    sas.com/certificate-file-format: pem
    sas.com/component-name: sas-workflow-manager-app
    sas.com/component-version: 2.custom165.custom9-20241126.custom1732611053361
    sas.com/kustomize-base: golang
    sas.com/pod-uses-liveness-probe: http
    sas.com/pod-uses-readiness-probe: http
    sas.com/pod-uses-startup-probe: http
    sas.com/tls-mode: full-stack
    sas.com/version: 2.custom165.custom9
    sidecar.istio.io/proxyCPU: 15m
    sidecar.istio.io/proxyMemory: 115Mi
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: sas-workflow-manager-app
      sas.com/deployment: sas-viya
    {{- include "sas-viya-helm.selectorLabels" . | nindent 6 }}
    matchExpressions: []
  template:
    metadata:
      labels:
        app: sas-workflow-manager-app
        app.kubernetes.io/name: sas-workflow-manager-app
        sas.com/deployment: sas-viya
        sas.com/start-sequencer: "true"
        workload.sas.com/class: stateless
      {{- include "sas-viya-helm.selectorLabels" . | nindent 8 }}
      annotations:
        prometheus.io/path: /internal/metrics
        prometheus.io/port: "8080"
        prometheus.io/scheme: https
        prometheus.io/scrape: "true"
        sas.com/certificate-file-format: pem
        sas.com/component-name: sas-workflow-manager-app
        sas.com/component-version: 2.custom165.custom9-20241126.custom1732611053361
        sas.com/kustomize-base: golang
        sas.com/pod-uses-liveness-probe: http
        sas.com/pod-uses-readiness-probe: http
        sas.com/pod-uses-startup-probe: http
        sas.com/tls-enabled-ports: all
        sas.com/tls-mode: full-stack
        sas.com/version: 2.custom165.custom9
        sidecar.istio.io/proxyCPU: 15m
        sidecar.istio.io/proxyMemory: 115Mi
    spec:
      affinity:
        nodeAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: In
                values:
                - stateless
            weight: 100
          - preference:
              matchExpressions:
              - key: workload.sas.com/class
                operator: NotIn
                values:
                - compute
                - cas
                - stateful
            weight: 50
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.azure.com/mode
                operator: NotIn
                values:
                - system
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                  - sas-workflow-manager-app
              topologyKey: kubernetes.io/hostname
            weight: 100
      automountServiceAccountToken: false
      containers:
      - env:
        - name: SAS_K8S_DEPLOYMENT_NAME
          value: {{ quote .Values.workflowManagerApp.sasWorkflowManagerApp.env.sasK8SDeploymentName
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-tls-config-dg85g4hfh8
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        - secretRef:
            name: sas-consul-client
        image: '{{ .Values.workflowManagerApp.sasWorkflowManagerApp.image.repository }}:{{
          .Values.workflowManagerApp.sasWorkflowManagerApp.image.tag | default .Chart.AppVersion
          }}'
        imagePullPolicy: {{ .Values.workflowManagerApp.sasWorkflowManagerApp.imagePullPolicy
          }}
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        name: sas-workflow-manager-app
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /internal/ready
            port: http
            scheme: HTTPS
          periodSeconds: 20
          timeoutSeconds: 5
        resources: {{- toYaml .Values.workflowManagerApp.sasWorkflowManagerApp.resources
          | nindent 10 }}
        securityContext: {{- toYaml .Values.workflowManagerApp.sasWorkflowManagerApp.containerSecurityContext
          | nindent 10 }}
        startupProbe:
          failureThreshold: 180
          httpGet:
            path: /internal/live
            port: http
            scheme: HTTPS
          periodSeconds: 10
        volumeMounts:
        - mountPath: /tmp
          name: tmp
        - mountPath: /security
          name: security
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/cacerts
          name: security
          subPath: cacerts
        - mountPath: /opt/sas/viya/config/etc/SASSecurityCertificateFramework/private
          name: security
          subPath: private
      imagePullSecrets:
      - name: {{ include "sas-viya-helm.fullname" . }}-image-pull-secrets-9dd8hm29fm
      initContainers:
      - env:
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-go-config-4m2m8m8662
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-shared-config-c49cg8722d
        image: {{ .Values.workflowManagerApp.sasStartSequencer.image.repository }}:{{ .Values.workflowManagerApp.sasStartSequencer.image.tag
          | default .Chart.AppVersion }}
        imagePullPolicy: {{ .Values.workflowManagerApp.sasStartSequencer.imagePullPolicy
          }}
        name: sas-start-sequencer
        resources: {{- toYaml .Values.workflowManagerApp.sasStartSequencer.resources |
          nindent 10 }}
        securityContext: {{- toYaml .Values.workflowManagerApp.sasStartSequencer.containerSecurityContext
          | nindent 10 }}
      - env:
        - name: KUBE_POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: SAS_CERTFRAME_TOKEN_DIR
          value: {{ quote .Values.workflowManagerApp.sasCertframe.env.sasCertframeTokenDir
            }}
        - name: SAS_ADDITIONAL_CA_CERTIFICATES_DIR
          value: {{ quote .Values.workflowManagerApp.sasCertframe.env.sasAdditionalCaCertificatesDir
            }}
        - name: KUBERNETES_CLUSTER_DOMAIN
          value: {{ quote .Values.kubernetesClusterDomain }}
        envFrom:
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-config-6t84hm65mc
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-ingress-certificate-config-6mt27h98mb
        - configMapRef:
            name: {{ include "sas-viya-helm.fullname" . }}-certframe-user-config-679cgdbhdt
        image: {{ .Values.workflowManagerApp.sasCertframe.image.repository }}:{{ .Values.workflowManagerApp.sasCertframe.image.tag
          | default .Chart.AppVersion }}
        name: sas-certframe
        resources: {{- toYaml .Values.workflowManagerApp.sasCertframe.resources | nindent
          10 }}
        securityContext: {{- toYaml .Values.workflowManagerApp.sasCertframe.containerSecurityContext
          | nindent 10 }}
        volumeMounts:
        - mountPath: /certframe-token
          name: certframe-token
        - mountPath: /security
          name: security
        - mountPath: /customer-provided-ca-certificates
          name: customer-provided-ca-certificates
      securityContext: {{- toYaml .Values.workflowManagerApp.podSecurityContext | nindent
        8 }}
      tolerations:
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateful
      - effect: NoSchedule
        key: workload.sas.com/class
        operator: Equal
        value: stateless
      volumes:
      - emptyDir: {}
        name: tmp
      - name: certframe-token
        secret:
          secretName: {{ include "sas-viya-helm.fullname" . }}-certframe-token
      - emptyDir: {}
        name: security
      - configMap:
          name: {{ include "sas-viya-helm.fullname" . }}-customer-provided-ca-certificates-bm5hc686c7
        name: customer-provided-ca-certificates
